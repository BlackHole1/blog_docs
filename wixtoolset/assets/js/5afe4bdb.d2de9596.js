"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[34390],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||c[m]||r;return n?i.createElement(h,a(a({ref:t},u),{},{components:n})):i.createElement(h,a({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,a=new Array(r);a[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,a[1]=s;for(var p=2;p<r;p++)a[p]=n[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},34706:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>p,toc:()=>d});n(67294);var i=n(3905);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function a(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const s={wip:5489,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Repository Reorganization"},l=void 0,p={unversionedId:"development/wips/repository-reorganization",id:"development/wips/repository-reorganization",title:"Repository Reorganization",description:"User stories",source:"@site/docs/development/wips/5489-repository-reorganization.md",sourceDirName:"development/wips",slug:"/development/wips/repository-reorganization",permalink:"/wixtoolset/docs/development/wips/repository-reorganization",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/5489-repository-reorganization.md",tags:[],version:"current",sidebarPosition:5489,frontMatter:{wip:5489,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Repository Reorganization"},sidebar:"docsSidebar",previous:{title:"Add support to detect and install VSIX packages into VS2017",permalink:"/wixtoolset/docs/development/wips/add-support-to-detect-and-install-vsix-packages-into-vs15"},next:{title:"Votive via VS Marketplace",permalink:"/wixtoolset/docs/development/wips/votive-via-vs-marketplace"}},u={},d=[{value:"User stories",id:"user-stories",level:2},{value:"Proposal",id:"proposal",level:2},{value:"Libraries",id:"libraries",level:3},{value:"Burn",id:"burn",level:3},{value:"Core",id:"core",level:3},{value:"Votive",id:"votive",level:3},{value:"WiX Extensions",id:"wix-extensions",level:3},{value:"Considerations",id:"considerations",level:2},{value:"See Also",id:"see-also",level:2}],c={toc:d},m="wrapper";function h(e){var{components:t}=e,n=a(e,["components"]);return(0,i.kt)(m,r(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){o(e,t,n[t])}))}return e}({},c,n),{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"user-stories"},"User stories"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"As a WiX developer I can work on a focused subset of the toolset such\nthat I am more productive because there is less code and the development\nloop is faster.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"As a WiX developer I can work on a focused subset of the toolset such\nthat I consider the interfaces between independent parts of the toolset."))),(0,i.kt)("h2",{id:"proposal"},"Proposal"),(0,i.kt)("p",null,"Today the WiX Toolset is a monolithic repository per major release.\nThis makes it easy to build everything from a single repository.\nThe downside is that you build everything and need everything to\nbuild. Since the WiX Toolset functionality spans the breadth of the\nWindows ecosystem that means you need a lot of tools to build\n(Windows SDKs, multiple versions of Visual Studio, etc)."),(0,i.kt)("p",null,"There are also large portions of the WiX Toolset that do not change\nfrom release to release. That means code is being rebuilt and\nredistributed even though there is no change. This not only\nwastes developer time and build machine time but customer installation\ntime."),(0,i.kt)("p",null,"Finally, NuGet has changed the way that developers share libraries.\nThere is functionality in the WiX Toolset--such as dutil, wcautil,\nand DTF--that would be more accessible if made available via NuGet."),(0,i.kt)("p",null,"To modernize the WiX developer experience, this proposal recommends\nbreaking the ",(0,i.kt)("inlineCode",{parentName:"p"},"wix4")," monolithic repository into several smaller\nrepositories each focused on an independent part of the WiX Toolset.\nWhen considering how to reorgnize the WiX Toolset's repositories\nit is important to the layers of functionality in the toolset itself:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Libraries - independent functionality the rest of the toolset builds upon.\nExamples include: dutil, wcautil, DTF, and WixToolset.Data")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Burn - the bootstrapper engine and its interfaces")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Core - the command-line tools, MSBuild integration, Compiler/Linker/Binder")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Votive - WiX Toolset's Visual Studio Extension")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"WiX Extensions - extensions to the WiX Toolset. Examples include:\nWixIisExtension, WixNetfxExtension, WixSqlExtension, and others"))),(0,i.kt)("h3",{id:"libraries"},"Libraries"),(0,i.kt)("p",null,'First and foremost, the libraries in the WiX Toolset are split on\ninterface boundaries. Changes made to a library must take into\naccount the interface and what breaking changes might occur.\nToday it is too easy to change a library in the WiX Toolset and "fix up"\nthe Core without considering dependents outside of the WiX Toolset\nitself. With the libraries separated, breaking changes will\nbe easier to detect.'),(0,i.kt)("p",null,"Second, library repositories must be independent from each other\nso a single set of functionality is published by a respository. For\nexample, dutil and wcautil libraries live in separate respositories\nso changes to wcautil do not cause dutil to be published."),(0,i.kt)("p",null,"Here are the proposed Library repositories:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dutil - publishes ",(0,i.kt)("inlineCode",{parentName:"p"},"dutil.lib")," for all supported versions of\nVisual Studio via a NuGet package: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Dutil"),". Additionally,\n",(0,i.kt)("inlineCode",{parentName:"p"},"deputil")," files will be moved into dutil and there will be no ",(0,i.kt)("inlineCode",{parentName:"p"},"deputil.lib")," in the future.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Wcautil - publishes ",(0,i.kt)("inlineCode",{parentName:"p"},"wcautil.lib")," for all supported versions\nof Visual Studio via a NuGet package: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Wcautil"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Balutil - publishes ",(0,i.kt)("inlineCode",{parentName:"p"},"balutil.lib")," for all supported versions\nof Visual Studio via a NuGet package: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Balutil"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dtf.Compression - publishes the Compression assemblies in Dtf\nvia NuGet packages: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Dtf.Compression"),",\n",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Dtf.Compression.Cab"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Dtf.Compression.Zip"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dtf.Resources - publishes the Resources assembly in Dtf via NuGet\npackage: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Dtf.Resources"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dtf.WindowsInstaller - publishes the WindowsInstaller assemblies\nin Dtf via NuGet packages: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Dtf.WindowsInstaller"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Dtf.WindowsInstaller.Package"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Data - publishes the WixToolset.Data assembly via NuGet package: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Data"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Extensibility - publishes the WixToolset.Extensibility assembly\nvia NuGet package: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Extensibility")))),(0,i.kt)("h3",{id:"burn"},"Burn"),(0,i.kt)("p",null,"The Burn engine and its interfaces (",(0,i.kt)("inlineCode",{parentName:"p"},"IBootstrapperEngine")," and\n",(0,i.kt)("inlineCode",{parentName:"p"},"IBootstrapperApplication"),") are separated into an independent repository\nto be shared by both the ",(0,i.kt)("inlineCode",{parentName:"p"},"Core"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Balutil")," and the\n",(0,i.kt)("inlineCode",{parentName:"p"},"WixBalExtension")," repositories."),(0,i.kt)("p",null,"This repository publishes ",(0,i.kt)("inlineCode",{parentName:"p"},"burnstub.exe")," for the ",(0,i.kt)("inlineCode",{parentName:"p"},"Core")," and\nthe NuGet package: ",(0,i.kt)("inlineCode",{parentName:"p"},"WixToolset.Bootstrapper.Interfaces"),"."),(0,i.kt)("h3",{id:"core"},"Core"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Core")," is where the bulk of WiX Toolset development takes\nplace. This repository includes all command-line tools, MSBuild integration\n(including DTF's custom action integration) and, of course, wix.dll."),(0,i.kt)("p",null,"This respository is responsible for building and publishing the bundle\nand NuGet package for the WiX Toolset."),(0,i.kt)("h3",{id:"votive"},"Votive"),(0,i.kt)("p",null,"The WiX Toolset's Visual Studio Extension, ",(0,i.kt)("inlineCode",{parentName:"p"},"Votive"),", is separated from the ",(0,i.kt)("inlineCode",{parentName:"p"},"Core"),"\nand distributed via the Visual Studio Marketplace. Doing so dramatically improves\nthe WiX Toolset's installation speed. Additionally, developers can install Votive\nwithout installing the WiX Toolset and .sln's with .wixproj's will load cleanly."),(0,i.kt)("p",null,"This respository produces a VSIX for each version of Visual Studio supported,\nnamely: 2010, 2012, 2013, 2015 and 2017."),(0,i.kt)("h3",{id:"wix-extensions"},"WiX Extensions"),(0,i.kt)("p",null,"Separating each WiX Extension into its own repository provides several benefits.\nFirst, WiX Extensions are already very independent and would benefit from a\ntight developer loop. Second, developers do not need to be overwhelmed with\nthe full WiX build process to work on a particular WiX Extension. Finally, a\nWiX Extension release schedule would no longer be tied to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Core")," release\nschedule."),(0,i.kt)("p",null,"When the ",(0,i.kt)("inlineCode",{parentName:"p"},"Core"),' bundle is created it will include the "last known good" of each\nWiX Extension via an MSI package. WiX Extension repositories will also each output\nan add-on bundle to the ',(0,i.kt)("inlineCode",{parentName:"p"},"Core"),' bundle that installs the WiX Extension\'s MSI\npackage. This allows WiX Extensions to upgrade the "last know good" provided\nby the ',(0,i.kt)("inlineCode",{parentName:"p"},"Core"),"."),(0,i.kt)("h2",{id:"considerations"},"Considerations"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"While this reorganization optimizes for working within a focused subset of\nthe WiX Toolset, it does make fixing cross cutting issues much more difficult.\nThis is partly the goal (to create friction to changing public interfaces) but\nwe must recognize that it will be required at times. So work will need to be done\nto help")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"There are several ways to slice the DTF repositories. For example, all of the\nrespositories could be in a single ",(0,i.kt)("inlineCode",{parentName:"p"},"Dtf")," repository or the respository could be\nbroken down further (for example, ",(0,i.kt)("inlineCode",{parentName:"p"},"Dtf.Compression"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Dtf.Compression.Cab")," and\n",(0,i.kt)("inlineCode",{parentName:"p"},"Dtf.Compression.Zip"),"). The current proposal attempts to strike a balance between\nrespository explosion and complete isolation of functionality.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"It is enticing to break out DTF's custom action host into its own\nrespository since it ",(0,i.kt)("em",{parentName:"p"},"never")," changes and the only consumer is the ",(0,i.kt)("inlineCode",{parentName:"p"},"Core"),". Still\nconsidering if that is reasonable.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The .NET Framework team ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/dotnet/corefx/issues/15135"},"recently consolidated their CoreFX repositories into\na single respository"),'. That would suggest reorganizing our single repository\ninto many would be the wrong thing to do. We should keep in mind their "Primary\nreasons for the changes" and make sure we do not repeat those mistakes. However,\nthis proposal focuses on reorganizing the WiX Toolset\'s repositories based on\nlayers. Our dependency graph has ',(0,i.kt)("strong",{parentName:"p"},"never")," looked ",(0,i.kt)("a",{parentName:"p",href:"https://cloud.githubusercontent.com/assets/715038/21939565/a232eeaa-d9c0-11e6-8298-e27d641eed3e.png"},"this bad"),"."))),(0,i.kt)("h2",{id:"see-also"},"See Also"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/wixtoolset/issues/issues/5489"},"WIP:5489 - Repository Reorganization"))))}h.isMDXComponent=!0}}]);