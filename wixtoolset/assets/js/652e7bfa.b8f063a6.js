"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[45114],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},78361:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>d});n(67294);var a=n(3905);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const l={wip:6164,type:"Feature",by:"Sean Hall (r sean hall at gmail.com)",title:"Move DisplayInternalUI from Core to BalExtension",draft:!1},s=void 0,p={unversionedId:"development/wips/move-displayinternalui-from-core-to-bal",id:"development/wips/move-displayinternalui-from-core-to-bal",title:"Move DisplayInternalUI from Core to BalExtension",description:"User stories",source:"@site/docs/development/wips/6164-move-displayinternalui-from-core-to-bal.md",sourceDirName:"development/wips",slug:"/development/wips/move-displayinternalui-from-core-to-bal",permalink:"/wixtoolset/docs/development/wips/move-displayinternalui-from-core-to-bal",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/6164-move-displayinternalui-from-core-to-bal.md",tags:[],version:"current",sidebarPosition:6164,frontMatter:{wip:6164,type:"Feature",by:"Sean Hall (r sean hall at gmail.com)",title:"Move DisplayInternalUI from Core to BalExtension",draft:!1},sidebar:"docsSidebar",previous:{title:"Burn restart with elevated process",permalink:"/wixtoolset/docs/development/wips/burn-restart-with-elevated-process"},next:{title:"Create element for custom BA and BE data",permalink:"/wixtoolset/docs/development/wips/burn-custom-table"}},u={},d=[{value:"User stories",id:"user-stories",level:2},{value:"Background",id:"background",level:2},{value:"Proposal - Burn",id:"proposal---burn",level:2},{value:"Proposal - wixstdba",id:"proposal---wixstdba",level:2},{value:"Proposal - UI.wixext",id:"proposal---uiwixext",level:2},{value:"Considerations",id:"considerations",level:2},{value:"See Also",id:"see-also",level:2}],c={toc:d},m="wrapper";function h(e){var{components:t}=e,n=i(e,["components"]);return(0,a.kt)(m,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},c,n),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"user-stories"},"User stories"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"As a Setup developer I can have more control over when my bundle shows the MSI UI such that I can keep using my existing MSI UI.")),(0,a.kt)("h2",{id:"background"},"Background"),(0,a.kt)("p",null,"I looked through the wix-users list and users are asking for everything between ",(0,a.kt)("inlineCode",{parentName:"p"},"DisplayInternalUI")," being configurable at runtime and wanting the full MSI UI for every operation (install/modify/repair/uninstall).\nThere are 3 different approaches we can take in v4 for Burn."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Remove ",(0,a.kt)("inlineCode",{parentName:"p"},"DisplayInternalUI")," entirely. This enforces the design decision for Burn that there should be one unified UI for the bundle (documented in ",(0,a.kt)("a",{parentName:"p",href:"http://robmensching.com/blog/posts/2012/6/25/b-is-for-bundle-and-thats-good-enough-for-me/"},"http://robmensching.com/blog/posts/2012/6/25/b-is-for-bundle-and-thats-good-enough-for-me/")," and ",(0,a.kt)("a",{parentName:"p",href:"http://www.joyofsetup.com/2013/07/05/burn-zero-one-or-n/"},"http://www.joyofsetup.com/2013/07/05/burn-zero-one-or-n/"),").")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Continue with the v3 design of ",(0,a.kt)("inlineCode",{parentName:"p"},"DisplayInternalUI")," - allow the MSI UI to be shown, but the Burn engine will ensure that the user/MSI can only do what was planned.\nThe basic idea to implement this approach is to expose ",(0,a.kt)("inlineCode",{parentName:"p"},"MsiEngineCalculateInstallUiLevel")," as a BA message, but disallow certain UI levels when not doing an install.\nThis satisfies some user requests but many want full MSI UI during maintenance operations, e.g. feature selection during Modify.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Allow the BA full control of the UI level of the MSI, even if that means the user/MSI ends up doing something other than what was planned.\nThe basic idea to implement this approach is to expose ",(0,a.kt)("inlineCode",{parentName:"p"},"MsiEngineCalculateInstallUiLevel")," as a BA message, and allow disabling the Burn external UI handler to support EmbeddedUI.\nThis should satisfy all user requests, or at least enable them to build a BA that can do what they want."))),(0,a.kt)("p",null,"If we take #3 for Burn, then there are 3 similar approaches we can take for wixstdba."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Remove support for displaying MSI UI.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Continue with the v3 design of ",(0,a.kt)("inlineCode",{parentName:"p"},"DisplayInternalUI"),".\nThe basic idea behind this approach is to use the same logic that v3 Burn used to restrict uiLevel, so MSI UI is can only be shown during install.\nThe external UI handler is always used.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Allow the Setup developer to show MSI UI during non-install operations."))),(0,a.kt)("h2",{id:"proposal---burn"},"Proposal - Burn"),(0,a.kt)("p",null,"Take approach #3. Add new event for OnPlanMsiPackage:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"enum BURN_MSI_PROPERTY\n{\n    BURN_MSI_PROPERTY_NONE,     // no property added\n    BURN_MSI_PROPERTY_INSTALL,  // add BURNMSIINSTALL=1\n    BURN_MSI_PROPERTY_MODIFY,   // add BURNMSIMODIFY=1\n    BURN_MSI_PROPERTY_REPAIR,   // add BURNMSIREPAIR=1\n    BURN_MSI_PROPERTY_UNINSTALL,// add BURNMSIUNINSTALL=1\n};\n\nstruct BA_ONPLANMSIPACKAGE_ARGS\n{\n    DWORD cbSize;\n    LPCWSTR wzPackageId;\n    BOOL fExecute; // false means rollback.\n    BOOTSTRAPPER_ACTION_STATE action;\n};\n\nstruct BA_ONPLANMSIPACKAGE_RESULTS\n{\n    DWORD cbSize;\n    BOOL fCancel;\n    BURN_MSI_PROPERTY actionMsiProperty;\n    INSTALLUILEVEL uiLevel;\n    BOOL fDisableExternalUiHandler;\n};\n")),(0,a.kt)("p",null,"Burn will:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Call ",(0,a.kt)("inlineCode",{parentName:"li"},"OnPlanMsiPackage")," for each MSI or MSP package authored in the chain, somewhere between ",(0,a.kt)("inlineCode",{parentName:"li"},"OnPlanPackageBegin")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"OnPlanPackageComplete"),"."),(0,a.kt)("li",{parentName:"ul"},"Default ",(0,a.kt)("inlineCode",{parentName:"li"},"actionMsiProperty")," based on the planned action."),(0,a.kt)("li",{parentName:"ul"},"Always default ",(0,a.kt)("inlineCode",{parentName:"li"},"uiLevel")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"INSTALLUILEVEL_NONE | INSTALLUILEVEL_SOURCERESONLY"),"."),(0,a.kt)("li",{parentName:"ul"},"Always default ",(0,a.kt)("inlineCode",{parentName:"li"},"fDisableExternalUiHandler")," to false."),(0,a.kt)("li",{parentName:"ul"},"Provide ",(0,a.kt)("inlineCode",{parentName:"li"},"uiLevel")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"fDisableExternalUiHandler")," in ",(0,a.kt)("inlineCode",{parentName:"li"},"BA_ONEXECUTEPACKAGEBEGIN_ARGS")," so the BA doesn't have to keep track of what it chose during plan.")),(0,a.kt)("h2",{id:"proposal---wixstdba"},"Proposal - wixstdba"),(0,a.kt)("p",null,"Take approach #3.\nMove the ",(0,a.kt)("inlineCode",{parentName:"p"},"DisplayInternalUI")," attribute into the ",(0,a.kt)("inlineCode",{parentName:"p"},"BalExtension"),".\nModify the attribute to take a condition so that it can be configured at runtime, and rename it to ",(0,a.kt)("inlineCode",{parentName:"p"},"DisplayInternalUICondition"),".\nIf not specified, then internal UI will never be shown.\nThe same condition is used for all operations.\nwixstdba will not change the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"actionMsiProperty"),".\nwixstdba will not support EmbeddedUI so it will not change the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"fDisableExternalUiHandler"),".\nThis is because if the Setup developer has the resources to implement embedded UI, then they should spend those resources creating a custom theme for wixstdba or create a custom BA."),(0,a.kt)("h2",{id:"proposal---uiwixext"},"Proposal - UI.wixext"),(0,a.kt)("p",null,"Teach all of the built-in UIs in UI.wixext about the new ",(0,a.kt)("inlineCode",{parentName:"p"},"BURNMSIINSTALL"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"BURNMSIMODIFY"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"BURNMSIREPAIR"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"BURNMSIUNINSTALL")," properties so that users are required to choose the same action they chose in the BA UI."),(0,a.kt)("h2",{id:"considerations"},"Considerations"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"There are plans for adding a new built-in BA that will support EmbeddedUI."),(0,a.kt)("li",{parentName:"ul"},"Making Burn default ",(0,a.kt)("inlineCode",{parentName:"li"},"uiLevel")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"INSTALLUILEVEL_NONE | INSTALLUILEVEL_SOURCERESONLY")," may change in the future since ",(0,a.kt)("inlineCode",{parentName:"li"},"INSTALLUILEVEL_SOURCERESONLY")," might cause dialogs to be shown even if the bundle is supposed to be quiet.")),(0,a.kt)("h2",{id:"see-also"},"See Also"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/wixtoolset/issues/issues/6164"},"WIXFEAT:6164")))}h.isMDXComponent=!0}}]);