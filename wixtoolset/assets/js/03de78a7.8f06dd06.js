"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[49802],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),u=a,f=d["".concat(p,".").concat(u)]||d[u]||m[u]||r;return n?o.createElement(f,i(i({ref:t},c),{},{components:n})):o.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},40917:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>f,frontMatter:()=>l,metadata:()=>s,toc:()=>d});n(67294);var o=n(3905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const l={sidebar_position:30},p="Code Style",s={unversionedId:"development/code-style",id:"development/code-style",title:"Code Style",description:"This document defines the WiX code style that is adapted from original source code developed at Microsoft. This is a living document and you will find older source in the repository that do not adhere to all of the guidelines in this document. When relevant to do so please fix the code to match this document.",source:"@site/docs/development/code-style.md",sourceDirName:"development",slug:"/development/code-style",permalink:"/wixtoolset/docs/development/code-style",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/code-style.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{sidebar_position:30},sidebar:"docsSidebar",previous:{title:"WiX Improvement Proposals",permalink:"/wixtoolset/docs/development/wix-improvement-proposal"},next:{title:"WIPs",permalink:"/wixtoolset/docs/category/wips"}},c={},d=[],m={toc:d},u="wrapper";function f(e){var{components:t}=e,n=i(e,["components"]);return(0,o.kt)(u,r(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){a(e,t,n[t])}))}return e}({},m,n),{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"code-style"},"Code Style"),(0,o.kt)("p",null,"This document defines the WiX code style that is adapted from original source code developed at Microsoft. This is a living document and you will find older source in the repository that do not adhere to all of the guidelines in this document. When relevant to do so please fix the code to match this document."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Do not use tabs - only spaces.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The left indent should be four spaces.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Insignificant whitespace (whitespace to the right of text) should be reduced to one space in all cases except ",(0,o.kt)("em",{parentName:"p"},"maybe")," comments."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"// Good\nint a = 0;\nDWORD dw = 0; // this exists for some good reason\n\n// Bad\nint   a  = 0;\nDWORD dw = 0;   // this exists for some good reason\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Control flow operators get one space after them while functions do not."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"// Good\nif (x)\n{\n    func(x, y, z);\n}\n\ndo\n{\n    // do something to change fGo eventually\n} while (fGo);\n\n// Bad\nif( x )\n{\n    func ( x, y, z );\n}\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Braces are always left justified."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"// Good\nHRESULT FunctionName(int a)\n{\n    int b = 0;\n    int c = 0;\n\n    if (0 == a)\n    {\n        b = 1;\n        c = 2;\n    }\n}\n\n// Bad\nHRESULT FunctionName(int a) {\n    int a = 0;\n    int b = 0;\n\n    if (0 == a)\n        {\n        b = 1;\n        c = 2;\n        }\n}\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Braces are always used, even when optional."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"// Good\nif (fBar)\n{\n    a = 1;\n}\n\n// Bad\nif (fBar)\n    a = 1;\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Function definitions should look something like these examples."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'// Good\nvoid FunctionName();\n\nextern "C" HRESULT __stdcall FunctionName(\n    __in LPCWSTR wzFoo,\n    __out BOOL *pfBar\n    );\n\n// Bad\nvoid FunctionName(\n    );\n\nextern "C"\nHRESULT\n__stdcall\nFunctionName(\n    __in LPCWSTR szFoo,\n    __out BOOL *pfBar\n    );\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Use prefix addition and subtraction except where postfix addition or subtraction is absolutely required. Avoid postfix in general to avoid side effects."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"// Good\nfor (int i = 0; i < 10; ++i)\n{\n}\n\n// Bad\nfor (int i = 0; i < 10; i++)\n{\n}\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Infinite loops should be rare but when necessary use an empty for loop and remember the braces."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"// Example infinite loop required for some reason\nfor (;;)\n{\n    // eventually break\n}\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383701.aspx"},"SAL")," annotation is required on all function parameters.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Functions should have only one of the following return types: ",(0,o.kt)("inlineCode",{parentName:"p"},"void"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOL"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"HRESULT"),". ",(0,o.kt)("inlineCode",{parentName:"p"},"void")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOL")," functions can never fail. If they could fail, change the return type to an ",(0,o.kt)("inlineCode",{parentName:"p"},"HRESULT"),". You will find lots of wrapper functions in ",(0,o.kt)("em",{parentName:"p"},"dutil.lib")," that all return ",(0,o.kt)("inlineCode",{parentName:"p"},"HRESULT"),'s. The only exception to this rule is that "uninitialize"-type functions should return ',(0,o.kt)("inlineCode",{parentName:"p"},"void"),". Work hard to remove any failure cases in the uninitialize route and, if unsuccessful, carefully consider what implications a failed uninitialize route has. Consider ",(0,o.kt)("inlineCode",{parentName:"p"},"::RevertToSelf()")," as an example.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The C++ type ",(0,o.kt)("inlineCode",{parentName:"p"},"bool")," is never used. Use ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOL")," instead.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Functions that are from a public SDK should be prefixed with the global namespace scope operator ",(0,o.kt)("inlineCode",{parentName:"p"},"::"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Use the ",(0,o.kt)("inlineCode",{parentName:"p"},"countof()")," macro (defined in ",(0,o.kt)("em",{parentName:"p"},"dutil.h"),") to get the number of elements in an array. Consider this a sibling of the ",(0,o.kt)("inlineCode",{parentName:"p"},"sizeof()")," language operator.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"There should only be one exit from a function. An exception to this is error checking that can circumvent significant variable initialization by existing immediately at the top of the function.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Local variables should be initialized at the top of the function. If the local variable is not initialized to zero add a comment why.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'The l-value in conditional tests should be the constant value whenever possible. To some people this makes the logic look "backward" but prevents accidental assignment in native code. After a while, other ways start looking wrong.'),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"// Example\nif (1 == i)\n{\n    ++i;\n}\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'There are two "',(0,o.kt)("a",{parentName:"p",href:"http://blogs.msdn.com/b/oldnewthing/archive/2005/01/06/347666.aspx"},"secret handshakes"),'" in the WiX code style. First, the ',(0,o.kt)("inlineCode",{parentName:"p"},"ExitOnXxx()"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"ExitWithXxx()"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"ExitFunction()")," macros are used to simplify code flow. Never use an explicit ",(0,o.kt)("inlineCode",{parentName:"p"},"goto"),". Second, the ",(0,o.kt)("inlineCode",{parentName:"p"},"ReleaseXxx()")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"ReleaseNullXxx()")," macros are used extensively to clean up dynamically allocated memory when the function exits."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'// Example\nHRESULT FunctionName()\n{\n    HRESULT hr = S_OK;\n    IUnknown *pObject = NULL;\n    LPVOID pv = NULL;\n    WCHAR wzPAth[MAX_PATH] = { };\n\n    pv = MemAlloc(50, TRUE);\n    ExitOnNull(pv, hr, E_OUTOFMEMORY, "Failed to allocate pointer to nothing.");\n\n    hr = ::CoCreateInstance(IID_IUnknown, &pObject);\n    ExitOnFailure(hr, "Failed to get fake COM object.");\n\n    if (!::GetTempPath(wzPath, countof(wzPath)))\n    {\n        ExitWithLastError(hr, "Failed to get TEMP path.");\n    }\n\nLExit: // this is always present when control flow is used\n    ReleaseObject(pObject);\n    ReleaseMem(pv);\n\n    return hr;\n}\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'The WiX support libraries make extensive use of dynamic strings. Use these string extensively instead of constant buffers or other mechanisms. You should use Hungarian notation for dynamic strings to change from "pwz" (pointer to a null-terminated string) to "scz" (for counted null-terminated string). This will make it easier to read "pointer to dynamically-allocated string" ("pscz" instead of "ppwz").')),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Use Hungarian notation for native code but don't go overboard with it. Sometimes just ",(0,o.kt)("inlineCode",{parentName:"p"},"pProperName")," is just fine for an object that you are pointing at."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"BOOL f = FALSE;\nint i = 0;\nlong l = 0;\nDWORD dw = 0;\nLPVOID pv = NULL;\nFUNCTION_PTR pfn = NULL;\nHRESULT hr = S_OK;\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Use the COM ",(0,o.kt)("inlineCode",{parentName:"p"},"IUnknown")," pattern for lifetime management of objects. ",(0,o.kt)("inlineCode",{parentName:"p"},"AddRef()")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Release()")," are not perfect but they are better than any other memory tracking operations we've found have in native code.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"WiX code style for managed code follows ",(0,o.kt)("a",{parentName:"p",href:"http://stylecop.codeplex.com/"},"StyleCop")," definitions. Most of the above native code has actually morphed gently to match StyleCop suggested design (i.e. no tabs, four spaces)."))))}f.isMDXComponent=!0}}]);