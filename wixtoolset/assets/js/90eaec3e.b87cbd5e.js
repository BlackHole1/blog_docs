"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[91961],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>h});var o=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=o.createContext({}),u=function(e){var t=o.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},d=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=u(r),m=n,h=p["".concat(l,".").concat(m)]||p[m]||c[m]||a;return r?o.createElement(h,i(i({ref:t},d),{},{components:r})):o.createElement(h,i({ref:t},d))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,i=new Array(a);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:n,i[1]=s;for(var u=2;u<a;u++)i[u]=r[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}m.displayName="MDXCreateElement"},77959:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>u,toc:()=>p});r(67294);var o=r(3905);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function i(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const s={},l="How To: Implement a Major Upgrade In Your Installer",u={unversionedId:"howtos/updates/major_upgrade",id:"version-v3/howtos/updates/major_upgrade",title:"How To: Implement a Major Upgrade In Your Installer",description:"When creating an .msi-based installer, you are strongly encouraged to include logic that supports Windows Installer major upgrades. Major upgrades are the most common form of updates for .msi's, and including support in your initial .msi release gives you flexibility in the future. Without including support for major upgrades you risk greatly complicating your distribution story if you ever need to release updates later on.",source:"@site/versioned_docs/version-v3/howtos/updates/major_upgrade.md",sourceDirName:"howtos/updates",slug:"/howtos/updates/major_upgrade",permalink:"/wixtoolset/docs/v3/howtos/updates/major_upgrade",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/versioned_docs/version-v3/howtos/updates/major_upgrade.md",tags:[],version:"v3",frontMatter:{}},d={},p=[{value:"Step 1: Add upgrade information needed to cause new versions to upgrade older versions",id:"step-1-add-upgrade-information-needed-to-cause-new-versions-to-upgrade-older-versions",level:2},{value:"Add a unique ID to identify that the product can be upgraded",id:"add-a-unique-id-to-identify-that-the-product-can-be-upgraded",level:3},{value:"Schedule the removal of old versions and handle out-of-order installations",id:"schedule-the-removal-of-old-versions-and-handle-out-of-order-installations",level:3},{value:"Step 2: Build version 1 and version 2 of your .msi",id:"step-2-build-version-1-and-version-2-of-your-msi",level:2},{value:"Step 3: Test upgrade scenarios before you ship version 1",id:"step-3-test-upgrade-scenarios-before-you-ship-version-1",level:2}],c={toc:p},m="wrapper";function h(e){var{components:t}=e,r=i(e,["components"]);return(0,o.kt)(m,a(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){n(e,t,r[t])}))}return e}({},c,r),{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"how-to-implement-a-major-upgrade-in-your-installer"},"How To: Implement a Major Upgrade In Your Installer"),(0,o.kt)("p",null,"When creating an .msi-based installer, you are strongly encouraged to include logic that supports ",(0,o.kt)("a",{href:"http://msdn.microsoft.com/library/aa369786.aspx",target:"_blank"},"Windows Installer major upgrades"),". Major upgrades are the most common form of updates for .msi's, and including support in your initial .msi release gives you flexibility in the future. Without including support for major upgrades you risk greatly complicating your distribution story if you ever need to release updates later on."),(0,o.kt)("p",null,"You can use the following steps to enable major upgrades in your .msi, build multiple versions of your .msi and test major upgrade scenarios."),(0,o.kt)("h2",{id:"step-1-add-upgrade-information-needed-to-cause-new-versions-to-upgrade-older-versions"},"Step 1: Add upgrade information needed to cause new versions to upgrade older versions"),(0,o.kt)("p",null,"In order to allow major upgrades, you must include the following information in your .msi:"),(0,o.kt)("h3",{id:"add-a-unique-id-to-identify-that-the-product-can-be-upgraded"},"Add a unique ID to identify that the product can be upgraded"),(0,o.kt)("p",null,"To accomplish this, you must include an UpgradeCode attribute in your ",(0,o.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/xsd/wix/product"},"Product")," element. This looks like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<Product Id="*"\n         UpgradeCode="PUT-GUID-HERE"\n         Name="My Application Name"\n         Language="1033"\n         Version="1.0.1"\n         Manufacturer="My Manufacturer Name"/>\n')),(0,o.kt)("h3",{id:"schedule-the-removal-of-old-versions-and-handle-out-of-order-installations"},"Schedule the removal of old versions and handle out-of-order installations"),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/xsd/wix/majorupgrade"},"MajorUpgrade")," element upgrades all older versions of the .msi. By default, it prevents out-of-order installations: installing an older version after installing a newer version."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<MajorUpgrade\n  DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit.">\n')),(0,o.kt)("p",null,"There are several options for where you can schedule the ",(0,o.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/xsd/wix/removeexistingproducts"},"RemoveExistingProducts")," action to remove old versions of the .msi. You need to review the options and choose the one that makes the most sense for your scenarios. You can find a summary of the options in the ",(0,o.kt)("a",{href:"http://msdn.microsoft.com/library/aa371197.aspx",target:"_blank"},"RemoveExistingProducts documentation"),"."),(0,o.kt)("p",null,"By default, MajorUpgrade schedules RemoveExistingProducts after InstallValidate. You can change the scheduling using the Schedule attribute. For example, If you choose to schedule it after ",(0,o.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/xsd/wix/installinitialize"},"InstallInitialize"),", it will look like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<MajorUpgrade\n  Schedule="afterInstallInitialize"\n  DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit.">\n')),(0,o.kt)("p",null,"Windows Installer looks for other installed .msi files with the same UpgradeCode value during the ",(0,o.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/xsd/wix/findrelatedproducts"},"FindRelatedProducts")," action. If you do not specifically schedule the ",(0,o.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/xsd/wix/findrelatedproducts"},"FindRelatedProducts")," action in your setup authoring, WiX will automatically schedule it for you when it creates your .msi."),(0,o.kt)("h2",{id:"step-2-build-version-1-and-version-2-of-your-msi"},"Step 2: Build version 1 and version 2 of your .msi"),(0,o.kt)("p",null,"Creating version 1 of your .msi is as simple as running your standard build process - this means you compile and link it with the WiX toolset. In order to create version 2 of your .msi, you must make the following changes to your setup authoring, then re-run your build process to create a new .msi:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Increment the Version value in your ",(0,o.kt)("a",{parentName:"li",href:"/wixtoolset/docs/v3/xsd/wix/product"},"Product")," element to be higher than any previous versions that you have shipped. Windows Installer only uses the first 3 parts of the version in upgrade scenarios, so make sure to increment your version such that one of the first 3 parts is higher than any previously shipped version. For example, if your version 1 uses Version value 1.0.1.0, then version 2 should have a Version value of 1.0.2.0 or higher (1.0.1.1 will not work here)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/wixtoolset/docs/v3/howtos/general/generate_guids"},"Generate a new Id value")," in the ",(0,o.kt)("a",{parentName:"li",href:"/wixtoolset/docs/v3/xsd/wix/product"},"Product")," element of the new version of the .msi.")),(0,o.kt)("h2",{id:"step-3-test-upgrade-scenarios-before-you-ship-version-1"},"Step 3: Test upgrade scenarios before you ship version 1"),(0,o.kt)("p",null,"This step is very important and is too often ignored. In order to make sure that upgrade scenarios will behave the way you expect, you should test upgrades before you ship the first version of your .msi. There are some upgrade-related bugs that can be fixed purely by making fixes in version 2 or higher of your .msi, but there are some bugs that affect the uninstall of version 1 that must be fixed before you ship version 1. Once version 1 ships, you are essentially locked into the uninstall behavior that you ship with version 1, and that impacts major upgrade scenarios because Windows Installer performs an uninstall of version 1 behind the scenes during version 2 installation."),(0,o.kt)("p",null,"Here are some interesting scenarios to test:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Install version 1, then install version 2.  Make sure that version 1 is correctly removed and version 2 functions correctly.  Make sure version 2 cleanly uninstalls afterwards."),(0,o.kt)("li",{parentName:"ul"},"Install version 2, then try to install version 1.  Make sure that version 1 correctly detects that version 2 is already installed and either blocks or silently exits, depending on what behavior you choose to implement for your out-of-order installation scenarios.")),(0,o.kt)("p",null,"When testing major upgrade scenarios, make sure to pay particular attention to the conditions on custom actions in your .msi because you may run into issues caused by custom actions running during a major upgrade uninstall and leaving your product in a partially installed state. The ",(0,o.kt)("a",{href:"http://msdn.microsoft.com/library/aa372380.aspx",target:"_blank"},"UPGRADINGPRODUCTCODE property")," can be useful to prevent actions from running during an uninstall that is invoked by the ",(0,o.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/xsd/wix/removeexistingproducts"},"RemoveExistingProducts")," action."),(0,o.kt)("p",null,"In addition, pay attention to assemblies that need to be installed to the GAC or the Win32 WinSxS store. There is some information about a sequence of events that can remove assemblies from the GAC and the WinSxS store during some major upgrades in ",(0,o.kt)("a",{href:"http://support.microsoft.com/kb/905238",target:"_blank"},"this knowledge base article"),"."))}h.isMDXComponent=!0}}]);