"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[2388],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>b});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var p=a.createContext({}),s=function(e){var t=a.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=s(r),m=n,b=u["".concat(p,".").concat(m)]||u[m]||d[m]||i;return r?a.createElement(b,o(o({ref:t},c),{},{components:r})):a.createElement(b,o({ref:t},c))}));function b(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,o=new Array(i);o[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[u]="string"==typeof e?e:n,o[1]=l;for(var s=2;s<i;s++)o[s]=r[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},80352:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>b,frontMatter:()=>l,metadata:()=>s,toc:()=>u});r(67294);var a=r(3905);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function o(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const l={wip:4161,type:"Feature",by:"r.sean.hall at gmail dot com",title:"Allow More Than One MBA Prerequisite",draft:!1},p=void 0,s={unversionedId:"development/wips/allow-more-than-one-mbaprereq",id:"development/wips/allow-more-than-one-mbaprereq",title:"Allow More Than One MBA Prerequisite",description:"User stories",source:"@site/docs/development/wips/4161-allow-more-than-one-mbaprereq.md",sourceDirName:"development/wips",slug:"/development/wips/allow-more-than-one-mbaprereq",permalink:"/wixtoolset/docs/development/wips/allow-more-than-one-mbaprereq",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/4161-allow-more-than-one-mbaprereq.md",tags:[],version:"current",sidebarPosition:4161,frontMatter:{wip:4161,type:"Feature",by:"r.sean.hall at gmail dot com",title:"Allow More Than One MBA Prerequisite",draft:!1},sidebar:"docsSidebar",previous:{title:"thmutil variable support",permalink:"/wixtoolset/docs/development/wips/thmutil-variable-support"},next:{title:"Redesign RemotePayload",permalink:"/wixtoolset/docs/development/wips/redesign-remote-payload"}},c={},u=[{value:"User stories",id:"user-stories",level:2},{value:"Current State",id:"current-state",level:2},{value:"Proposal",id:"proposal",level:2},{value:"Proposal - 3.x",id:"proposal---3x",level:2},{value:"Proposal - 4.x",id:"proposal---4x",level:2},{value:"Considerations",id:"considerations",level:2},{value:"See Also",id:"see-also",level:2}],d={toc:u},m="wrapper";function b(e){var{components:t}=e,r=o(e,["components"]);return(0,a.kt)(m,i(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){n(e,t,r[t])}))}return e}({},d,r),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"user-stories"},"User stories"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"As a setup developer I can create a managed BA and depend on the mbaprereq BA to install more than one dependency, not just .NET.")),(0,a.kt)("h2",{id:"current-state"},"Current State"),(0,a.kt)("p",null,"Currently, the mbaprereq BA only supports installing one package.  The WixBalExtension provides the package identity of that package in the custom BootstrapperApplicationData table WixMbaPrereqInformation.  It populates the single row in the table by using Wix binder variables:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"<Fragment>\n    <PayloadGroup Id='MbaPreqLicenseUrlMinimal'>\n        <Payload Name='mbapreq.dll' Compressed='yes' SourceFile='wixstdba.dll' />\n    </PayloadGroup>\n\n    <CustomTable Id='WixMbaPrereqInformation'>\n        <Row>\n            <Data Column='PackageId'>!(wix.WixMbaPrereqPackageId)</Data>\n            <Data Column='LicenseUrl'>!(wix.WixMbaPrereqLicenseUrl)</Data>\n        </Row>\n    </CustomTable>\n</Fragment>\n\n<Fragment>\n    <PayloadGroup Id='MbaPreqLicenseFileMinimal'>\n        <Payload Name='mbapreq.dll' Compressed='yes' SourceFile='wixstdba.dll' />\n    </PayloadGroup>\n\n    <CustomTable Id='WixMbaPrereqInformation'>\n        <Row>\n            <Data Column='PackageId'>!(wix.WixMbaPrereqPackageId)</Data>\n            <Data Column='LicenseFile'>!(wix.WixMbaPrereqLicenseRtf)</Data>\n        </Row>\n    </CustomTable>\n</Fragment>\n")),(0,a.kt)("h2",{id:"proposal"},"Proposal"),(0,a.kt)("p",null,"Because the row was authored using Wix binder variables, the WixBalExtension cannot get rid of that authoring in 3.x and be fully backwards compatible. Therefore, adding support for multiple prerequisite packages will be implemented differently between 3.x and 4.x."),(0,a.kt)("h2",{id:"proposal---3x"},"Proposal - 3.x"),(0,a.kt)("p",null,"Add support to the WixBalExtension to allow a ",(0,a.kt)("inlineCode",{parentName:"p"},"PrereqSupportPackage")," attribute on all XxxPackage elements.  When set to ",(0,a.kt)("inlineCode",{parentName:"p"},"yes"),", the extension will add the package identity to the ",(0,a.kt)("inlineCode",{parentName:"p"},"MbaPrequisiteSupportPackage")," table. The MbaPrequisiteSupportPackage table will be marked with ",(0,a.kt)("inlineCode",{parentName:"p"},"bootstrapperApplicationData='yes'")," such that the prerequisite package identities will be stored in the ",(0,a.kt)("inlineCode",{parentName:"p"},"BootstrapperApplicationData.xml")," file."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"<Chain>\n  <ExePackage Id='MyPrequisitePackage' bal:PrereqSupportPackage='yes' ... />\n  <MsiPackage Id='MyOtherPackage' ... />\n</Chain>\n")),(0,a.kt)("p",null,"The mbaprereq BA will use the prerequisite package identities from the BootstrapperApplicationData.xml as the list of packages to allow to be installed. In other words, during Plan() the mbaprereq BA will request a prerequisite package to be installed, ",(0,a.kt)("inlineCode",{parentName:"p"},"BOOTSTRAPPER_REQUEST_STATE_PRESENT"),",  and all other packages to none, ",(0,a.kt)("inlineCode",{parentName:"p"},"BOOTSTRAPPER_REQUEST_STATE_NONE"),". The package's ",(0,a.kt)("inlineCode",{parentName:"p"},"InstallCondition")," will be respected."),(0,a.kt)("p",null,"For backwards compatibility, the ",(0,a.kt)("inlineCode",{parentName:"p"},"WixMbaPrereqPackageId")," binder variable (and its licence friends) will still be required. Note that because the original implementation of the mbaprereq BA always installed the package, it will continue to do so. However, the bundle can opt in to the new behavior of respecting the ",(0,a.kt)("inlineCode",{parentName:"p"},"InstallCondition")," by setting the new ",(0,a.kt)("inlineCode",{parentName:"p"},"PrereqSupportPackage")," attribute to ",(0,a.kt)("inlineCode",{parentName:"p"},"yes")," on the package.  I don't know why I previously thought that it couldn't do this; using the new attribute means they should be familiar with the new behavior."),(0,a.kt)("h2",{id:"proposal---4x"},"Proposal - 4.x"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Remove the ",(0,a.kt)("inlineCode",{parentName:"li"},"WixMbaPrereqPackageId"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"WixMbaPrereqLicenseUrl"),", and ",(0,a.kt)("inlineCode",{parentName:"li"},"WixMbaPrereqLicenseRtf")," binder variables."),(0,a.kt)("li",{parentName:"ul"},"Remove the ",(0,a.kt)("inlineCode",{parentName:"li"},"LicenseFile"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"LicenseUrl"),", and ",(0,a.kt)("inlineCode",{parentName:"li"},"NetFxPackageId")," attributes from the ",(0,a.kt)("inlineCode",{parentName:"li"},"WixManagedBootstrapperApplicationHost")," element."),(0,a.kt)("li",{parentName:"ul"},"Rename the ",(0,a.kt)("inlineCode",{parentName:"li"},"PrereqSupportPackage")," attribute to ",(0,a.kt)("inlineCode",{parentName:"li"},"PrereqPackage"),", since all prereq packages will be equal."),(0,a.kt)("li",{parentName:"ul"},"Create ",(0,a.kt)("inlineCode",{parentName:"li"},"PrereqLicenseUrl")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"PrereqLicenseRtf")," attributes that go on XxxPackage elements (just like the ",(0,a.kt)("inlineCode",{parentName:"li"},"PrereqPackage")," element). At most one can be specified."),(0,a.kt)("li",{parentName:"ul"},"Delete the ",(0,a.kt)("inlineCode",{parentName:"li"},"MbaPrerequisiteSupportPackage")," table.  This will require removing the assumption that there is always exactly one row in the ",(0,a.kt)("inlineCode",{parentName:"li"},"WixMbaPrereqInformation")," table."),(0,a.kt)("li",{parentName:"ul"},"Figure out how to ensure there is at least one prereq package, at most one prereq package has a License attribute, and the type of the license attribute matches the type of WixManagedBootstrapperApplicationHost that was chosen.")),(0,a.kt)("h2",{id:"considerations"},"Considerations"),(0,a.kt)("h2",{id:"see-also"},"See Also"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"http://wixtoolset.org/issues/4161"},"WIXFEAT:4161")))}b.isMDXComponent=!0}}]);