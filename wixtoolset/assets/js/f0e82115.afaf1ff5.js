"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[75808],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(67294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},f=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),u=p(r),f=i,m=u["".concat(l,".").concat(f)]||u[f]||d[f]||o;return r?n.createElement(m,s(s({ref:t},c),{},{components:r})):n.createElement(m,s({ref:t},c))}));function m(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,s=new Array(o);s[0]=f;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a[u]="string"==typeof e?e:i,s[1]=a;for(var p=2;p<o;p++)s[p]=r[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}f.displayName="MDXCreateElement"},81523:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>p,toc:()=>u});r(67294);var n=r(3905);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const a={wip:6401,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Source patch files from MSIs"},l=void 0,p={unversionedId:"development/wips/source-patch-files-from-msi",id:"development/wips/source-patch-files-from-msi",title:"Source patch files from MSIs",description:"User stories",source:"@site/docs/development/wips/6401-source-patch-files-from-msi.md",sourceDirName:"development/wips",slug:"/development/wips/source-patch-files-from-msi",permalink:"/wixtoolset/docs/development/wips/source-patch-files-from-msi",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/6401-source-patch-files-from-msi.md",tags:[],version:"current",sidebarPosition:6401,frontMatter:{wip:6401,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Source patch files from MSIs"},sidebar:"docsSidebar",previous:{title:"Cleanup Bundle After Quit",permalink:"/wixtoolset/docs/development/wips/cleanup-bundle-after-quit"},next:{title:"Improved patch filtering",permalink:"/wixtoolset/docs/development/wips/improved-patch-filtering"}},c={},u=[{value:"User stories",id:"user-stories",level:2},{value:"Proposal",id:"proposal",level:2},{value:"Considerations",id:"considerations",level:2},{value:"See Also",id:"see-also",level:2}],d={toc:u},f="wrapper";function m(e){var{components:t}=e,r=s(e,["components"]);return(0,n.kt)(f,o(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){i(e,t,r[t])}))}return e}({},d,r),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"user-stories"},"User stories"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"As a setup developer I can create an MSP using my target MSI and updated MSI files.")),(0,n.kt)("h2",{id:"proposal"},"Proposal"),(0,n.kt)("p",null,"In WiX v3, each step of the patch creation process was exposed to the developer. The following is an over simplified set of steps:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The Patch source code is written to define the patch baselines."),(0,n.kt)("li",{parentName:"ol"},"The source code is compiled and linked into an intermediate output."),(0,n.kt)("li",{parentName:"ol"},"The transform between the target and updated MSI/wixpdb is created. This is repeated for each baseline defined in step 1."),(0,n.kt)("li",{parentName:"ol"},"The MSP is created from the intermediate output from step 2 and transforms from step 3 (repeated).")),(0,n.kt)("p",null,"This process has several points where files must be referenced just right or the process fails. There are also strict requirements\nwhere for the source files are expected, requiring an MSI admin image or use of bindpaths on all files in the .wixpdb so they can be re-resolved\nduring patch creation. Additional tooling was provided in later versions of WiX v3, melt.exe, but the patch creation process is very\nbrittle."),(0,n.kt)("p",null,"In WiX v4, the patch process is simplified to a single ",(0,n.kt)("inlineCode",{parentName:"p"},"build")," command of Patch source code. Baselines are still defined in the source code but now\ndirectly reference the target and updated MSI/wixpdb files. This allows the ",(0,n.kt)("inlineCode",{parentName:"p"},"build")," command creates the necessary transforms and the MSP in one pass.\nTo complete the simplification of the patch build process, WiX v4 will not only find files when MSIs admin images and .wixpdb bindpaths but also be\nable extract files from an MSI's cabinets even when embedded."),(0,n.kt)("p",null,"During the ",(0,n.kt)("inlineCode",{parentName:"p"},"build")," process, target and updated files are resolved before the transforms are created. This does require all files to\nbe available when patching in WiX v4, where careful crafting of the patch inputs could mininize the number of files required to be\npresent in WiX v3. Additionally, bind paths are only used to locate files when an .wixpdb is used as the baseline's target and/or updated\ninput. When an MSI is used as the baseline's target and/or updated input, the files must be found relative to the MSI."),(0,n.kt)("h2",{id:"considerations"},"Considerations"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The exposed nature of the patch creation build process in WiX v3, means it was possible to create very intricate processes that may\nnot directly translate in WiX v4. Future versions of WiX may need to introduce additional options to the patch ",(0,n.kt)("inlineCode",{parentName:"li"},"build")," command to\noptimize file handling.")),(0,n.kt)("h2",{id:"see-also"},"See Also"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://wixtoolset.org/issues/6401"},"WIXFEAT:6401"))))}m.isMDXComponent=!0}}]);