"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[92217],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var i=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=i.createContext({}),g=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=g(e.components);return i.createElement(s.Provider,{value:n},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},d=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=g(t),d=a,h=p["".concat(s,".").concat(d)]||p[d]||c[d]||r;return t?i.createElement(h,o(o({ref:n},u),{},{components:t})):i.createElement(h,o({ref:n},u))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,o=new Array(r);o[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var g=2;g<r;g++)o[g]=t[g];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}d.displayName="MDXCreateElement"},23563:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>g,toc:()=>p});t(67294);var i=t(3905);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function o(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const l={sidebar_position:70},s="Signing packages and bundles",g={unversionedId:"tools/signing",id:"tools/signing",title:"Signing packages and bundles",description:"Signing Windows Installer packages",source:"@site/docs/tools/signing.md",sourceDirName:"tools",slug:"/tools/signing",permalink:"/wixtoolset/docs/tools/signing",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/tools/signing.md",tags:[],version:"current",sidebarPosition:70,frontMatter:{sidebar_position:70},sidebar:"docsSidebar",previous:{title:"Preprocessor",permalink:"/wixtoolset/docs/tools/preprocessor"},next:{title:"Windows Installer patches",permalink:"/wixtoolset/docs/tools/patches"}},u={},p=[{value:"Signing Windows Installer packages",id:"signing-windows-installer-packages",level:2},{value:"Signing packages with MSBuild",id:"signing-packages-with-msbuild",level:3},{value:"Signing packages at the command-line",id:"signing-packages-at-the-command-line",level:3},{value:"Signing bundles",id:"signing-bundles",level:2},{value:"Signing bundles with MSBuild",id:"signing-bundles-with-msbuild",level:3},{value:"Signing bundles at the command-line",id:"signing-bundles-at-the-command-line",level:3}],c={toc:p},d="wrapper";function h(e){var{components:n}=e,t=o(e,["components"]);return(0,i.kt)(d,r(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){a(e,n,t[n])}))}return e}({},c,t),{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"signing-packages-and-bundles"},"Signing packages and bundles"),(0,i.kt)("h2",{id:"signing-windows-installer-packages"},"Signing Windows Installer packages"),(0,i.kt)("p",null,"Windows Installer packages can be signed directly by signing tools like Signtool.exe. However, you can also sign cabinets that are external to the .msi file and include those signatures in the .msi so Windows Installer can verify that the cabinets haven't been tampered with."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"If you're including MSI packages with external cabinets in a Burn bundle, it is not necessary to sign the cabinets. Instead, sign the bundle; the bundle includes a manifest that contains hashes for every file in the bundle. The bundle's signature ensures the validity of the manifest and Burn securely verifies the included hashes."),(0,i.kt)("p",{parentName:"admonition"},"If you're embedding the cabinets in their MSI package, signing them is not necessary; just sign the MSI package instead. The signature on the MSI package includes the embedded cabinets.")),(0,i.kt)("h3",{id:"signing-packages-with-msbuild"},"Signing packages with MSBuild"),(0,i.kt)("p",null,"To enable signing, set the ",(0,i.kt)("inlineCode",{parentName:"p"},"SignOutput")," property to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<PropertyGroup>\n  <SignOutput>true</SignOutput>\n</PropertyGroup>\n")),(0,i.kt)("p",null,"To sign external cabinets, create a ",(0,i.kt)("inlineCode",{parentName:"p"},"SignCabs")," target in your .wixproj to call your signing tool:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<Target Name="SignCabs">\n  <Message Importance="high" Text="SignCabs: @(SignCabs)" />\n  <Exec Command=\'signtool.exe sign /v /f $(TestCertificate) /p password %(SignCabs.FullPath)\' />\n</Target>\n')),(0,i.kt)("p",null,"To sign the MSI package, create a ",(0,i.kt)("inlineCode",{parentName:"p"},"SignMsi")," target in your .wixproj to call your signing tool:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<Target Name="SignMsi">\n  <Message Importance="high" Text="SignMsi: @(SignMsi)" />\n  <Exec Command=\'signtool.exe sign /v /f $(TestCertificate) /p password "%(SignMsi.FullPath)" \' />\n</Target>\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"SignMsi")," target updates the MSI package with the signature information of any detached cabinets, then invokes your commands to do the signing."),(0,i.kt)("h3",{id:"signing-packages-at-the-command-line"},"Signing packages at the command-line"),(0,i.kt)("p",null,"The Wix.exe command-line tool lets you update the MSI package with the signature information of any detached cabinets. Signing the cabinets and the MSI package itself is left to your build tooling of choice."),(0,i.kt)("p",null,"To update an MSI package with the signatures of detached cabinets:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"wix msi inscribe path\\to\\package.msi -out path\\to\\inscribedpackage.msi\n")),(0,i.kt)("p",null,"To update an MSI package in-place with the signatures of detached cabinets:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"wix msi inscribe path\\to\\package.msi\n")),(0,i.kt)("h2",{id:"signing-bundles"},"Signing bundles"),(0,i.kt)("p",null,"Signing bundles is slightly more complicated than signing packages because bundles need to be signed in two pieces:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},'The Burn engine, along with the bundle manifest and bootstrapper application, is extracted and cached for repair and uninstall operations. It needs to be signed so that those operations present the user with a "friendly" UAC consent prompt that identifies the bundle and signature.'),(0,i.kt)("li",{parentName:"ol"},"The whole bundle .exe file needs to be signed to ensure that a compressed bundle with embedded packages can be verified.")),(0,i.kt)("p",null,"Signing bundles requires the following flow:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Build the bundle."),(0,i.kt)("li",{parentName:"ol"},"Extract the Burn engine from the bundle."),(0,i.kt)("li",{parentName:"ol"},"Sign the Burn engine."),(0,i.kt)("li",{parentName:"ol"},"Reattach the signed Burn engine to the bundle."),(0,i.kt)("li",{parentName:"ol"},"Sign the whole bundle.")),(0,i.kt)("h3",{id:"signing-bundles-with-msbuild"},"Signing bundles with MSBuild"),(0,i.kt)("p",null,"To enable signing, set the ",(0,i.kt)("inlineCode",{parentName:"p"},"SignOutput")," property to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<PropertyGroup>\n  <SignOutput>true</SignOutput>\n</PropertyGroup>\n")),(0,i.kt)("p",null,"To extract the Burn engine from the bundle, sign it, and reattach it, create a ",(0,i.kt)("inlineCode",{parentName:"p"},"SignBundleEngine")," target in your .wixproj to call your signing tool:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<Target Name="SignBundleEngine">\n  <Message Importance="high" Text="SignBundleEngine: @(SignBundleEngine)" />\n  <Exec Command=\'signtool.exe sign /v /f $(TestCertificate) /p password %(SignBundleEngine.FullPath)\' />\n</Target>\n')),(0,i.kt)("p",null,"To sign the whole bundle, create a ",(0,i.kt)("inlineCode",{parentName:"p"},"SignBundle")," target in your .wixproj to call your signing tool:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<Target Name="SignBundle">\n  <Message Importance="high" Text="SignBundle: @(SignBundle)" />\n  <Exec Command=\'signtool.exe sign /v /f $(TestCertificate) /p password %(SignBundle.FullPath)\' />\n</Target>\n')),(0,i.kt)("h3",{id:"signing-bundles-at-the-command-line"},"Signing bundles at the command-line"),(0,i.kt)("p",null,"To extract the Burn engine from the bundle:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"wix burn detach path\\to\\bundle.exe -engine path\\to\\extracted\\burnengine.exe\n")),(0,i.kt)("p",null,"Then sign path\\to\\extracted\\burnengine.exe."),(0,i.kt)("p",null,"To reattach the signed Burn engine to the bundle:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"wix burn reattach path\\to\\original\\bundle.exe -engine path\\to\\extracted\\burnengine.exe -o path\\to\\full\\bundle.exe\n")),(0,i.kt)("p",null,"Then sign path\\to\\full\\bundle.exe."))}h.isMDXComponent=!0}}]);