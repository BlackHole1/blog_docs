"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[4674],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=a.createContext({}),s=function(e){var t=a.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=s(r),h=n,m=u["".concat(c,".").concat(h)]||u[h]||d[h]||o;return r?a.createElement(m,l(l({ref:t},p),{},{components:r})):a.createElement(m,l({ref:t},p))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,l=new Array(o);l[0]=h;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[u]="string"==typeof e?e:n,l[1]=i;for(var s=2;s<o;s++)l[s]=r[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}h.displayName="MDXCreateElement"},99864:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>u});r(67294);var a=r(3905);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const i={title:"Using Purely WiX",layout:"documentation"},c="Using Purely WiX",s={unversionedId:"patching/wix_patching",id:"version-v3/patching/wix_patching",title:"Using Purely WiX",description:"A patch can be created purely in WiX using the tools named Torch.exe and Pyro.exe. Using these tools eliminates the need to perform administrative installs or even to bind the upgrade product which, for large products, can be exhausting.",source:"@site/versioned_docs/version-v3/patching/wix_patching.md",sourceDirName:"patching",slug:"/patching/wix_patching",permalink:"/wixtoolset/docs/v3/patching/wix_patching",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/versioned_docs/version-v3/patching/wix_patching.md",tags:[],version:"v3",frontMatter:{title:"Using Purely WiX",layout:"documentation"}},p={},u=[{value:"Setting Up the Sample",id:"setting-up-the-sample",level:2},{value:"Create a directory that will contain the sample",id:"create-a-directory-that-will-contain-the-sample",level:3},{value:"Create two subdirectories",id:"create-two-subdirectories",level:3},{value:"Create a text file called Sample.txt for 1.0",id:"create-a-text-file-called-sampletxt-for-10",level:3},{value:"Create a text file called Sample.txt for 1.1",id:"create-a-text-file-called-sampletxt-for-11",level:3},{value:"Create your product authoring in the sample root folder",id:"create-your-product-authoring-in-the-sample-root-folder",level:3},{value:"Create your patch authoring in the sample root",id:"create-your-patch-authoring-in-the-sample-root",level:3},{value:"Building the Patch Sample",id:"building-the-patch-sample",level:2},{value:"Build the target layout",id:"build-the-target-layout",level:3},{value:"Build the upgrade layout",id:"build-the-upgrade-layout",level:3},{value:"Create the transform between your products",id:"create-the-transform-between-your-products",level:3},{value:"Build the patch",id:"build-the-patch",level:3},{value:"Verify the Patch",id:"verify-the-patch",level:2},{value:"Install the 1.0 product",id:"install-the-10-product",level:3},{value:"Verify version 1.0",id:"verify-version-10",level:3},{value:"Install the patch",id:"install-the-patch",level:3},{value:"Verify version 1.1",id:"verify-version-11",level:3},{value:"Uninstall the patch",id:"uninstall-the-patch",level:3},{value:"Uninstall the product",id:"uninstall-the-product",level:3},{value:"Restrictions",id:"restrictions",level:2},{value:"Patch families can only grow",id:"patch-families-can-only-grow",level:3},{value:"Certain elements cannot be added to uninstallable patches",id:"certain-elements-cannot-be-added-to-uninstallable-patches",level:3}],d={toc:u},h="wrapper";function m(e){var{components:t}=e,r=l(e,["components"]);return(0,a.kt)(h,o(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){n(e,t,r[t])}))}return e}({},d,r),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"using-purely-wix"},"Using Purely WiX"),(0,a.kt)("p",null,"A patch can be created purely in WiX using the tools named Torch.exe and Pyro.exe. Using these tools eliminates the need to perform administrative installs or even to bind the upgrade product which, for large products, can be exhausting."),(0,a.kt)("h2",{id:"setting-up-the-sample"},"Setting Up the Sample"),(0,a.kt)("p",null,"A sample product is created which puts different resources into fragments. You put resources into separate fragments so that the resources in each fragment can be filtered out of a patch. You might filter some resources out of a patch if you want to limit the patch to update only parts of your product or products."),(0,a.kt)("h3",{id:"create-a-directory-that-will-contain-the-sample"},"Create a directory that will contain the sample"),(0,a.kt)("p",null,"Create a directory from which you plan to run the sample. This will be the sample root."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"md C:\\sample\n")),(0,a.kt)("h3",{id:"create-two-subdirectories"},"Create two subdirectories"),(0,a.kt)("p",null,"Under the sample root create two subdirectories called ",'"',"1.0",'"'," and ",'"',"1.1",'"',"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"md C:\\sample\\1.0\nmd C:\\sample\\1.1\n")),(0,a.kt)("h3",{id:"create-a-text-file-called-sampletxt-for-10"},"Create a text file called Sample.txt for 1.0"),(0,a.kt)("p",null,"Create a text file in the ",'"',"1.0",'"'," directory called Sample.txt and put some text in it telling you that it is the 1.0 version of the file."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"echo This is version 1.0 > C:\\sample\\1.0\\Sample.txt\n")),(0,a.kt)("h3",{id:"create-a-text-file-called-sampletxt-for-11"},"Create a text file called Sample.txt for 1.1"),(0,a.kt)("p",null,"Create a text file in the ",'"',"1.1",'"'," directory called Sample.txt and put some text in it telling you that it is the 1.1 version of the file."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"echo This is version 1.1 > C:\\sample\\1.1\\Sample.txt\n")),(0,a.kt)("h3",{id:"create-your-product-authoring-in-the-sample-root-folder"},"Create your product authoring in the sample root folder"),(0,a.kt)("p",null,"Create your product authoring in the sample root folder called Product.wxs with the following contents:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'<?xml version="1.0" encoding="UTF-8"?>\n<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">\n    <Product Id="48C49ACE-90CF-4161-9C6E-9162115A54DD"\n        Name="WiX Patch Example Product"\n        Language="1033"\n        Version="1.0.0"\n        Manufacturer="Dynamo Corporation"\n        UpgradeCode="48C49ACE-90CF-4161-9C6E-9162115A54DD">\n        <Package Description="Installs a file that will be patched."\n            Comments="This Product does not install any executables"\n            InstallerVersion="200"\n            Compressed="yes" />\n \n        <Media Id="1" Cabinet="product.cab" EmbedCab="yes" />\n        <FeatureRef Id="SampleProductFeature"/>\n    </Product>\n \n    <Fragment>\n        <Feature Id="SampleProductFeature" Title="Sample Product Feature" Level="1">\n            <ComponentRef Id="SampleComponent" />\n        </Feature>\n    </Fragment>\n \n    <Fragment>\n        <DirectoryRef Id="SampleProductFolder">\n            <Component Id="SampleComponent" Guid="{C28843DA-EF08-41CC-BA75-D2B99D8A1983}" DiskId="1">\n                <File Id="SampleFile" Name="Sample.txt" Source=".\\$(var.Version)\\Sample.txt" />\n            </Component>\n        </DirectoryRef>\n    </Fragment>\n \n    <Fragment>\n        <Directory Id="TARGETDIR" Name="SourceDir">\n            <Directory Id="ProgramFilesFolder" Name="PFiles">\n                <Directory Id="SampleProductFolder" Name="Patch Sample Directory">\n                </Directory>\n            </Directory>\n        </Directory>\n    </Fragment>\n</Wix>\n')),(0,a.kt)("h3",{id:"create-your-patch-authoring-in-the-sample-root"},"Create your patch authoring in the sample root"),(0,a.kt)("p",null,"Create your patch authoring in the sample root called Patch.wxs with the following content:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'<?xml version="1.0" encoding="UTF-8"?>\n<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">\n    <Patch \n        AllowRemoval="yes"\n        Manufacturer="Dynamo Corp" \n        MoreInfoURL="http://www.dynamocorp.com/"\n        DisplayName="Sample Patch" \n        Description="Small Update Patch" \n        Classification="Update"\n        >\n \n        <Media Id="5000" Cabinet="RTM.cab">\n            <PatchBaseline Id="RTM"/>\n        </Media>\n \n        <PatchFamilyRef Id="SamplePatchFamily"/>\n    </Patch>\n \n    <Fragment>    \n        <PatchFamily Id=\'SamplePatchFamily\' Version=\'1.0.0.0\' Supersede=\'yes\'>\n            <ComponentRef Id="SampleComponent"/>\n        </PatchFamily>\n    </Fragment>\n</Wix>\n')),(0,a.kt)("h2",{id:"building-the-patch-sample"},"Building the Patch Sample"),(0,a.kt)("p",null,"Open a command prompt and make sure that the following WiX tools are in your PATH."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Candle.exe"),(0,a.kt)("li",{parentName:"ul"},"Light.exe"),(0,a.kt)("li",{parentName:"ul"},"Torch.exe"),(0,a.kt)("li",{parentName:"ul"},"Pyro.exe")),(0,a.kt)("p",null,"Your WiX toolset version should be at least 3.0.3001.0"),(0,a.kt)("h3",{id:"build-the-target-layout"},"Build the target layout"),(0,a.kt)("p",null,"While only the .wixout is needed, the target product layout is created to test installing the patch. The product must also be installed before or along with the patch."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cd C:\\sample\ncandle.exe -dVersion=1.0 product.wxs\nlight.exe product.wixobj -out 1.0\\product.msi\n")),(0,a.kt)("h3",{id:"build-the-upgrade-layout"},"Build the upgrade layout"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"candle.exe -dVersion=1.1 product.wxs\nlight.exe product.wixobj -out 1.1\\product.msi\n")),(0,a.kt)("h3",{id:"create-the-transform-between-your-products"},"Create the transform between your products"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"torch.exe -p -xi 1.0\\product.wixpdb 1.1\\product.wixpdb -out patch\\diff.wixmst\n")),(0,a.kt)("h3",{id:"build-the-patch"},"Build the patch"),(0,a.kt)("p",null,"The patch.wxs file is compiled and linked like a product, but then it is processed along with any number of transforms that you want the patch to contain. That produces an MSP file that targets any of the products from which transforms were created after filtering."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"candle.exe patch.wxs\nlight.exe patch.wixobj -out patch\\patch.wixmsp\npyro.exe patch\\patch.wixmsp -out patch\\patch.msp -t RTM patch\\diff.wixmst\n")),(0,a.kt)("h2",{id:"verify-the-patch"},"Verify the Patch"),(0,a.kt)("p",null,"To verify that the patch works, install the product and then the patch."),(0,a.kt)("h3",{id:"install-the-10-product"},"Install the 1.0 product"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"msiexec.exe /i 1.0\\product.msi /l*vx install.log\n")),(0,a.kt)("h3",{id:"verify-version-10"},"Verify version 1.0"),(0,a.kt)("p",null,"Go to ",'"',"Program Files\\Patch Sample Directory",'"'," and open Sample.txt. Verify that this is the 1.0 version. Close Sample.txt."),(0,a.kt)("h3",{id:"install-the-patch"},"Install the patch"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"msiexec.exe /p patch\\patch.msp /l*vx patch.log\n")),(0,a.kt)("h3",{id:"verify-version-11"},"Verify version 1.1"),(0,a.kt)("p",null,"Go to ",'"',"Program Files\\Patch Sample Directory",'"'," and open Sample.txt. Verify that this is now the 1.1 version. Close Sample.txt."),(0,a.kt)("h3",{id:"uninstall-the-patch"},"Uninstall the patch"),(0,a.kt)("p",null,"On Windows XP Service Pack 2 and Windows Server 2003, go to ",'"',"Add/Remove Programs",'"'," in the Control Panel and make sure that Show Updates is checked. On Windows Vista and newer, go to ",'"',"Programs",'"'," then ",'"',"View installed updates",'"'," in the Control Panel. Select ",'"',"Sample Patch",'"'," from under ",'"',"WiX Patch Example Product",'"'," and click the Uninstall button."),(0,a.kt)("p",null,"Go to ",'"',"Program files\\Patch Sample Directory",'"'," and open Sample.txt. Verify that this is again the 1.0 version. Close Sample.txt."),(0,a.kt)("h3",{id:"uninstall-the-product"},"Uninstall the product"),(0,a.kt)("p",null,"On Windows XP Service Pack 2 and Windows Server 2003, go to ",'"',"Add/Remove Programs",'"'," in the Control Panel. On Windows Vista and newer, go to ",'"',"Programs",'"'," then ",'"',"Uninstall a program",'"'," in the Control Panel. Select ",'"',"WiX Patch Example Product",'"'," and click the Uninstall button."),(0,a.kt)("h2",{id:"restrictions"},"Restrictions"),(0,a.kt)("p",null,"In addition to ",(0,a.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/patching/patch_restrictions"},"restrictions")," about what can be in a patch in order for it to install and uninstall correctly, the following restrictions ensure that your patch works correctly."),(0,a.kt)("h3",{id:"patch-families-can-only-grow"},"Patch families can only grow"),(0,a.kt)("p",null,"Patch families are used to filter resources that should end up in a patch. Once the patch is created, these patch families dictate which patches are superseded. If a resource is removed from a patch family in a newer patch and that resource is contained in an older patch with the same patch family, then when the older patch is superseded, that resource will be regressed back to its previous state before the older patch was installed."),(0,a.kt)("p",null,"Note that in order for one patch to supersede any other patches, all patch families must be superseded. A single patch family is referenced in the example above for simplicity."),(0,a.kt)("h3",{id:"certain-elements-cannot-be-added-to-uninstallable-patches"},"Certain elements cannot be added to uninstallable patches"),(0,a.kt)("p",null,"There are certain elements referenced in ",(0,a.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/patching/patch_restrictions"},"restrictions")," that cannot be added or modified if the patch is to be uninstallable. If a Patch/@AllowRemoval is set to ",'"',"yes",'"'," and any of these elements are added or modified, Pyro.exe will return an error. These elements compile into tables that Windows Installer restricts in patches, so WiX informs you and prevents you from creating a patch that is not uninstallable when you want it to be uninstallable."))}m.isMDXComponent=!0}}]);