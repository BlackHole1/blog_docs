"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[71798],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=u(n),f=a,m=c["".concat(s,".").concat(f)]||c[f]||p[f]||i;return n?r.createElement(m,l(l({ref:t},d),{},{components:n})):r.createElement(m,l({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=f;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:a,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},41420:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>u,toc:()=>c});n(67294);var r=n(3905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const o={title:"Preprocessor",layout:"documentation",after:"tools"},s="Preprocessor",u={unversionedId:"overview/preprocessor",id:"version-v3/overview/preprocessor",title:"Preprocessor",description:"Often you will need to add different pieces of your setup during build time depending on many factors such as the SKU being built. This is done by using conditional statements that will filter the xml before it is sent to the WiX compiler (candle). If the statement evaluates to true, the block of xml will be sent to candle. If the statement evaluates to false, candle will never see that section of xml.",source:"@site/versioned_docs/version-v3/overview/preprocessor.md",sourceDirName:"overview",slug:"/overview/preprocessor",permalink:"/wixtoolset/docs/v3/overview/preprocessor",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/versioned_docs/version-v3/overview/preprocessor.md",tags:[],version:"v3",frontMatter:{title:"Preprocessor",layout:"documentation",after:"tools"}},d={},c=[{value:"Example",id:"example",level:3},{value:"Include Files &lt;?include?&gt;",id:"include-files-include",level:2},{value:"Variables",id:"variables",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"System Variables",id:"system-variables",level:3},{value:"Custom variables &lt;? define ?&gt;",id:"custom-variables--define-",level:3},{value:"Conditional Statements",id:"conditional-statements",level:2},{value:"Expressions (used in &lt;?if ?&gt; and &lt;?elseif ?&gt;)",id:"expressions-used-in-if--and-elseif-",level:3},{value:"Variables (used in &lt;ifdef ?&gt; and &lt;ifndef ?&gt;)",id:"variables-used-in-ifdef--and-ifndef-",level:3},{value:"More Examples",id:"more-examples",level:3},{value:"Errors and Warnings",id:"errors-and-warnings",level:2},{value:"Iteration Statements",id:"iteration-statements",level:2},{value:"Escaping",id:"escaping",level:2},{value:"Functions",id:"functions",level:2},{value:"Extensions",id:"extensions",level:2}],p={toc:c},f="wrapper";function m(e){var{components:t}=e,n=l(e,["components"]);return(0,r.kt)(f,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},p,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"preprocessor"},"Preprocessor"),(0,r.kt)("p",null,"Often you will need to add different pieces of your setup during build time depending on many factors such as the SKU being built. This is done by using conditional statements that will filter the xml before it is sent to the WiX compiler (candle). If the statement evaluates to true, the block of xml will be sent to candle. If the statement evaluates to false, candle will never see that section of xml."),(0,r.kt)("p",null,"The conditional statements are Boolean expressions based on environment variables, variables defined in the xml, literal values, and more."),(0,r.kt)("h3",{id:"example"},"Example"),(0,r.kt)("p",null,"Let","\u2019","s start with an example. Say you want to include a file if you","\u2019","re building the ","\u201c","Enterprise SKU.","\u201d"," Your build uses an environment variable ",(0,r.kt)("inlineCode",{parentName:"p"},"%MySku%=Enterprise")," to specify this sku."),(0,r.kt)("p",null,"When you build the enterprise sku, this file will be included in the xml passed on to candle. When you build a different sku, the xml from EnterpriseFeature.wxi will be ignored."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<?if $(env.MySku) = Enterprise ?>\n  <?include EnterpriseFeature.wxi ?>\n<?endif ?>\n")),(0,r.kt)("h2",{id:"include-files-include"},"Include Files ","<","?include?",">"),(0,r.kt)("p",null,"As shown in the example above, files can be included by using the include tag. The filename referenced in the tag will be processed as if it were part of this file."),(0,r.kt)("p",null,"The root element of the include file must be ","<","Include",">",". There are no other requirements beyond the expected wix schema. For example,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<Include>\n    <Feature Id='MyFeature' Title='My 1st Feature' Level='1'>\n      <ComponentRef Id='MyComponent' />\n    </Feature>\n</Include>\n")),(0,r.kt)("h2",{id:"variables"},"Variables"),(0,r.kt)("p",null,"Any variable can be tested for its value or simply its existence. Custom variables can also be defined in your xml."),(0,r.kt)("p",null,"Three types of variables are supported:"),(0,r.kt)("dl",null,(0,r.kt)("dt",null,"$(env._NtPostBld)"),(0,r.kt)("dd",null,"Gets the environment variable %_NtPostBld%"),(0,r.kt)("dt",null,"$(sys.CURRENTDIR)"),(0,r.kt)("dd",null,"Gets the system variable for the current directory"),(0,r.kt)("dt",null,"$(var.A)"),(0,r.kt)("dd",null,"Gets the variable A that was defined in this xml")),(0,r.kt)("p",null,"The preprocessor evaluates variables throughout the entire document, including in ","<","?if?",">"," expressions and attribute values."),(0,r.kt)("h3",{id:"environment-variables"},"Environment Variables"),(0,r.kt)("p",null,"Any environment variable can be referenced with the syntax $(env.VarName). For example, if you want to retrieve the environment variable %_BuildArch%, you would use $(env._BuildArch). Environment variable names are case-insensitive."),(0,r.kt)("h3",{id:"system-variables"},"System Variables"),(0,r.kt)("p",null,"WiX has some built-in variables. They are referenced with the syntax $(sys.VARNAME) and are always in upper case."),(0,r.kt)("dl",null,(0,r.kt)("dt",null,"CURRENTDIR"),(0,r.kt)("dd",null,"The current directory where the build process is running."),(0,r.kt)("dt",null,"SOURCEFILEPATH"),(0,r.kt)("dd",null,"The full path to the file being processed."),(0,r.kt)("dt",null,"SOURCEFILEDIR"),(0,r.kt)("dd",null,"The directory containing the file being processed."),(0,r.kt)("dt",null,"BUILDARCH"),(0,r.kt)("dd",null,"The platform (Intel, x64, Intel64, ARM) this package is compiled for (set by the -arch switch to Candle.exe or the InstallerPlatform MSBuild property).")),(0,r.kt)("p",null,"NOTE: All built-in directory variables are terminated with a backslash."),(0,r.kt)("h3",{id:"custom-variables--define-"},"Custom variables ","<","? define ?",">"),(0,r.kt)("p",null,"If you want to define custom variables, you can use the ","<","?define?",">"," statement. You can also define variables on the command line using candle.exe using the -d switch. Later, the variables are referred to in the ","<","?if?",">"," statements with the syntax $(var.VarName). Variable names are case-sensitive."),(0,r.kt)("p",null,"How to define the existence of a variable:",(0,r.kt)("br",{parentName:"p"}),"\n","<","?define MyVariable ?",">","  "),(0,r.kt)("p",null,"How to define the value of a variable (",(0,r.kt)("i",null,"note: quotes are required if the value or the expansion of other variables in the value contain spaces"),"):",(0,r.kt)("br",{parentName:"p"}),"\n","<","?define MyVariable = ","\u201c","Hello World","\u201d"," ?",">",(0,r.kt)("br",{parentName:"p"}),"\n","<","?define MyVariable = ","\u201c","$(var.otherVariableContainingSpaces)","\u201d"," ?",">","  "),(0,r.kt)("p",null,"The right side of the definition can also refer to another variable:",(0,r.kt)("br",{parentName:"p"}),"\n","<","?define MyVariable = $(var.BuildPath)\\x86\\bin\\ ?",">"),(0,r.kt)("p",null,"How to undefine a variable:",(0,r.kt)("br",{parentName:"p"}),"\n","<","?undef MyVariable ?",">","  "),(0,r.kt)("p",null,"To define variables on the command line, you can type a command similar to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'candle.exe -dMyVariable="Hello World" ...\n')),(0,r.kt)("p",null,"You can refer to variables in your source that are defined only on the command line, but candle.exe will err when preprocessing your source code if you do not define those variables on the command line."),(0,r.kt)("h2",{id:"conditional-statements"},"Conditional Statements"),(0,r.kt)("p",null,"There are several conditional statements, they include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"<","?if ?",">"),(0,r.kt)("li",{parentName:"ul"},"<","?ifdef ?",">"),(0,r.kt)("li",{parentName:"ul"},"<","?ifndef ?",">"),(0,r.kt)("li",{parentName:"ul"},"<","?else?",">"),(0,r.kt)("li",{parentName:"ul"},"<","?elseif ?",">"),(0,r.kt)("li",{parentName:"ul"},"<","?endif?",">")),(0,r.kt)("p",null,"The purpose of the conditional statement is to allow you to include or exclude a segment of xml at build time. If the expression evaluates to true, it will be included. If it evaluates to false, it will be ignored."),(0,r.kt)("p",null,"The conditional statements always begin with either the ","<","?if ?",">",", ","<","?ifdef ?",">",", or ","<","?ifndef ?",">"," tags. They are followed by an xml block, an optional ","<","?else?",">"," or ","<","?elseif ?",">"," tag, and must end with an ","<","?endif?",">"," tag."),(0,r.kt)("h3",{id:"expressions-used-in-if--and-elseif-"},"Expressions (used in ","<","?if ?",">"," and ","<","?elseif ?",">",")"),(0,r.kt)("p",null,"For example: ","<","?if ","[expression]","?",">"),(0,r.kt)("p",null,"The expression found inside the ","<","?if ?",">"," and ","<","?elseif ?",">"," tags is a Boolean expression. It adheres to a simple grammar that follows these rules:"),(0,r.kt)("ul",null,(0,r.kt)("li",null,"The expression is evaluated left to right"),(0,r.kt)("li",null,"Expressions are case-sensitive with the following exceptions:"),(0,r.kt)("li",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Environmental variable names"),(0,r.kt)("li",null,"These keywords: and, or, not"),(0,r.kt)("li",null,"The ~= operator is case-insensitive."))),(0,r.kt)("li",null,"All variables must use the $() syntax or else they will be considered a literal value."),(0,r.kt)("li",null,"If you want to use a literal $(, escape the dollar sign with a second one. For example, $$("),(0,r.kt)("li",null,"Variables can be compared to a literal or another variable"),(0,r.kt)("li",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Comparisons with =, !=, and ~= are string comparisons."),(0,r.kt)("li",null,"Comparisons with inequality operators (<, <=, >, >=) must be done on integers."),(0,r.kt)("li",null,"If the variable doesn't exist, evaluation will fail and an error will be raised."))),(0,r.kt)("li",null,"The operator precedence is as follows. Note that \u201cand\u201d and \u201cor\u201d have the same precedence:"),(0,r.kt)("li",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,'""'),(0,r.kt)("li",null,"(), $( )"),(0,r.kt)("li",null,"<, >, <=, >=, =, !=, ~="),(0,r.kt)("li",null,"Not"),(0,r.kt)("li",null,"And, Or"))),(0,r.kt)("li",null,"Nested parenthesis are allowed."),(0,r.kt)("li",null,"Literals can be surrounded by quotes, although quotes are not required."),(0,r.kt)("li",null,"Quotes, leading, and trailing white space are stripped off literal values."),(0,r.kt)("li",null,"Invalid expressions will cause an exception to be thrown.")),(0,r.kt)("h3",{id:"variables-used-in-ifdef--and-ifndef-"},"Variables (used in ","<","ifdef ?",">"," and ","<","ifndef ?",">",")"),(0,r.kt)("p",null,"For example: ","<","?ifdef ","[variable]"," ?",">"),(0,r.kt)("p",null,"For ","<","ifdef ?",">",", if the variable has been defined, this statement will be true. ","<","ifndef ?",">"," works in the exact opposite way."),(0,r.kt)("h3",{id:"more-examples"},"More Examples"),(0,r.kt)("p",null,"Note that these examples will actually each be a no-op because there aren","\u2019","t any tags between the if and endif tags."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<?define myValue  = "3"?>\n<?define system32=$(env.windir)\\system32  ?>\n<?define B = "good var" ?>\n<?define C =3 ?>\n<?define IExist ?>\n\n<?if $(var.Iexist)       ?><?endif?> \x3c!-- true --\x3e\n<?if $(var.myValue) = 6  ?><?endif?> \x3c!-- false --\x3e\n<?if $(var.myValue)!=3   ?><?endif?> \x3c!-- false --\x3e\n<?if not "x"= "y"?>              <?endif?> \x3c!-- true --\x3e\n<?if $(env.systemdrive)=a?><?endif?> \x3c!-- false --\x3e\n<?if 3 < $(var.myValue)?>   <?endif?> \x3c!-- false --\x3e\n<?if $(var.B) = "good VAR"?> <?endif?> \x3c!-- false --\x3e\n<?if $(var.A) and not $(env.MyEnvVariable)      ?> <?endif?> \x3c!-- false --\x3e\n<?if $(var.A) Or ($(var.B) And $(var.myValue) >=3)?><?endif?> \x3c!-- true --\x3e\n<?ifdef IExist ?> \x3c!-- true --\x3e\n  <?else?> \x3c!-- false --\x3e\n<?endif?>\n')),(0,r.kt)("h2",{id:"errors-and-warnings"},"Errors and Warnings"),(0,r.kt)("p",null,"You can use the preprocessor to show meaningful error and warning messages using, ","<","?error error-message ?",">"," and ","<","?warning warning-message?",">",".","\xa0"," When one of these preprocessor instructions is encountered the preprocessor will either display an error and stop the compile or display a warning and continue."),(0,r.kt)("p",null,"An example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<?ifndef RequiredVariable ?>\n  <?error RequiredVariable must be defined ?>\n<?endif?>\n")),(0,r.kt)("h2",{id:"iteration-statements"},"Iteration Statements"),(0,r.kt)("p",null,"There is a single iteration statement, ","<","?foreach variable-name in semi-colon-delimited-list ?",">"," ","<","?endforeach?",">",".","\xa0"," When this occurs the preprocessor will"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"create a private copy of the variable context"),(0,r.kt)("li",{parentName:"ul"},"set the variable in the foreach statement to an iteration on the semicolon delimited list"),(0,r.kt)("li",{parentName:"ul"},"generate a fragment with the variable substituted")),(0,r.kt)("p",null,"The effect of this process is that the fragment is used as a template by the preprocessor in order to generate a series of fragments. The variable name in the ?foreach statement can be preceded by ",'"',"var.",'"',".","\xa0"," When a variable is used inside the text of the fragment, it must be preceded by ",'"',"var.",'"'),(0,r.kt)("p",null,"An few examples:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<?foreach LCID in 1033;1041;1055?>\n  <Fragment Id='Fragment.$(var.LCID)'>\n    <DirectoryRef Id='TARGETDIR'>\n      <Component Id='MyComponent.$(var.LCID)' />\n    </DirectoryRef>\n  </Fragment>\n<?endforeach?>\n")),(0,r.kt)("p",null,"or"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<?define LcidList=1033;1041;1055?>\n<?foreach LCID in $(var.LcidList)?>\n  <Fragment Id='Fragment.$(var.LCID)'>\n    <DirectoryRef Id='TARGETDIR'>\n      <Component Id='MyComponent.$(var.LCID)' />\n    </DirectoryRef>\n  </Fragment>\n<?endforeach?>\n")),(0,r.kt)("p",null,"or filename: ExtentOfLocalization.wxi"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<Include>\n    <?define LcidList=1033;1041;1055?>\n</Include>\n")),(0,r.kt)("p",null,"and"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<?include ExtentOfLocalization.wxi ?>\n<?foreach LCID in $(var.LcidList)?>\n  <Fragment Id='Fragment.$(var.LCID)'>\n    <DirectoryRef Id='TARGETDIR'>\n      <Component Id='MyComponent.$(var.LCID)' />\n    </DirectoryRef>\n  </Fragment>\n<?endforeach?>\n")),(0,r.kt)("p",null,"An alternative to the foreach process would be to write the template WiX fragment into a separate file and have another process generate the authoring that will be passed to WiX. The greatest merit of this alternative is that it","'","s easier to debug."),(0,r.kt)("h2",{id:"escaping"},"Escaping"),(0,r.kt)("p",null,"The preprocessor treats the $ character in a special way if it is followed by a $ or (. If you want to use a literal $$, use $$$$ instead. Every two $ characters will be replaced with one. For example, $$$$$ will be replaced with $$$."),(0,r.kt)("h2",{id:"functions"},"Functions"),(0,r.kt)("p",null,"The preprocessor supports the following functions:"),(0,r.kt)("dl",null,(0,r.kt)("dt",null,"$(fun.AutoVersion(x.y))"),(0,r.kt)("dd",null,"Gets an auto generated version number using the same scheme as .NET AssemblyVersion attribute. The parameters x.y specify the major and minor verion number, the build is set to the number of days since 1/1/2000 and revision to the number of seconds since midnight divided by 2. Both values are calculated using UTC.")),(0,r.kt)("h2",{id:"extensions"},"Extensions"),(0,r.kt)("p",null,"WiX has support for preprocessor ",(0,r.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/wixdev/extensions/extensions/"},"extensions")," via the PreprocessorExtension class. The PreprocessorExtension can provide callbacks with context at foreach initialization, variable evaluation, function definitions, and the last call before invoking the compiler (for full custom preprocessing)."))}m.isMDXComponent=!0}}]);