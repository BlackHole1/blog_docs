"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[21210],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>N});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),E=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=E(e.components);return r.createElement(s.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),c=E(t),d=o,N=c["".concat(s,".").concat(d)]||c[d]||u[d]||l;return t?r.createElement(N,i(i({ref:n},p),{},{components:t})):r.createElement(N,i({ref:n},p))}));function N(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var l=t.length,i=new Array(l);i[0]=d;var a={};for(var s in n)hasOwnProperty.call(n,s)&&(a[s]=n[s]);a.originalType=e,a[c]="string"==typeof e?e:o,i[1]=a;for(var E=2;E<l;E++)i[E]=t[E];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},88844:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>N,frontMatter:()=>a,metadata:()=>E,toc:()=>c});t(67294);var r=t(3905);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}const a={wip:5539,type:"Feature",by:"Sean Hall (r sean hall at gmail.com)",title:"Modularize Burn Searches",draft:!1},s=void 0,E={unversionedId:"development/wips/modularize-burn-searches",id:"development/wips/modularize-burn-searches",title:"Modularize Burn Searches",description:"User stories",source:"@site/docs/development/wips/5539-modularize-burn-searches.md",sourceDirName:"development/wips",slug:"/development/wips/modularize-burn-searches",permalink:"/wixtoolset/docs/development/wips/modularize-burn-searches",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/5539-modularize-burn-searches.md",tags:[],version:"current",sidebarPosition:5539,frontMatter:{wip:5539,type:"Feature",by:"Sean Hall (r sean hall at gmail.com)",title:"Modularize Burn Searches",draft:!1},sidebar:"docsSidebar",previous:{title:"Automatically download related bundles missing from cache",permalink:"/wixtoolset/docs/development/wips/automatically-download-related-bundles-missing-from-cache"},next:{title:"BA Configurable REINSTALLMODE",permalink:"/wixtoolset/docs/development/wips/ba-configurable-reinstallmode"}},p={},c=[{value:"User stories",id:"user-stories",level:2},{value:"Proposal",id:"proposal",level:2},{value:"Example",id:"example",level:2},{value:"Considerations",id:"considerations",level:2},{value:"See Also",id:"see-also",level:2}],u={toc:c},d="wrapper";function N(e){var{components:n}=e,t=i(e,["components"]);return(0,r.kt)(d,l(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){o(e,n,t[n])}))}return e}({},u,t),{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"user-stories"},"User stories"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"As a WiX Extension Developer I can insert my custom search into the Burn bundle such that WiX Users can declaratively specify custom searches in their Bundle wxs code.")),(0,r.kt)("h2",{id:"proposal"},"Proposal"),(0,r.kt)("p",null,"1)\nCreate a new concept in Burn for an extension."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'enum BUNDLE_EXTENSION_MESSAGE\n{\n    BUNDLE_EXTENSION_MESSAGE_SEARCH,\n};\n\nstruct BUNDLE_EXTENSION_SEARCH_ARGS\n{\n    DWORD cbSize;\n    LPCWSTR wzId;\n    LPCWSTR wzVariable;\n};\n\nstruct BUNDLE_EXTENSION_SEARCH_RESULTS\n{\n    DWORD cbSize;\n};\n\nextern "C" typedef HRESULT(WINAPI *PFN_BUNDLE_EXTENSION_PROC)(\n    __in BUNDLE_EXTENSION_MESSAGE message,\n    __in const LPVOID pvArgs,\n    __inout LPVOID pvResults,\n    __in_opt LPVOID pvContext\n    );\n\nstruct BUNDLE_EXTENSION_CREATE_ARGS\n{\n    DWORD cbSize;\n    DWORD64 qwEngineAPIVersion;\n    PFN_BUNDLE_EXTENSION_ENGINE_PROC pfnBundleExtensionEngineProc;\n    LPVOID pvBundleExtensionEngineProcContext;\n    LPCWSTR wzBootstrapperWorkingFolder;\n    LPCWSTR wzBundleExtensionDataPath;\n};\n\nstruct BUNDLE_EXTENSION_CREATE_RESULTS\n{\n    DWORD cbSize;\n    PFN_BUNDLE_EXTENSION_PROC pfnBundleExtensionProc;\n    LPVOID pvBundleExtensionProcContext;\n};\n\nextern "C" typedef HRESULT(WINAPI *PFN_BUNDLE_EXTENSION_CREATE)(\n    __in const BUNDLE_EXTENSION_CREATE_ARGS* pArgs,\n    __inout BUNDLE_EXTENSION_CREATE_RESULTS* pResults\n    );\n\nextern "C" typedef void (WINAPI *PFN_BUNDLE_EXTENSION_DESTROY)();\n\nextern "C" typedef HRESULT(WINAPI *PFN_BUNDLE_EXTENSION_ENGINE_PROC)(\n    __in BUNDLE_EXTENSION_ENGINE_MESSAGE message,\n    __in const LPVOID pvArgs,\n    __inout LPVOID pvResults,\n    __in_opt LPVOID pvContext\n    );\n\nenum BUNDLE_EXTENSION_ENGINE_MESSAGE\n{\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_ESCAPESTRING,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_EVALUATECONDITION,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_FORMATSTRING,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_GETVARIABLENUMERIC,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_GETVARIABLESTRING,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_GETVARIABLEVERSION,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_LOG,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_SETVARIABLELITERALSTRING,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_SETVARIABLENUMERIC,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_SETVARIABLESTRING,\n    BUNDLE_EXTENSION_ENGINE_MESSAGE_SETVARIABLEVERSION,\n};\n')),(0,r.kt)("p",null,"2)\nCreate a new ",(0,r.kt)("inlineCode",{parentName:"p"},"BundleExtension")," element for the Burn manifest xml."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<xs:element name="BundleExtension">\n    <xs:complexType>\n        <xs:attribute name="Id" type="xs:string" />\n        <xs:attribute name="EntryPayloadId" type="xs:string" />\n        <xs:choice minOccurs="0" maxOccurs="unbounded">\n            <xs:element ref="PayloadRef" />\n        </xs:choice>\n    </xs:complexType>\n</xs:element>\n')),(0,r.kt)("p",null,"3)\nCreate a new ",(0,r.kt)("inlineCode",{parentName:"p"},"ExtensionSearch")," element for the Burn manifest xml."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<xs:element name="ExtensionSearch">\n    <xs:complexType>\n        <xs:attribute name="Id" type="xs:string" />\n        <xs:attribute name="Variable" type="xs:string" />\n        <xs:attribute name="Condition" type="xs:string" />\n        <xs:attribute name="ExtensionId" type="xs:string" />\n    </xs:complexType>\n</xs:element>\n')),(0,r.kt)("p",null,"4) Create new BundleExtensionData.xml file for bundle extensions' custom data."),(0,r.kt)("p",null,"5) The Burn backend finds extension searches by looking for Symbols with the new ",(0,r.kt)("inlineCode",{parentName:"p"},"BundleExtensionSearchSymbolDefinitionTag"),". These are added to the BundleExtensionData based on the corresponding ",(0,r.kt)("inlineCode",{parentName:"p"},"WixSearchSymbol"),"'s ",(0,r.kt)("inlineCode",{parentName:"p"},"ExtensionId")," field."),(0,r.kt)("p",null,"6) Add ",(0,r.kt)("inlineCode",{parentName:"p"},"util:DetectWindowsFeature")," and the core ",(0,r.kt)("inlineCode",{parentName:"p"},"SetVariable"),' "searches" as examples.'),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,"This directory search will change from"),(0,r.kt)("p",null,"manifest.xml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<DirectorySearch Id="myid" Variable="InstallFolder" Condition="PreviousInstallFolder" Path="[PreviousInstallFolder]" Type="path" />\n')),(0,r.kt)("p",null,"to"),(0,r.kt)("p",null,"manifest.xml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<UX>\n    <Payload Id="UtilExtensionDll" />\n</UX>\n<BundleExtension Id="Util" EntryPayloadId="UtilExtensionDll">\n    <PayloadRef Id="UtilExtensionDll" />\n</BundleExtension>\n<ExtensionSearch Id="myid" Variable="InstallFolder" Condition="PreviousInstallFolder" ExtensionId="Util" />\n')),(0,r.kt)("p",null,"BundleExtensionData.xml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<BundleExtensionData>\n    <BundleExtension Id="Util">\n        <DirectorySearch Path="[PreviousInstallFolder]" Type="path" />\n    </BundleExtension>\n</BundleExtensionData>\n')),(0,r.kt)("h2",{id:"considerations"},"Considerations"),(0,r.kt)("p",null,"Moving Util's old searches out of the core toolset will still need to be done."),(0,r.kt)("p",null,"Once this functionality is in place, I anticipate two feature requests:"),(0,r.kt)("p",null,"1) Add the option to run the search in the elevated process in order to do IIS searches."),(0,r.kt)("p",null,"2) Add the ability to add custom package types and execute them in the Bundle extension."),(0,r.kt)("h2",{id:"see-also"},"See Also"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/wixtoolset/issues/issues/5539"},"WIXFEAT:5539")))}N.isMDXComponent=!0}}]);