"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[90705],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?o.createElement(h,r(r({ref:t},p),{},{components:n})):o.createElement(h,r({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,r[1]=l;for(var c=2;c<i;c++)r[c]=n[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},37796:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>d});n(67294);var o=n(3905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function r(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const l={wip:6184,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Command-line Extension Acquisition and Cache"},s=void 0,c={unversionedId:"development/wips/command-line-extension-acquisition-and-cache",id:"development/wips/command-line-extension-acquisition-and-cache",title:"Command-line Extension Acquisition and Cache",description:"User stories",source:"@site/docs/development/wips/6184-command-line-extension-acquisition-and-cache.md",sourceDirName:"development/wips",slug:"/development/wips/command-line-extension-acquisition-and-cache",permalink:"/wixtoolset/docs/development/wips/command-line-extension-acquisition-and-cache",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/6184-command-line-extension-acquisition-and-cache.md",tags:[],version:"current",sidebarPosition:6184,frontMatter:{wip:6184,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Command-line Extension Acquisition and Cache"},sidebar:"docsSidebar",previous:{title:"Create element for custom BA and BE data",permalink:"/wixtoolset/docs/development/wips/burn-custom-table"},next:{title:"Create ExePackage Log",permalink:"/wixtoolset/docs/development/wips/create-exepackage-log"}},p={},d=[{value:"User stories",id:"user-stories",level:2},{value:"Proposal",id:"proposal",level:2},{value:"Cache Locations",id:"cache-locations",level:3},{value:"Referencing Cached Extensions",id:"referencing-cached-extensions",level:3},{value:"Considerations",id:"considerations",level:2},{value:"See Also",id:"see-also",level:2}],u={toc:d},m="wrapper";function h(e){var{components:t}=e,n=r(e,["components"]);return(0,o.kt)(m,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){a(e,t,n[t])}))}return e}({},u,n),{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"user-stories"},"User stories"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"As a Setup developer I can acquire extensions for use by a command-line build.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"As a WiX extension developer I only have to publish my extension via NuGet and Setup developers can access it via the command-line build and MSBuild/NuGet project-based build."))),(0,o.kt)("h2",{id:"proposal"},"Proposal"),(0,o.kt)("p",null,"Add a new command to ",(0,o.kt)("inlineCode",{parentName:"p"},"wix.exe"),' to download and extract extensions from NuGet packages into an "extension cache" for easy reference by the ',(0,o.kt)("inlineCode",{parentName:"p"},"build")," command. This design is inspired by the ",(0,o.kt)("inlineCode",{parentName:"p"},"dotnet tool")," command which manages local and global .NET Core tools."),(0,o.kt)("p",null,"The new ",(0,o.kt)("inlineCode",{parentName:"p"},"extension")," command will have three sub-commands:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"add")," - adds the extension to the local or global cache. The NuGet package id must be provided and a specific version can be requested by appending slash and version to the package id. Otherwise, the latest package is added to the cache."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"remove")," - removes an extension from the local or global cache. The NuGet package id must be provided and a specific version can be requested by appending slash and version to the package id. Otherwise, all versions of the package id are removed from the cache."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"list")," - lists the extensions in the local or global cache.")),(0,o.kt)("p",null,"Each sub-command accepts a ",(0,o.kt)("inlineCode",{parentName:"p"},"-g")," switch to use to the global cache instead of the local cache."),(0,o.kt)("h3",{id:"cache-locations"},"Cache Locations"),(0,o.kt)("p",null,"The extensions NuGet packages are extracted to a ",(0,o.kt)("inlineCode",{parentName:"p"},".wix\\extensions\\[packageId]\\[packageVersion]")," cache folder."),(0,o.kt)("p",null,"For local packages, the root cache folder is the current directory when the ",(0,o.kt)("inlineCode",{parentName:"p"},"wix.exe extension")," command is executed. Care must be taken by the Setup developer to set the current directory correctly when adding extensions and building using them."),(0,o.kt)("p",null,"For global packages, the root cache folder defaults to  the user's home folder (",(0,o.kt)("inlineCode",{parentName:"p"},"%USERPROFILE%"),"). The global cache root folder can be overridden using the ",(0,o.kt)("inlineCode",{parentName:"p"},"WIX_EXTENSION")," environment variable."),(0,o.kt)("h3",{id:"referencing-cached-extensions"},"Referencing Cached Extensions"),(0,o.kt)("p",null,"Extensions in the cache can be referenced by their package id to get the latest version, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wix extension add WixToolset.Util.wixext\nwix build -ext WixToolset.Util.wixext source.wxs\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note that the local cache is always checked before the global cache.")),(0,o.kt)("p",null,"A specific version of an extension may also be referenced by appending the extensions' package id with slash and version, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wix extension add WixToolset.Util.wixext/4.0.3\nwix build -ext WixToolset.Util.wixext/4.0.3 source.wxs\n")),(0,o.kt)("p",null,"Finally, extensions can always be referenced using a full path and will bypass the cache look-up, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wix build -ext C:\\ext\\WixToolset.Util.wixext.dll source.wxs\n")),(0,o.kt)("h2",{id:"considerations"},"Considerations"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Should MSBuild/dotnet build use the extension cache or only depend on project's package references being restored during the build?"),(0,o.kt)("p",{parentName:"li"},"Answer: No. Let the extension cache only be used by the command-line and the NuGet package cache used for MSBuild/dotnet build. This does mean the extensions shared between command-line builds and project based builds are cached twice but a) we don't expect devs to generally use ",(0,o.kt)("em",{parentName:"p"},"both")," command-line ",(0,o.kt)("em",{parentName:"p"},"and")," project based options and b) extensions are small.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Should we make the ",(0,o.kt)("inlineCode",{parentName:"p"},".wixext")," optional when referencing via the ",(0,o.kt)("inlineCode",{parentName:"p"},"-ext")," switch?"),(0,o.kt)("p",{parentName:"li"},'Answer: No. It is inconsistent as ".wixext" will be required to find the package in a NuGet feed.')),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"What about a ",(0,o.kt)("inlineCode",{parentName:"p"},"wix extension restore")," command to bring down all the required extensions?"),(0,o.kt)("p",{parentName:"li"},"Answer: If the ",(0,o.kt)("inlineCode",{parentName:"p"},"extension")," command kept a log of extensions added to the local or global cache, it would be possible to have a sub-command like ",(0,o.kt)("inlineCode",{parentName:"p"},"restore")," re-download the extensions missing from the cache. This sort of restore functionality is not planned in the first version.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"What about using a ",(0,o.kt)("inlineCode",{parentName:"p"},"--version")," switch for the ",(0,o.kt)("inlineCode",{parentName:"p"},"add")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"remove"),' sub-commands instead of the "slash version" syntax?'),(0,o.kt)("p",{parentName:"li"},"Answer: While using a ",(0,o.kt)("inlineCode",{parentName:"p"},"--version")," switch would be more consistent with ",(0,o.kt)("inlineCode",{parentName:"p"},"dotnet tool")," behavior, the ",(0,o.kt)("inlineCode",{parentName:"p"},"build -ext"),' switch needs a concise way to specify the extension package id and version. The "slash version" syntax is borrowed from the ',(0,o.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/visualstudio/msbuild/how-to-use-project-sdk?view=vs-2019#reference-a-project-sdk"},"MSBuild SDK-style reference syntax"),"."))),(0,o.kt)("h2",{id:"see-also"},"See Also"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/wixtoolset/issues/issues/6184"},"WIXFEAT:6184"))))}h.isMDXComponent=!0}}]);