"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[70686],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>v});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(t),u=i,v=c["".concat(s,".").concat(u)]||c[u]||m[u]||r;return t?a.createElement(v,o(o({ref:n},d),{},{components:t})):a.createElement(v,o({ref:n},d))}));function v(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},15431:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>v,frontMatter:()=>l,metadata:()=>p,toc:()=>c});t(67294);var a=t(3905);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function o(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}const l={wip:6210,type:"Feature",by:"Sean Hall (r sean hall at gmail.com)",title:"Burn engine support for SemVer",draft:!1},s=void 0,p={unversionedId:"development/wips/burn-engine-semantic-versioning",id:"development/wips/burn-engine-semantic-versioning",title:"Burn engine support for SemVer",description:"User stories",source:"@site/docs/development/wips/6210-burn-engine-semantic-versioning.md",sourceDirName:"development/wips",slug:"/development/wips/burn-engine-semantic-versioning",permalink:"/wixtoolset/docs/development/wips/burn-engine-semantic-versioning",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/6210-burn-engine-semantic-versioning.md",tags:[],version:"current",sidebarPosition:6210,frontMatter:{wip:6210,type:"Feature",by:"Sean Hall (r sean hall at gmail.com)",title:"Burn engine support for SemVer",draft:!1},sidebar:"docsSidebar",previous:{title:"Multi-arch BalExtension BAs",permalink:"/wixtoolset/docs/development/wips/multi-architecture-bal"},next:{title:"Add DotNetCompatibilityCheck to the NetFx extension for the detection of .NET Core/.NET 5 runtimes",permalink:"/wixtoolset/docs/development/wips/add-dotnet-runtime-compatibility-check"}},d={},c=[{value:"User stories",id:"user-stories",level:2},{value:"Proposal",id:"proposal",level:2},{value:"Verutil Version Specification",id:"verutil-version-specification",level:2},{value:"Burn API Changes",id:"burn-api-changes",level:2},{value:"Examples",id:"examples",level:2},{value:"1.0",id:"10",level:3},{value:"1.2.3.004-2.a.22+abcdef",id:"123004-2a22abcdef",level:3},{value:"100.-2.0",id:"100-20",level:3},{value:"1-2",id:"1-2",level:3},{value:"2.9999999999999999999999999999999999999.0.0",id:"2999999999999999999999999999999999999900",level:3},{value:"Comparisons",id:"comparisons",level:3},{value:"Considerations",id:"considerations",level:2},{value:"See Also",id:"see-also",level:2}],m={toc:c},u="wrapper";function v(e){var{components:n}=e,t=o(e,["components"]);return(0,a.kt)(u,r(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){i(e,n,t[n])}))}return e}({},m,t),{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"user-stories"},"User stories"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"As a Setup developer I can use Burn when dealing with non-QWORDable versions.")),(0,a.kt)("h2",{id:"proposal"},"Proposal"),(0,a.kt)("p",null,"In v3, the Burn engine uses version numbers as ",(0,a.kt)("inlineCode",{parentName:"p"},"QWORD"),"s to drive some of its most critical functionality.\nIn the real world, versions can't always be parsed into a ",(0,a.kt)("inlineCode",{parentName:"p"},"QWORD"),".\nAt its most basic level, Burn needs to use strings for versions."),(0,a.kt)("p",null,"In order to perform comparisons, Burn needs to a new way to parse versions.\nThe basic idea is to use NuGet's implementation of SemVer with some variations to keep v3 Burn functionality."),(0,a.kt)("h2",{id:"verutil-version-specification"},"Verutil Version Specification"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Simple versions take the form ",(0,a.kt)("inlineCode",{parentName:"p"},"Major.Minor.Patch.Revision"),", where ",(0,a.kt)("inlineCode",{parentName:"p"},"Major"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Minor"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Patch"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"Revision")," are unsigned 32-bit numbers. ",(0,a.kt)("inlineCode",{parentName:"p"},"Minor"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Patch"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"Revision")," are optional.\nValid examples are ",(0,a.kt)("inlineCode",{parentName:"p"},"1"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.2.3.4"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0.02.3"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0.0"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"4294967295.4294967295.4294967295.4294967295"),".\nInvalid examples are ",(0,a.kt)("inlineCode",{parentName:"p"},"1."),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.-1"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.2.3.4.5"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"4294967296.4294967296.4294967296.4294967296"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"A pre-release version is a simple version followed by a hyphen followed by a series of dot separated identifiers. These identifiers may only contain ASCII alphanumeric characters or a hyphen (",(0,a.kt)("inlineCode",{parentName:"p"},"[0-9a-zA-Z-]+"),").\nValid examples are ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-a"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-1.a"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-a-2"),".\nInvalid examples are ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-a."),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-@"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Build metadata is optional, and can be added to simple versions and pre-release versions.\nBuild metadata starts with a plus sign.\nWhile any characters are allowed, characters other than ",(0,a.kt)("inlineCode",{parentName:"p"},"[0-9a-zA-Z-_.+]")," are discouraged since Burn can't parse them in a condition expression.\nFor example, ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0+any_string+here")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-beta+string"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"When not in strict mode, invalid versions are parsed as much as possible and then the rest is treated as build metadata. The version is also marked as invalid.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Versions must be less than 2,147,483,647 characters.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Versions may begin with ",(0,a.kt)("inlineCode",{parentName:"p"},"v")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"V"),"."))),(0,a.kt)("p",null,"The precedence rules mostly follow NuGet."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The Major.Minor.Patch.Revision part is compared first, just like v3 Burn.\nUndefined fields are treated as zero.\nExamples: ",(0,a.kt)("inlineCode",{parentName:"p"},"1.2.3.4 > 1.2.3"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1.2.3.0 = 1.2.3"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0.0 = 0"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Next, ReleaseLabels are compared as specified in the SemVer 2.0 spec except string comparisons are done case-insensitive.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Next, the invalid flag is compared.\nExamples: ",(0,a.kt)("inlineCode",{parentName:"p"},"0.0 > @#$%^&*"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0.0 > 0.0..1"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"2.0.-1 > 1.0"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"1-1 > 1-2_3"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Finally, if the versions are invalid then Metadata is compared as a case-insensitive string comparison."))),(0,a.kt)("h2",{id:"burn-api-changes"},"Burn API Changes"),(0,a.kt)("p",null,"The main change to the Burn API is that all places that were using a ",(0,a.kt)("inlineCode",{parentName:"p"},"QWORD")," for a version will now use a ",(0,a.kt)("inlineCode",{parentName:"p"},"LPWSTR"),".\nThe existing ",(0,a.kt)("inlineCode",{parentName:"p"},"EvaluateCondition")," engine method/message can be used to compare versions.\nThe details of the parsed version will not be available to the BA, they will be internal to Burn.\nThis is because Burn is not the source of truth of how the version is supposed to be evaluated.\nThe code will be available in ",(0,a.kt)("inlineCode",{parentName:"p"},"verutil")," (and WixToolset.Mba.Core) if the BA would like to parse the version like Burn."),(0,a.kt)("p",null,"The condition expression parser for versions will be updated to accept the characters ",(0,a.kt)("inlineCode",{parentName:"p"},"0-9"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"a-z"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"A-Z"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"."),", ",(0,a.kt)("inlineCode",{parentName:"p"},"-"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"_"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"+"),"."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},">>"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"<<"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"><")," operators will be removed when comparing versions, since they are no longer simple ",(0,a.kt)("inlineCode",{parentName:"p"},"QWORD"),"s."),(0,a.kt)("p",null,"When a version variable is coerced into a numeric value, then the version string is parsed as a number (just like when coercing a string variable into a number). This will fail for most versions."),(0,a.kt)("p",null,"When a numeric variable is coerced into a version value, then the value is split into a version using the v3 logic. The highest word is Major, the next word is Minor, the next word is Patch, and the lowest word is Revision."),(0,a.kt)("p",null,"Add a new ",(0,a.kt)("inlineCode",{parentName:"p"},"CompareVersions")," method for a more convenient way to compare versions:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"STDMETHOD(CompareVersions)(\n    __in_z LPCWSTR wzVersionLeft,\n    __in_z LPCWSTR wzVersionRight,\n    __out int* pnResult\n    ) = 0;\n")),(0,a.kt)("h2",{id:"examples"},"Examples"),(0,a.kt)("h3",{id:"10"},"1.0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Major: 1\nMinor: 0\nPatch: 0\nRevision: 0\nReleaseLabels: [] (empty)\nMetadata: "" (empty)\nInvalid: false\n')),(0,a.kt)("h3",{id:"123004-2a22abcdef"},"1.2.3.004-2.a.22+abcdef"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Major: 1\nMinor: 2\nPatch: 3\nRevision: 4\nReleaseLabels: [2, "a", 22]\nMetadata: "abcdef"\nInvalid: false\n')),(0,a.kt)("h3",{id:"100-20"},"100.-2.0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Major: 100\nMinor: 0\nPatch: 0\nRevision: 0\nReleaseLabels: [] (empty)\nMetadata: "-2.0"\nInvalid: true\n')),(0,a.kt)("h3",{id:"1-2"},"1-2"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Major: 1\nMinor: 0\nPatch: 0\nRevision: 0\nReleaseLabels: [2]\nMetadata: "" (empty)\nInvalid: false\n')),(0,a.kt)("h3",{id:"2999999999999999999999999999999999999900"},"2.9999999999999999999999999999999999999.0.0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Major: 2\nMinor: 0\nPatch: 0\nRevision: 0\nReleaseLabels: [] (empty)\nMetadata: "9999999999999999999999999999999999999.0.0"\nInvalid: true\n')),(0,a.kt)("h3",{id:"comparisons"},"Comparisons"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'1.2.3.4 > 1.2.3\n1.2.3.0 = 1.2.3\n1.0-2.0 > 1.0-1.19\n1.0-2.0 < 1.0-19\n10.-4.0 > 10.-2.0\n0       > "" (empty string)\n0.0.1-a > 0-2\n0.0.1-a < 1-2\n0.01-a.1 = 0.1.0-a.1\n0.1-a.b.0 = 0.1.0-a.b.000\n1.2.3+abc = 1.2.3+xyz\n1.2.3+abcd > 1.2.3.-abcd\n10.20.30.40 = v10.20.30.40\n4294967295.4294967295.4294967295.4294967295 > 4294967296.4294967296.4294967296.4294967296\n')),(0,a.kt)("h2",{id:"considerations"},"Considerations"),(0,a.kt)("p",null,"The behavior for invalid versions is completely arbitrary, but needs to be defined."),(0,a.kt)("p",null,"Allowing Bundles to author SemVer is out of scope of this issue."),(0,a.kt)("h2",{id:"see-also"},"See Also"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/wixtoolset/issues/issues/6210"},"WIXFEAT:6210")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/wixtoolset/issues/issues/4666"},"WIXFEAT:4666"))))}v.isMDXComponent=!0}}]);