"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[59780],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(a),h=r,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||i;return a?n.createElement(m,o(o({ref:t},c),{},{components:a})):n.createElement(m,o({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},98243:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>u});a(67294);var n=a(3905);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const l={sidebar_position:80},s="Windows Installer patches",p={unversionedId:"tools/patches",id:"tools/patches",title:"Windows Installer patches",description:"Windows Installer patching allows you to update an installed product without a full upgrade. Patches contain the differences between an older version of a package (called the target) and the newer version (the update). Because they contain only the differences, patches are typically smaller than the full update package and typically install more quickly.",source:"@site/docs/tools/patches.md",sourceDirName:"tools",slug:"/tools/patches",permalink:"/wixtoolset/docs/tools/patches",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/tools/patches.md",tags:[],version:"current",sidebarPosition:80,frontMatter:{sidebar_position:80},sidebar:"docsSidebar",previous:{title:"Signing packages and bundles",permalink:"/wixtoolset/docs/tools/signing"},next:{title:"Specifying source files",permalink:"/wixtoolset/docs/tools/payloads"}},c={},u=[{value:"Authoring patches",id:"authoring-patches",level:2},{value:"Authoring patches using .wixpdb files",id:"authoring-patches-using-wixpdb-files",level:2},{value:"Authoring patches using .msi files",id:"authoring-patches-using-msi-files",level:2}],d={toc:u},h="wrapper";function m(e){var{components:t}=e,a=o(e,["components"]);return(0,n.kt)(h,i(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){r(e,t,a[t])}))}return e}({},d,a),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"windows-installer-patches"},"Windows Installer patches"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows/win32/msi/patching"},"Windows Installer patching")," allows you to update an installed product without a full upgrade. Patches contain the differences between an older version of a package (called the target) and the newer version (the update). Because they contain only the differences, patches are typically smaller than the full update package and typically install more quickly."),(0,n.kt)("p",null,"That said, patching is an advanced topic and requires strict adherence to all the rules that come with Windows Installer. Using ",(0,n.kt)("a",{parentName:"p",href:"/wixtoolset/docs/schema/wxs/majorupgrade"},'major upgrades with "early" scheduling, such as using the default ',(0,n.kt)("inlineCode",{parentName:"a"},"Schedule")," attribute of the ",(0,n.kt)("inlineCode",{parentName:"a"},"MajorUpgrade")," element")," is far simpler. ",(0,n.kt)("a",{parentName:"p",href:"https://www.joyofsetup.com/2008/12/30/paying-for-upgrades/"},"As Bob Arnson discussed way back in 2008:")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If you don\u2019t absolutely need to ship patches, you can avoid the costs of minor upgrades by simply using major upgrades. You can remove files without worrying about component-rule violations if you use an \u201cearly\u201d scheduling of the RemoveExistingProducts standard action \u2013 before or immediately after the InstallInitialize action.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"The MSI SDK notes that scheduling RemoveExistingProducts early is \u201cinefficient\u201d because the files that are same between the two product versions are removed and then reinstalled. But that inefficiency is what lets you remove files and components.")),(0,n.kt)("h2",{id:"authoring-patches"},"Authoring patches"),(0,n.kt)("p",null,"Patch authoring starts with the ",(0,n.kt)("a",{parentName:"p",href:"/wixtoolset/docs/schema/wxs/patch"},(0,n.kt)("inlineCode",{parentName:"a"},"Patch")," element"),". Attributes supply some metadata about the patch and child elements define the cabinet containing updated files and the target and update packages. The target and update packages can be specified as .wixpdb or as .msi files."),(0,n.kt)("h2",{id:"authoring-patches-using-wixpdb-files"},"Authoring patches using .wixpdb files"),(0,n.kt)("p",null,".wixpdb files are produced during the WiX build and, like .pdb files from your favorite Visual Studio compiler, contain symbol information produced during the build process beyond what's recorded in the final output (like an .msi file). For patches, one bit of that extra information is the paths that were used when building the target and update packages to choose the payload files. When use you bind paths, WiX can use path information from the .wixpdb files to locate files when building the patch content."),(0,n.kt)("p",null,"Here's what authoring for a patch might look like:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-xml"},'<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">\n  <Patch\n    AllowRemoval="yes"\n    DisplayName="Product Patch v$(Version)"\n    Description="Product Patch v$(Version)"\n    MoreInfoURL="https://wixtoolset.org/"\n    Manufacturer="WiX Toolset"\n    Classification="Update">\n\n    <Media Id="1" Cabinet="patch.cab">\n      <PatchBaseline\n        Id="RTM"\n        BaselineFile="PackageV1.wixpdb"\n        UpdateFile="PackageV2.wixpdb" />\n    </Media>\n\n    <PatchFamily Id="SequenceFamily" Version="$(Version)" />\n  </Patch>\n</Wix>\n')),(0,n.kt)("p",null,"Building it would look like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},"wix build -define Version=2.0 -bindpath path\\to\\V1PackageOutput -bindpath path\\to\\V2PackageOutput -bindpath:target path\\to\\V1PackagePayloads -bindpath:update path\\to\\V2PackagePayloads -out path\\to\\patch.msp Patch.wxs\n")),(0,n.kt)("p",null,"The following table describes the switches used for building the patch:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Switch"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-define")),(0,n.kt)("td",{parentName:"tr",align:null},"Passes the patch version into the patch authoring.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-bindpath path\\to\\V1PackageOutput")),(0,n.kt)("td",{parentName:"tr",align:null},"Provides a bind path to find the target package.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-bindpath path\\to\\V2PackageOutput")),(0,n.kt)("td",{parentName:"tr",align:null},"Provides a bind path to find the update package.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-bindpath:target path\\to\\V1PackagePayloads")),(0,n.kt)("td",{parentName:"tr",align:null},"Tells WiX to use the specified path when locating files from target .wixpdb.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-bindpath:update path\\to\\V2PackagePayloads")),(0,n.kt)("td",{parentName:"tr",align:null},"Tells WiX to use the specified path when locating files from update .wixpdb.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-out path\\to\\patch.msp")),(0,n.kt)("td",{parentName:"tr",align:null},"Specify the output is a patch.")))),(0,n.kt)("h2",{id:"authoring-patches-using-msi-files"},"Authoring patches using .msi files"),(0,n.kt)("p",null,"You can also use .msi files as the target and update packages. The primary advantage of using .msi files over .wixpdb files is that the .msi files are the source of both the changes between the target and update packages but also of the payload files themselves. So rather than supplying .wixpdb files and paths for the payload files, you need to supply just the .msi files. The primary disadvantage of using .msi files is that WiX needs to extract files from the .msi packages, which typically increases the time needed to build the patch."),(0,n.kt)("p",null,"The patch authoring itself is identical other than file paths:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-xml"},'<PatchBaseline\n  Id="RTM"\n  BaselineFile="PackageV1.msi"\n  UpdateFile="PackageV2.msi" />\n')),(0,n.kt)("p",null,"Building it would look like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},"wix build -define Version=2.0 -bindpath path\\to\\V1PackageOutput -bindpath path\\to\\V2PackageOutput  -out PatchV1V2.msp Patch.wxs\n")),(0,n.kt)("p",null,"The following table describes the switches used for building the patch:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Switch"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-define")),(0,n.kt)("td",{parentName:"tr",align:null},"Passes the patch version into the patch authoring.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-bindpath path\\to\\V1PackageOutput")),(0,n.kt)("td",{parentName:"tr",align:null},"Provides a bind path to find the target package.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-bindpath path\\to\\V2PackageOutput")),(0,n.kt)("td",{parentName:"tr",align:null},"Provides a bind path to find the update package.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"-out path\\to\\patch.msp")),(0,n.kt)("td",{parentName:"tr",align:null},"Specify the output is a patch.")))))}m.isMDXComponent=!0}}]);