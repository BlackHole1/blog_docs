"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[92793],{3905:(e,t,a)=>{a.d(t,{Zo:()=>s,kt:()=>m});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=r.createContext({}),p=function(e){var t=r.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},s=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=p(a),h=n,m=d["".concat(c,".").concat(h)]||d[h]||u[h]||i;return a?r.createElement(m,l(l({ref:t},s),{},{components:a})):r.createElement(m,l({ref:t},s))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=h;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[d]="string"==typeof e?e:n,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},33976:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>p,toc:()=>d});a(67294);var r=a(3905);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}const o={title:"Using Patch Creation Properties",layout:"documentation"},c="Using Patch Creation Properties",p={unversionedId:"patching/patch_building",id:"version-v3/patching/patch_building",title:"Using Patch Creation Properties",description:"A patch contains the differences between one or more pairs of Windows Installer packages. The tool PatchWiz.dll in the Windows SDK compares pairs of packages and produces a patch using a file called a Patch Creation Properties (PCP) file.",source:"@site/versioned_docs/version-v3/patching/patch_building.md",sourceDirName:"patching",slug:"/patching/patch_building",permalink:"/wixtoolset/docs/v3/patching/patch_building",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/versioned_docs/version-v3/patching/patch_building.md",tags:[],version:"v3",frontMatter:{title:"Using Patch Creation Properties",layout:"documentation"}},s={},d=[{value:"Setting Up the Sample",id:"setting-up-the-sample",level:2},{value:"Create a directory that will contain the sample",id:"create-a-directory-that-will-contain-the-sample",level:3},{value:"Create two subdirectories",id:"create-two-subdirectories",level:3},{value:"Create a text file called Sample.txt for 1.0",id:"create-a-text-file-called-sampletxt-for-10",level:3},{value:"Create a text file called Sample.txt for 1.1",id:"create-a-text-file-called-sampletxt-for-11",level:3},{value:"Create your product authoring in the sample root folder",id:"create-your-product-authoring-in-the-sample-root-folder",level:3},{value:"Create your patch authoring in the sample root",id:"create-your-patch-authoring-in-the-sample-root",level:3},{value:"Build the Target and Upgrade Packages",id:"build-the-target-and-upgrade-packages",level:2},{value:"Build the target package",id:"build-the-target-package",level:3},{value:"Perform an administrative installation of the target package",id:"perform-an-administrative-installation-of-the-target-package",level:3},{value:"Build the upgrade package",id:"build-the-upgrade-package",level:3},{value:"Perform an administrative installation of the upgrade package",id:"perform-an-administrative-installation-of-the-upgrade-package",level:3},{value:"Build the Patch",id:"build-the-patch",level:2},{value:"Verify the Patch",id:"verify-the-patch",level:2},{value:"Install the 1.0 product",id:"install-the-10-product",level:3},{value:"Verify version 1.0",id:"verify-version-10",level:3},{value:"Install the patch",id:"install-the-patch",level:3},{value:"Verify version 1.1",id:"verify-version-11",level:3},{value:"Uninstall the patch",id:"uninstall-the-patch",level:3},{value:"Uninstall the product",id:"uninstall-the-product",level:3},{value:"Restrictions",id:"restrictions",level:2}],u={toc:d},h="wrapper";function m(e){var{components:t}=e,a=l(e,["components"]);return(0,r.kt)(h,i(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){n(e,t,a[t])}))}return e}({},u,a),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"using-patch-creation-properties"},"Using Patch Creation Properties"),(0,r.kt)("p",null,"A patch contains the differences between one or more pairs of Windows Installer packages. The tool PatchWiz.dll in the ",(0,r.kt)("a",{href:"http://www.microsoft.com/en-us/download/details.aspx?id=3138",target:"_blank"},"Windows SDK")," compares pairs of packages and produces a patch using a file called a Patch Creation Properties (PCP) file."),(0,r.kt)("p",null,"It is recommended that you download the latest Windows SDK to get the newest tools for building patches."),(0,r.kt)("h2",{id:"setting-up-the-sample"},"Setting Up the Sample"),(0,r.kt)("p",null,"A Patch Creation Properties (PCP) file instructs PatchWiz.dll to generate a patch from differences in one or more pairs of packages. A patch contains the differences between the target and upgrade packages, and will transform the target package to the upgrade package. Both the target and upgrade packages are created below."),(0,r.kt)("h3",{id:"create-a-directory-that-will-contain-the-sample"},"Create a directory that will contain the sample"),(0,r.kt)("p",null,"Create a directory from which you plan on running the sample. This will be the sample root."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"md C:\\sample\n")),(0,r.kt)("h3",{id:"create-two-subdirectories"},"Create two subdirectories"),(0,r.kt)("p",null,"Under the sample root create two subdirectories called ",'"',"1.0",'"'," and ",'"',"1.1",'"',"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"md C:\\sample\\1.0\nmd C:\\sample\\1.1\n")),(0,r.kt)("h3",{id:"create-a-text-file-called-sampletxt-for-10"},"Create a text file called Sample.txt for 1.0"),(0,r.kt)("p",null,"Create a text file in the ",'"',"1.0",'"'," directory called Sample.txt and put some text in it telling you that it is the 1.0 version of the file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"echo This is version 1.0 > C:\\sample\\1.0\\Sample.txt\n")),(0,r.kt)("h3",{id:"create-a-text-file-called-sampletxt-for-11"},"Create a text file called Sample.txt for 1.1"),(0,r.kt)("p",null,"Create a text file in the ",'"',"1.1",'"'," directory called Sample.txt and put some text in it telling you that it is the 1.1 version of the file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"echo This is version 1.1 > C:\\sample\\1.1\\Sample.txt\n")),(0,r.kt)("h3",{id:"create-your-product-authoring-in-the-sample-root-folder"},"Create your product authoring in the sample root folder"),(0,r.kt)("p",null,"Create your product authoring in the sample root folder called Product.wxs with the following contents:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<?xml version="1.0" encoding="UTF-8"?>\n<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">\n    <Product Id="48C49ACE-90CF-4161-9C6E-9162115A54DD"\n        Name="WiX Patch Example Product"\n        Language="1033"\n        Version="1.0.0"\n        Manufacturer="Dynamo Corporation"\n        UpgradeCode="48C49ACE-90CF-4161-9C6E-9162115A54DD">\n        <Package Description="Installs a file that will be patched."\n            Comments="This Product does not install any executables"\n            InstallerVersion="200"\n            Compressed="yes" />\n \n        <Media Id="1" Cabinet="product.cab" EmbedCab="yes" />\n        <FeatureRef Id="SampleProductFeature"/>\n    </Product>\n \n    <Fragment>\n        <Feature Id="SampleProductFeature" Title="Sample Product Feature" Level="1">\n            <ComponentRef Id="SampleComponent" />\n        </Feature>\n    </Fragment>\n \n    <Fragment>\n        <DirectoryRef Id="SampleProductFolder">\n            <Component Id="SampleComponent" Guid="{C28843DA-EF08-41CC-BA75-D2B99D8A1983}" DiskId="1">\n                <File Id="SampleFile" Name="Sample.txt" Source=".\\$(var.Version)\\Sample.txt" />\n            </Component>\n        </DirectoryRef>\n    </Fragment>\n \n    <Fragment>\n        <Directory Id="TARGETDIR" Name="SourceDir">\n            <Directory Id="ProgramFilesFolder" Name="PFiles">\n                <Directory Id="SampleProductFolder" Name="Patch Sample Directory">\n                </Directory>\n            </Directory>\n        </Directory>\n    </Fragment>\n</Wix>\n')),(0,r.kt)("h3",{id:"create-your-patch-authoring-in-the-sample-root"},"Create your patch authoring in the sample root"),(0,r.kt)("p",null,"Create your Patch Creation Properties (PCP) authoring in the sample root called Patch.wxs with the following content:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<?xml version="1.0" encoding="utf-8"?>\n<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">\n    <PatchCreation\n        Id="224C316C-5894-4771-BABF-21A3AC1F75FF"\n        CleanWorkingFolder="yes"\n        OutputPath="patch.pcp"\n        WholeFilesOnly="yes"\n        >\n \n        <PatchInformation \n            Description="Small Update Patch" \n            Comments="Small Update Patch" \n            ShortNames="no" \n            Languages="1033" \n            Compressed="yes" \n            Manufacturer="Dynamo Corp"/>\n \n        <PatchMetadata\n            AllowRemoval="yes"\n            Description="Small Update Patch"\n            ManufacturerName="Dynamo Corp"\n            TargetProductName="Sample"\n            MoreInfoURL="http://www.dynamocorp.com/"\n            Classification="Update"\n            DisplayName="Sample Patch"/>\n \n        <Family DiskId="5000"\n            MediaSrcProp="Sample" \n            Name="Sample"\n            SequenceStart="5000">\n            <UpgradeImage SourceFile="C:\\sample\\1.1\\admin\\product.msi" Id="SampleUpgrade">\n                <TargetImage SourceFile="C:\\sample\\1.0\\admin\\product.msi" Order="2"      \n                    Id="SampleTarget" IgnoreMissingFiles="no" />\n            </UpgradeImage>\n        </Family>\n \n        <PatchSequence PatchFamily="SamplePatchFamily"\n            Sequence="1.0.0.0"\n            Supersede="yes" />\n \n    </PatchCreation>\n</Wix>\n')),(0,r.kt)("p",null,"Note that ",(0,r.kt)("b",null,"SequenceStart")," must be greater than the last sequence in the File table in the target package or the patch will not install."),(0,r.kt)("h2",{id:"build-the-target-and-upgrade-packages"},"Build the Target and Upgrade Packages"),(0,r.kt)("p",null,"Open a command prompt and make sure the following WiX and Windows Installer SDK tools are in your PATH."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Candle.exe"),(0,r.kt)("li",{parentName:"ul"},"Light.exe"),(0,r.kt)("li",{parentName:"ul"},"MsiMsp.exe"),(0,r.kt)("li",{parentName:"ul"},"PatchWiz.dll"),(0,r.kt)("li",{parentName:"ul"},"MSPatchC.dll"),(0,r.kt)("li",{parentName:"ul"},"MakeCab.exe")),(0,r.kt)("h3",{id:"build-the-target-package"},"Build the target package"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"candle.exe -dVersion=1.0 product.wxs\nlight.exe product.wixobj -out 1.0\\product.msi\n")),(0,r.kt)("h3",{id:"perform-an-administrative-installation-of-the-target-package"},"Perform an administrative installation of the target package"),(0,r.kt)("p",null,"Msiexec.exe is used to perform an administrative installation but nothing is actually registered on your system. It is mainly file extraction."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msiexec.exe /a 1.0\\product.msi /qb TARGETDIR=C:\\sample\\1.0\\admin\n")),(0,r.kt)("h3",{id:"build-the-upgrade-package"},"Build the upgrade package"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"candle.exe -dVersion=1.1 product.wxs\nlight.exe product.wixobj -out 1.1\\product.msi\n")),(0,r.kt)("h3",{id:"perform-an-administrative-installation-of-the-upgrade-package"},"Perform an administrative installation of the upgrade package"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msiexec.exe /a 1.1\\product.msi /qb TARGETDIR=C:\\sample\\1.1\\admin\n")),(0,r.kt)("h2",{id:"build-the-patch"},"Build the Patch"),(0,r.kt)("p",null,"The Patch.wxs file is compiled into a PCP file that is then processed by MsiMsp.exe to product the patch package."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"candle.exe patch.wxs\nlight.exe patch.wixobj -out patch\\patch.pcp\nmsimsp.exe -s patch\\patch.pcp -p patch\\patch.msp -l patch.log\n")),(0,r.kt)("h2",{id:"verify-the-patch"},"Verify the Patch"),(0,r.kt)("p",null,"To verify that the patch works, install the product and then the patch."),(0,r.kt)("h3",{id:"install-the-10-product"},"Install the 1.0 product"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msiexec.exe /i 1.0\\product.msi /l*vx install.log\n")),(0,r.kt)("h3",{id:"verify-version-10"},"Verify version 1.0"),(0,r.kt)("p",null,"Go to ",'"',"Program Files\\Patch Sample Directory",'"'," and open Sample.txt. Verify that this is the 1.0 version. Close Sample.txt."),(0,r.kt)("h3",{id:"install-the-patch"},"Install the patch"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msiexec.exe /p patch\\patch.msp /l*vx patch.log\n")),(0,r.kt)("h3",{id:"verify-version-11"},"Verify version 1.1"),(0,r.kt)("p",null,"Go to ",'"',"Program Files\\Patch Sample Directory",'"'," and open Sample.txt. Verify that this is now the 1.1 version. Close Sample.txt."),(0,r.kt)("h3",{id:"uninstall-the-patch"},"Uninstall the patch"),(0,r.kt)("p",null,"On Windows XP Service Pack 2 and Windows Server 2003, go to ",'"',"Add/Remove Programs",'"'," in the Control Panel and make sure that Show Updates is checked. On Windows Vista and newer, go to ",'"',"Programs",'"'," then ",'"',"View installed updates",'"'," in the Control panel. Select ",'"',"Sample Patch",'"'," from under ",'"',"WiX Patch Example Product",'"'," and click the Uninstall button."),(0,r.kt)("p",null,"Go to ",'"',"Program files\\Patch Sample Directory",'"'," and open Sample.txt. Verify that this is again the 1.0 version. Close Sample.txt."),(0,r.kt)("h3",{id:"uninstall-the-product"},"Uninstall the product"),(0,r.kt)("p",null,"On Windows XP Service Pack 2 and Windows Server 2003, go to ",'"',"Add/Remove Programs",'"'," in the Control Panel. On Windows Vista and newer, go to ",'"',"Programs",'"'," then ",'"',"Uninstall a program",'"'," in the Control Panel. Select ",'"',"WiX Patch Example Product",'"'," and click the Uninstall button."),(0,r.kt)("h2",{id:"restrictions"},"Restrictions"),(0,r.kt)("p",null,"Please review ",(0,r.kt)("a",{parentName:"p",href:"/wixtoolset/docs/v3/patching/patch_restrictions"},"restrictions")," on how patches must be built to avoid problem during patch installation."))}m.isMDXComponent=!0}}]);