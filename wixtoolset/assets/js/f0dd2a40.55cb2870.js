"use strict";(self.webpackChunkwixweb=self.webpackChunkwixweb||[]).push([[26915],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>f});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),d=c(r),m=o,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return r?n.createElement(f,l(l({ref:t},p),{},{components:r})):n.createElement(f,l({ref:t},p))}));function f(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,l=new Array(i);l[0]=m;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a[d]="string"==typeof e?e:o,l[1]=a;for(var c=2;c<i;c++)l[c]=r[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},11361:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>f,frontMatter:()=>a,metadata:()=>c,toc:()=>d});r(67294);var n=r(3905);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}const a={wip:4259,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Collapse Duplicate Directories"},s=void 0,c={unversionedId:"development/wips/collapse-duplicate-directories",id:"development/wips/collapse-duplicate-directories",title:"Collapse Duplicate Directories",description:"User stories",source:"@site/docs/development/wips/4259-collapse-duplicate-directories.md",sourceDirName:"development/wips",slug:"/development/wips/collapse-duplicate-directories",permalink:"/wixtoolset/docs/development/wips/collapse-duplicate-directories",draft:!1,editUrl:"https://github.com/wixtoolset/web/tree/master/src/Docusaurus/docs/development/wips/4259-collapse-duplicate-directories.md",tags:[],version:"current",sidebarPosition:4259,frontMatter:{wip:4259,type:"Feature",by:"Rob Mensching (rob at firegiant.com)",title:"Collapse Duplicate Directories"},sidebar:"docsSidebar",previous:{title:"Identifier Access Modifiers",permalink:"/wixtoolset/docs/development/wips/identifier-access-modifiers"},next:{title:"Inline Directory Syntax",permalink:"/wixtoolset/docs/development/wips/inline-directory-syntax"}},p={},d=[{value:"User stories",id:"user-stories",level:2},{value:"Proposal",id:"proposal",level:2},{value:"Considerations",id:"considerations",level:2},{value:"See also",id:"see-also",level:2}],u={toc:d},m="wrapper";function f(e){var{components:t}=e,r=l(e,["components"]);return(0,n.kt)(m,i(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){o(e,t,r[t])}))}return e}({},u,r),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"user-stories"},"User stories"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"As a setup developer I can define the same Directory element in multiple Fragments so directories can be written more like registry keys.")),(0,n.kt)("h2",{id:"proposal"},"Proposal"),(0,n.kt)("p",null,"Folders (directories, by another name) are a bit unique in that they are generally installed and uninstalled as needed by the Windows Installer.\nRegistry keys (not values) share the same behavior. However, unlike registry keys, the Windows Installer requires each folder in a path to be defined\nas a row in the Directory table. The WiX toolset followed the Windows Installer design and requires each folder to have a unique Directory element."),(0,n.kt)("p",null,'Unfortunately, this design decision means the ideal way to define folders is to define them centrally in a highly fragmented fashion. For example, a "Folders.wxs" file that looks like:'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'<Fragment>\n  <Directory Id="TARGETDIR" Name="SourceDir" />\n</Fragment>\n\n<Fragment>\n  <DirectoryRef Id="TARGETDIR">\n    <Directory Id="ProgramFilesFolder" Name="PFiles" />\n  </Directory>\n</Fragment>\n\n<Fragment>\n  <DirectoryRef Id="ProgamFilesFolder">\n    <Directory Id="ManufacturerFolder" Name="My Company" />\n  </Directory>\n</Fragment>\n\n<Fragment>\n  <DirectoryRef Id="ProgamFilesFolder">\n    <Directory Id="INSTALLFOLDER" Name="My Product" />\n  </Directory>\n</Fragment>\n')),(0,n.kt)("p",null,"And so on. The single file (or few set of files) invites merge collisions. The highly fragmented design makes it challenging to see the final path structure. These problems can be partially addressed by allowing duplicate Directory rows to be collapsed (combined) by the linker. That would allow\nthe following to exist:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'\x3c!-- file1.wxs --\x3e\n<Fragment>\n  <DirectoryRef Id="INSTALLFOLDER">\n    <Directory Id="BinFolder" Name="bin" />\n  </DirectoryRef>\n\n  <ComponentGroup Id="Stuff1" Directory="BinFolder">\n    \x3c!-- many Component elements here --\x3e\n  </ComponentGroup>\n</Fragment>\n\n\x3c!-- file2.wxs --\x3e\n<Fragment>\n  <DirectoryRef Id="INSTALLFOLDER">\n    <Directory Id="BinFolder" Name="bin" />\n  </DirectoryRef>\n\n  <ComponentGroup Id="Stuff2" Directory="BinFolder">\n    \x3c!-- many Component elements here --\x3e\n  </ComponentGroup>\n</Fragment>\n')),(0,n.kt)("p",null,'In that example the "BinFolder" would be collapsed. This proposal becomes even more interesting when combined with ',"[WIP:4260]","."),(0,n.kt)("h2",{id:"considerations"},"Considerations"),(0,n.kt)("p",null,"One problem with this proposal is that a single DirectoryRef element could now cause the linker to bring in multiple sections. Using the example above, a ",(0,n.kt)("inlineCode",{parentName:"p"},'<DirectoryRef Id="BinFolder" />')," would bring in both listed Fragments. This is new behavior and has a very sersious issue. The content of the final output would now be partially dependent on the list of files provided to the linker. That goes against one of the core designs of the WiX toolset."),(0,n.kt)("p",null,"This problem can be mitigated with ","[access modifiers for identifiers][WIP:4258]",' and only allowing collapsing to happen between "private" duplicated Directory symbols. That would change the example above to look more like the following and prevent references from other sections:'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'\x3c!-- file1.wxs --\x3e\n<Fragment>\n  <DirectoryRef Id="INSTALLFOLDER">\n    <Directory Id="fragment BinFolder" Name="bin" />\n  </DirectoryRef>\n\n  <ComponentGroup Id="Stuff1" Directory="BinFolder">\n    \x3c!-- many Component elements here --\x3e\n  </ComponentGroup>\n</Fragment>\n\n\x3c!-- file2.wxs --\x3e\n<Fragment>\n  <DirectoryRef Id="INSTALLFOLDER">\n    <Directory Id="fragment BinFolder" Name="bin" />\n  </DirectoryRef>\n\n  <ComponentGroup Id="Stuff2" Directory="BinFolder">\n    \x3c!-- many Component elements here --\x3e\n  </ComponentGroup>\n</Fragment>\n')),(0,n.kt)("h2",{id:"see-also"},"See also"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"http://wixtoolset.org/issues/4259/"},"WIXFEAT:4259"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/wixtoolset/docs/development/wips/identifier-access-modifiers"},"WIP:4258"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/wixtoolset/docs/development/wips/inline-directory-syntax"},"WIP:4260")))))}f.isMDXComponent=!0}}]);