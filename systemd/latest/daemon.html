<html><head><style data-id="immersive-translate-default-injected-css">:root {
  --immersive-translate-theme-underline-borderColor: #72ece9;
  --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
  --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
  --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
  --immersive-translate-theme-highlight-backgroundColor: #ffff00;
  --immersive-translate-theme-dashed-borderColor: #59c1bd;
  --immersive-translate-theme-blockquote-borderColor: #cc3355;
  --immersive-translate-theme-thinDashed-borderColor: #ff374f;
  --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
  --immersive-translate-theme-dashedBorder-borderRadius: 0;
  --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
  --immersive-translate-theme-solidBorder-borderRadius: 0;
  --immersive-translate-theme-dotted-borderColor: #94a3b8;
  --immersive-translate-theme-wavy-borderColor: #72ece9;
  --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
  --immersive-translate-theme-grey-textColor: #2f4f4f;
  --immersive-translate-theme-marker-backgroundColor: #fbda41;
  --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
  --immersive-translate-theme-marker2-backgroundColor: #ffff00;
  --immersive-translate-theme-opacity-opacity: 10;
}

.immersive-translate-target-translation-pre-whitespace {
  white-space: pre-wrap !important;
}

.immersive-translate-pdf-target-container {
  position: absolute;
  background-color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
    sans-serif;
  top: 0;
  width: 600px;
  height: 100%;
  z-index: 2;
  line-height: 1.3;
  font-size: 16px;
}
.immersive-translate-target-wrapper[dir='rtl'] {
  text-align: right;
}

.immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
  color: rgb(0, 0, 0);
  white-space: normal;
  position: absolute;
}

.immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
  color: inherit;
  white-space: inherit;
  position: unset;
}

.immersive-translate-state-dual>br {
  display: none;
}

.immersive-translate-target-translation-block-wrapper {
  margin: 8px 0 !important;
  display: inline-block;
}

.immersive-translate-target-translation-pdf-block-wrapper {
  margin: 0 !important;
  display: block;
}

.immersive-translate-target-translation-theme-grey-inner {
  color: var(--immersive-translate-theme-grey-textColor);
}


.immersive-translate-target-translation-theme-underline-inner {
  border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
}

.immersive-translate-target-translation-theme-nativeUnderline-inner {
  text-decoration: underline !important;
  text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
}

.immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
  border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
  border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
  padding: 6px;
  margin-top: 2px;
  display: block;
}

.immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
  border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
  border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
  padding: 2px;
}

.immersive-translate-target-translation-block-wrapper-theme-solidBorder {
  border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
  border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
  padding: 6px;
  margin-top: 2px;
  display: block;
}

.immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
  border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
  border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
  padding: 2px;
}

.immersive-translate-target-translation-theme-nativeDashed-inner {
  text-decoration: underline !important;
  text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
  text-decoration-style: dashed !important;
}

.immersive-translate-target-translation-theme-thinDashed-inner {
  border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
}

.immersive-translate-target-translation-theme-dotted-inner {
  background-image: linear-gradient(to right,
      var(--immersive-translate-theme-dotted-borderColor) 30%,
      rgba(255, 255, 255, 0) 0%);
  background-position: bottom;
  background-size: 5px 1px;
  background-repeat: repeat-x;
  padding-bottom: 3px;
}

.immersive-translate-target-translation-theme-nativeDotted-inner {
  text-decoration: underline !important;
  text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
  text-decoration-style: dotted !important;
}

.immersive-translate-target-translation-theme-wavy-inner {
  text-decoration: underline !important;
  text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
  text-decoration-style: wavy !important;
}

.immersive-translate-target-translation-theme-dashed-inner {
  background: linear-gradient(to right,
      var(--immersive-translate-theme-dashed-borderColor) 0%,
      var(--immersive-translate-theme-dashed-borderColor) 50%,
      transparent 50%,
      transparent 100%) repeat-x left bottom;
  background-size: 8px 2px;
  padding-bottom: 2px;
}

.immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
  content: "";
  display: block;
  max-width: 80px;
  width: 10%;
  border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
  padding-top: 8px;
}

.immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
  content: "";
  border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
  max-height: 16px;
  height: 16px;
  padding-left: 8px;
}

.immersive-translate-target-translation-theme-highlight-inner {
  background: var(--immersive-translate-theme-highlight-backgroundColor);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

.immersive-translate-target-translation-block-wrapper-theme-marker {
  line-height: 1.5em;
}

.immersive-translate-target-translation-theme-marker2-inner {
  font-weight: bold;
  text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
    16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
    2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
    -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
}

.immersive-translate-target-translation-theme-marker-inner {
  /* TODO: add more texture */
  background: linear-gradient(to right,
      rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
      rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
      rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
      rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
      rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
      rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

.immersive-translate-target-translation-theme-weakening {
  opacity: 0.618 !important;
}

.immersive-translate-target-translation-theme-italic {
  font-style: italic !important;
}

.immersive-translate-target-translation-theme-bold {
  font-weight: bold !important;
}

.immersive-translate-target-translation-block-wrapper-theme-paper {
  margin: 8px 0;
  box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
  padding: 16px 32px;
  display: block;
}

.immersive-translate-target-translation-block-wrapper-theme-blockquote {
  border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
  padding-left: 12px !important;
  margin-top: 4px;
  margin-bottom: 4px;
  padding-top: 4px;
  padding-bottom: 4px;
  display: block;
}

.immersive-translate-target-translation-theme-mask-inner {
  filter: blur(5px) !important;
  transition: filter 0.3s ease !important;
  border-radius: 10px;
  display: inline-block;
}

[data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
  filter: none !important;
}

[data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
  filter: blur(5px) !important;
  transition: filter 0.3s ease !important;
  border-radius: 10px;
  display: inline-block;
}


/* opacity theme start */

.immersive-translate-target-translation-theme-opacity-inner {
  filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
  transition: filter 0.3s ease !important;
  border-radius: 10px;
  display: inline-block;
}

[data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
  filter: none !important;
}
[data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,.immersive-translate-target-translation-theme-opacity-inner:hover {
  filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
  transition: filter 0.3s ease !important;
  border-radius: 10px;
  display: inline-block;
}

.immersive-translate-target-translation-theme-opacity-inner:hover {
  filter: none !important;
}


.immersive-translate-target-translation-theme-mask-inner:hover {
  filter: none !important;
}
[data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
  filter: none !important;
}


[data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
  filter: none !important;
}

/* opacity theme end */

/* vertical css , please remain it in the last one. */
.immersive-translate-target-translation-vertical-block-wrapper {
  margin: 0px 8px !important;
}

.immersive-translate-text {
  font-size: 15px !important;
}

.immersive-translate-error-toast {
  position: fixed;
  top: 5%;
  z-index: 99999999;
  left: 0;
  right: 0;
  margin: auto;
  max-width: 300px;
  padding: 16px;
  border-radius: 12px;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex;
  flex-direction: row;
  justify-content: space-between;
}

@media all and (min-width: 750px) {
  .immersive-translate-error-toast {
    max-width: 400px;
  }
}


.immersive-translate-clickable-button {
  cursor: pointer;
}

.immersive-translate-help-button {
  cursor: pointer;
}

.immersive-translate-loading-text:before {
  content: "...";
}


/* dark mode for loading */

@media only screen and (prefers-color-scheme: dark) {
  .immersive-translate-loading {
    border: 2px rgba(255, 255, 255, 0.25) solid !important;
    border-top: 2px rgba(255, 255, 255, 1) solid !important;
  }
}

.immersive-translate-error-wrapper {
  position: relative;
  display: inline-flex;
  padding: 6px;
  margin: 0 12px;
  white-space: nowrap;
  font-size: 0.9em;
}
[lang="zh-CN"] .immersive-translate-error-wrapper {
  font-size: 0.75em;
}
[lang="zh-TW"] .immersive-translate-error-wrapper {
  font-size: 0.75em;
}


.immersive-translate-tooltip {
  position: relative;
  display: inline-flex;
  /* little indicater to indicate it's hoverable */
}

.immersive-translate-tooltip-content {
  /* here's the magic */
  position: absolute;
  z-index: 100000000000;

  left: 50%;
  bottom: 0;
  transform: translate(-50%, 110%);
  line-height: 1;
  /* and add a small left margin */

  /* basic styles */
  width: max-content;
  max-width: 250px;
  word-wrap: break-word;
  white-space: pre-line;
  padding: 10px;
  border-radius: 10px;
  background: #000C;
  color: #fff;
  text-align: center;
  font-size: 14px;
  display: none;
  /* hide by default */
}

.immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
  display: block;
}

.immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
  display: block;
}

.immersive-translate-tooltip-content-table {
  left: unset !important;
  bottom: unset !important;
  transform: translate(-10%, 50%) !important;
}


.immersive-translate-tooltip:hover:before {
  display: block;
}



.immersive-translate-loading-spinner {
  vertical-align: middle !important;
  width: 10px !important;
  height: 10px !important;
  display: inline-block !important;
  margin: 0 4px !important;
  border: 2px rgba(221, 244, 255, 0.6) solid !important;
  border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-radius: 50% !important;
  padding: 0 !important;
  -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
  animation: immersive-translate-loading-animation 0.6s infinite linear !important;
}

@-webkit-keyframes immersive-translate-loading-animation {
  from {
    -webkit-transform: rotate(0deg);
  }

  to {
    -webkit-transform: rotate(359deg);
  }
}

@keyframes immersive-translate-loading-animation {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(359deg);
  }
}
</style><style data-id="immersive-translate-user-custom-style">:root {

.immersive-translate-target-inner { font-family: inherit; }
}
</style><style data-id="immersive-translate-dynamic-injected-css">.immersive-translate-target-wrapper[dir='rtl'] {text-align: right;}
.immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {display:block;}
.immersive-translate-target-wrapper {word-break: break-word;}
</style></head><body data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>daemon</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><script src="https://code.jquery.com/jquery-3.7.1.min.js"></script><script src="../nav.js"></script><style>
    a.headerlink {
      color: #c60f0f;
      font-size: 0.8em;
      padding: 0 4px 0 4px;
      text-decoration: none;
      visibility: hidden;
    }

    a.headerlink:hover {
      background-color: #c60f0f;
      color: white;
    }

    h1:hover > a.headerlink, h2:hover > a.headerlink, h3:hover > a.headerlink, dt:hover > a.headerlink {
      visibility: visible;
    }
  </style><a href="index.html" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Index </a>·
  <a href="systemd.directives.html" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Directives </a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">索引 · 指令</font></font></font><span style="float:right" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">systemd 255</span><hr><div class="refentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="daemon" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><div class="titlepage" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></div><div class="refnamediv" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><h2 data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Name<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">名称</font></font></font></h2><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">daemon — Writing and packaging system daemons<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">守护程序 — 编写和打包系统守护程序</font></font></font></p></div><div class="refsect1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.4" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h2 id="Description" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Description<a class="headerlink" title="Permalink to this headline" href="#Description" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">描述</font></font></font></h2><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">A daemon is a service process that runs in the background
    and supervises the system or provides functionality to other
    processes. Traditionally, daemons are implemented following a
    scheme originating in SysV Unix. Modern daemons should follow a
    simpler yet more powerful scheme (here called "new-style"
    daemons), as implemented by
    <a href="systemd.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd</span>(1)</span></a>.
    This manual page covers both schemes, and in particular includes
    recommendations for daemons that shall be included in the systemd
    init system.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">守护程序是在后台运行并监督系统或为其他进程提供功能的服务进程。传统上，守护程序是按照 SysV Unix 中源自的方案实现的。现代守护程序应该遵循一个更简单但更强大的方案（这里称为“新式”守护程序），如 systemd(1) 所实现的。本手册涵盖了这两种方案，特别是包括了应该包含在 systemd 启动系统中的守护程序的建议。</font></font></font></p><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.4.3" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="SysV Daemons" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">SysV Daemons<a class="headerlink" title="Permalink to this headline" href="#SysV%20Daemons" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">SysV 守护程序 ¶</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">When a traditional SysV daemon starts, it should execute
      the following steps as part of the initialization. Note that
      these steps are unnecessary for new-style daemons (see below),
      and should only be implemented if compatibility with SysV is
      essential.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">当传统的 SysV 守护程序启动时，作为初始化的一部分，应执行以下步骤。请注意，这些步骤对于新式守护程序（见下文）是不必要的，只有在与 SysV 的兼容性是必要的情况下才应实现。</font></font></font></p><div class="orderedlist" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><ol class="orderedlist" type="1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Close all open file descriptors except
        standard input, output, and error (i.e. the first three file
        descriptors 0, 1, 2). This ensures that no accidentally passed
        file descriptor stays around in the daemon process. On Linux,
        this is best implemented by iterating through
        <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/proc/self/fd</code>, with a fallback of
        iterating from file descriptor 3 to the value returned by
        <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">getrlimit()</code> for
        <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">RLIMIT_NOFILE</code>. <font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">关闭除标准输入、输出和错误之外的所有打开文件描述符（即前三个文件描述符 0、1、2）。这可以确保没有意外传递的文件描述符留在守护进程中。在 Linux 上，最好通过迭代 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/proc/self/fd</code> 实现，如果失败，则从文件描述符 3 迭代到 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">getrlimit()</code> 返回的值为止。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Reset all signal handlers to their default.
        This is best done by iterating through the available signals
        up to the limit of <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">_NSIG</code> and resetting
        them to <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SIG_DFL</code>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">将所有信号处理程序重置为它们的默认值。最好通过迭代可用信号直到 <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">_NSIG</code> 的限制，并将它们重置为 <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SIG_DFL</code> 来实现。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Reset the signal mask
        using
        <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sigprocmask()</code>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">使用 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sigprocmask()</code> 重置信号掩码。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Sanitize the environment block, removing or
        resetting environment variables that might negatively impact
        daemon runtime.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">对环境块进行清理，删除或重置可能对守护程序运行时产生负面影响的环境变量。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Call <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fork()</code>, to create a
        background process.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">调用 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fork()</code> ，创建一个后台进程。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the child, call
        <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">setsid()</code> to detach from any terminal and
        create an independent session.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在子进程中，调用 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">setsid()</code> 来分离任何终端并创建独立会话。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the child, call <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fork()</code> again, to ensure that the daemon can
        never re-acquire a terminal again. (This relevant if the program — and all its dependencies — does
        not carefully specify `O_NOCTTY` on each and every single `open()` call that might potentially open a
        TTY device node.)<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在子进程中再次调用 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fork()</code> ，以确保守护进程永远无法重新获取终端。（如果程序及其所有依赖项没有在每个可能打开 TTY 设备节点的`open()`调用上仔细指定`O_NOCTTY`，则这一点很重要。）</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Call <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">exit()</code> in the first
        child, so that only the second child (the actual daemon
        process) stays around. This ensures that the daemon process is
        re-parented to init/PID 1, as all daemons should
        be.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在第一个子进程中调用 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">exit()</code> ，以便只有第二个子进程（实际的守护进程）保留下来。这确保了守护进程被重新分配到 init/PID 1，就像所有守护进程应该做的那样。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the daemon process, connect
        <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/dev/null</code> to standard input, output, and
        error.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在守护进程中，将 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/dev/null</code> 连接到标准输入、输出和错误。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the daemon process, reset the umask to 0,
        so that the file modes passed to <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">open()</code>,
        <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">mkdir()</code> and suchlike directly control the
        access mode of the created files and
        directories.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在守护进程中，将 umask 重置为 0，以便传递给 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">open()</code> 、 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">mkdir()</code> 等的文件模式直接控制所创建文件和目录的访问模式。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the daemon process, change the current
        directory to the root directory (/), in order to avoid that
        the daemon involuntarily blocks mount points from being
        unmounted.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在守护进程中，将当前目录更改为根目录（/），以避免守护进程无意中阻止挂载点被卸载。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the daemon process, write the daemon PID
        (as returned by <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">getpid()</code>) to a PID file,
        for example <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/run/foobar.pid</code> (for a
        hypothetical daemon "foobar") to ensure that the daemon cannot
        be started more than once. This must be implemented in
        race-free fashion so that the PID file is only updated when it
        is verified at the same time that the PID previously stored in
        the PID file no longer exists or belongs to a foreign
        process.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在守护进程中，将守护进程的 PID（由 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">getpid()</code> 返回）写入一个 PID 文件，例如 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/run/foobar.pid</code> （对于一个假想的守护进程“foobar”），以确保守护进程不能被启动多次。这必须以无竞争的方式实现，以便仅在验证 PID 文件时更新 PID 文件，同时验证之前存储在 PID 文件中的 PID 不再存在或属于外部进程。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the daemon process, drop privileges, if
        possible and applicable.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在守护进程中，如果可能和适用的话，降低权限。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">From the daemon process, notify the original
        process started that initialization is complete. This can be
        implemented via an unnamed pipe or similar communication
        channel that is created before the first
        <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fork()</code> and hence available in both the
        original and the daemon process.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">从守护进程中，通知启动的原始进程初始化已完成。这可以通过一个未命名管道或类似的通信渠道实现，在第一个 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fork()</code> 之前创建，并且在原始进程和守护进程中都可用。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Call <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">exit()</code> in the
        original process. The process that invoked the daemon must be
        able to rely on that this <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">exit()</code> happens
        after initialization is complete and all external
        communication channels are established and
        accessible.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在原始进程中调用 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">exit()</code> 。调用守护进程的进程必须能够依赖于初始化完成后发生的这一点，并且所有外部通信渠道都已建立并可访问。</font></font></font></p></li></ol></div><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">The BSD <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">daemon()</code> function should not
      be used, as it implements only a subset of these steps.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">不应使用 BSD <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">daemon()</code> 函数，因为它仅实现这些步骤的子集。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">A daemon that needs to provide compatibility with SysV
      systems should implement the scheme pointed out above. However,
      it is recommended to make this behavior optional and
      configurable via a command line argument to ease debugging as
      well as to simplify integration into systems using
      systemd.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">需要与 SysV 系统兼容的守护进程应实现上述指出的方案。但是，建议将此行为设置为可选，并通过命令行参数进行配置，以便简化调试并简化与使用 systemd 的系统集成。</font></font></font></p></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.4.4" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="New-Style Daemons" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">New-Style Daemons<a class="headerlink" title="Permalink to this headline" href="#New-Style%20Daemons" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">新式守护程序 ¶</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Modern services for Linux should be implemented as
      new-style daemons. This makes it easier to supervise and control
      them at runtime and simplifies their implementation.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">Linux 的现代服务应该作为新式守护程序实现。这样可以更容易地在运行时监督和控制它们，并简化它们的实现。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">For developing a new-style daemon, none of the initialization steps recommended for SysV daemons
      need to be implemented. New-style init systems such as systemd make all of them redundant. Moreover,
      since some of these steps interfere with process monitoring, file descriptor passing, and other
      functionality of the service manager, it is recommended not to execute them when run as new-style
      service.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">对于开发新式守护程序，不需要实现 SysV 守护程序推荐的任何初始化步骤。新式的初始化系统（如 systemd）使它们全部变得多余。此外，由于其中一些步骤会干扰进程监控、文件描述符传递和服务管理器的其他功能，建议在作为新式服务运行时不执行它们。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Note that new-style init systems guarantee execution of daemon processes in a clean process context: it is
      guaranteed that the environment block is sanitized, that the signal handlers and mask is reset and that no
      left-over file descriptors are passed. Daemons will be executed in their own session, with standard input
      connected to <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/dev/null</code> and standard output/error connected to the
      <a href="systemd-journald.service.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd-journald.service</span>(8)</span></a>
      logging service, unless otherwise configured. The umask is reset.
      <font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">请注意，新式初始化系统保证在干净的进程上下文中执行守护进程：保证环境块经过清理，信号处理程序和掩码被重置，并且不会传递任何剩余的文件描述符。守护进程将在自己的会话中执行，标准输入连接到 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">/dev/null</code> ，标准输出/错误连接到 systemd-journald.service(8)日志服务，除非另有配置。掩码被重置。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">It is recommended for new-style daemons to implement the
      following:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">建议新式守护进程实现以下内容：</font></font></font></p><div class="orderedlist" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><ol class="orderedlist" type="1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If applicable, the daemon should notify the service manager about startup completion
        or status updates via the
        <a href="sd_notify.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_notify</span>(3)</span></a>
        interface, in particular <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">READY=1</code> and <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">STATUS=…</code>.
        <font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果适用，守护进程应通过 sd_notify(3)接口通知服务管理器有关启动完成或状态更新的信息，特别是 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">READY=1</code> 和 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">STATUS=…</code> 。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SIGTERM</code> is received, shut down the daemon and exit cleanly.
        A <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">STOPPING=1</code> notification should be sent via
        <a href="sd_notify.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_notify</span>(3)</span></a>.
        <font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果收到 <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SIGTERM</code> ，则关闭守护进程并干净地退出。应通过 sd_notify(3) 发送 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">STOPPING=1</code> 通知。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SIGHUP</code> is received, reload the configuration files, if this
        applies. This should be combined with notifications via
        <a href="sd_notify.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_notify</span>(3)</span></a>:
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">RELOADING=1</code> and <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">READY=1</code>.
        <font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果收到 <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SIGHUP</code> ，则重新加载配置文件（如果适用）。这应与通过 sd_notify(3) 发送的通知结合使用： <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">RELOADING=1</code> 和 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">READY=1</code> 。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Provide a correct exit code from the main daemon process, as this is used by the
        service manager to detect service errors and problems. It is recommended to follow the exit code
        scheme as defined in the <a class="ulink" href="http://refspecs.linuxbase.org/LSB_3.1.1/LSB-Core-generic/LSB-Core-generic/iniscrptact.html" target="_top" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">LSB
        recommendations for SysV init scripts</a>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">从主守护进程提供正确的退出代码，因为这将被服务管理器用于检测服务错误和问题。建议遵循 LSB 对 SysV init 脚本定义的退出代码方案。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If possible and applicable, expose the
        daemon's control interface via the D-Bus IPC system and grab a
        bus name as last step of initialization.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果可能且适用，请通过 D-Bus IPC 系统公开守护程序的控制接口，并在初始化的最后一步获取总线名称。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">For integration in systemd, provide a
        <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.service</code> unit file that carries
        information about starting, stopping and otherwise maintaining
        the daemon. See
        <a href="systemd.service.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.service</span>(5)</span></a>
        for details.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">为了在 systemd 中集成，请提供一个包含有关启动、停止和维护守护程序信息的 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.service</code> 单元文件。有关详细信息，请参阅 systemd.service(5)。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">As much as possible, rely on the service manager's functionality to limit the access
        of the daemon to files, services, and other resources, i.e. in the case of systemd, rely on systemd's
        resource limit control instead of implementing your own, rely on systemd's privilege dropping code
        instead of implementing it in the daemon, and so on. See
        <a href="systemd.exec.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.exec</span>(5)</span></a> for
        the available controls.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">尽可能依赖服务管理器的功能来限制守护程序对文件、服务和其他资源的访问，即在 systemd 的情况下，依赖 systemd 的资源限制控制而不是实现自己的控制，依赖 systemd 的特权降级代码而不是在守护程序中实现，等等。有关可用控件，请参阅 systemd.exec(5)。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If D-Bus is used, make your daemon
        bus-activatable by supplying a D-Bus service activation
        configuration file. This has multiple advantages: your daemon
        may be started lazily on-demand; it may be started in parallel
        to other daemons requiring it — which maximizes
        parallelization and boot-up speed; your daemon can be
        restarted on failure without losing any bus requests, as the
        bus queues requests for activatable services. See below for
        details.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果使用 D-Bus，请通过提供 D-Bus 服务激活配置文件使您的守护程序支持总线激活。这有多个优点：您的守护程序可以按需懒惰启动；它可以与需要它的其他守护程序并行启动 —— 这最大程度地提高了并行性和启动速度；您的守护程序可以在失败时重新启动而不会丢失任何总线请求，因为总线会为可激活服务排队请求。有关详细信息，请参见下文。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If your daemon provides services to other
        local processes or remote clients via a socket, it should be
        made socket-activatable following the scheme pointed out
        below. Like D-Bus activation, this enables on-demand starting
        of services as well as it allows improved parallelization of
        service start-up. Also, for state-less protocols (such as
        syslog, DNS), a daemon implementing socket-based activation
        can be restarted without losing a single request. See below
        for details.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果您的守护程序通过套接字向其他本地进程或远程客户端提供服务，则应按照下面指出的方案进行套接字激活。与 D-Bus 激活类似，这样可以按需启动服务，同时还可以改进服务启动的并行性。此外，对于无状态协议（例如 syslog、DNS），实现基于套接字的激活的守护程序可以在不丢失任何请求的情况下重新启动。有关详细信息，请参见下文。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If the service opens sockets or other files on it own, and those file descriptors
        shall survive a restart, the daemon should store them in the service manager via
        <a href="sd_notify.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_notify</span>(3)</span></a> with
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">FDSTORE=1</code>..<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果服务自己打开套接字或其他文件，并且这些文件描述符应在重新启动后保留，守护程序应通过 sd_notify(3) 将它们存储在服务管理器中，格式为 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">FDSTORE=1</code> ..</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Instead of using the <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">syslog()</code> call to log directly to the system
        syslog service, a new-style daemon may choose to simply log to standard error via
        <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fprintf()</code>, which is then forwarded to syslog. If log levels are necessary, these
        can be encoded by prefixing individual log lines with strings like "<code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">&lt;4&gt;</code>" (for
        log level 4 "WARNING" in the syslog priority scheme), following a similar style as the Linux kernel's
        <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">printk()</code> level system. For details, see
        <a href="sd-daemon.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd-daemon</span>(3)</span></a> and
        <a href="systemd.exec.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.exec</span>(5)</span></a>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">而不是直接使用 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">syslog()</code> 调用将日志直接记录到系统 syslog 服务，新式守护程序可以选择通过 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">fprintf()</code> 简单地记录到标准错误，然后转发到 syslog。如果需要日志级别，可以通过在单独的日志行前缀加上类似于“ <code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">&lt;4&gt;</code> ”的字符串来编码这些级别（对应 syslog 优先级方案中的日志级别 4“WARNING”），遵循类似于 Linux 内核的 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">printk()</code> 级别系统的风格。有关详细信息，请参阅 sd-daemon(3)和 systemd.exec(5)。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">As new-style daemons are invoked without a controlling TTY (but as their own session
        leaders) care should be taken to always specify <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">O_NOCTTY</code> on
        <a href="https://man7.org/linux/man-pages/man2/open.2.html" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">open</span>(2)</span></a>
        calls that possibly reference a TTY device node, so that no controlling TTY is accidentally
        acquired.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">由于新式守护程序是在没有控制 TTY 的情况下调用的（但作为它们自己的会话领导者），因此应该始终在可能引用 TTY 设备节点的 open(2)调用上指定 <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">O_NOCTTY</code> ，以免意外获取控制 TTY。</font></font></font></p></li></ol></div><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">These recommendations are similar but not identical to the
      <a class="ulink" href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html" target="_top" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Apple
      MacOS X Daemon Requirements</a>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">这些建议与苹果 MacOS X 守护程序要求类似但并非完全相同。</font></font></font></p></div></div><div class="refsect1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h2 id="Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Activation<a class="headerlink" title="Permalink to this headline" href="#Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">激活</font></font></font></h2><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">New-style init systems provide multiple additional
    mechanisms to activate services, as detailed below. It is common
    that services are configured to be activated via more than one
    mechanism at the same time. An example for systemd:
    <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> might get activated either
    when Bluetooth hardware is plugged in, or when an application
    accesses its programming interfaces via D-Bus. Or, a print server
    daemon might get activated when traffic arrives at an IPP port, or
    when a printer is plugged in, or when a file is queued in the
    printer spool directory. Even for services that are intended to be
    started on system bootup unconditionally, it is a good idea to
    implement some of the various activation schemes outlined below,
    in order to maximize parallelization. If a daemon implements a
    D-Bus service or listening socket, implementing the full bus and
    socket activation scheme allows starting of the daemon with its
    clients in parallel (which speeds up boot-up), since all its
    communication channels are established already, and no request is
    lost because client requests will be queued by the bus system (in
    case of D-Bus) or the kernel (in case of sockets) until the
    activation is completed.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">新式初始化系统提供多种额外机制来激活服务，如下所述。通常服务被配置为通过多种机制同时激活。以 systemd 为例： <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> 可能在蓝牙硬件插入时激活，也可能在应用程序通过 D-Bus 访问其编程接口时激活。或者，打印服务器守护程序可能在 IPP 端口接收到流量时激活，或者在打印机插入时激活，或者在打印机队列目录中排队文件时激活。即使对于那些打算在系统引导时无条件启动的服务，实现下面概述的各种激活方案也是一个好主意，以最大程度地实现并行化。如果一个守护程序实现了一个 D-Bus 服务或监听套接字，实现完整的总线和套接字激活方案允许守护程序与其客户端并行启动（加快引导速度），因为所有通信通道已经建立，而且不会丢失任何请求，因为客户端请求将被总线系统（在 D-Bus 的情况下）或内核（在套接字的情况下）排队，直到激活完成。</font></font></font></p><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5.3" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Activation on Boot" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Activation on Boot<a class="headerlink" title="Permalink to this headline" href="#Activation%20on%20Boot" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">开机激活 ¶</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Old-style daemons are usually activated exclusively on boot (and manually by the administrator)
      via SysV init scripts, as detailed in the <a class="ulink" href="http://refspecs.linuxbase.org/LSB_3.1.1/LSB-Core-generic/LSB-Core-generic/iniscrptact.html" target="_top" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">LSB
      Linux Standard Base Core Specification</a>. This method of activation is supported ubiquitously on
      Linux init systems, both old-style and new-style systems. Among other issues, SysV init scripts have
      the disadvantage of involving shell scripts in the boot process. New-style init systems generally use
      updated versions of activation, both during boot-up and during runtime and using more minimal service
      description files.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">旧式守护进程通常仅在启动时（以及由管理员手动）通过 SysV init 脚本激活，详细信息请参阅 LSB Linux 标准基础核心规范。这种激活方法在 Linux 启动系统中得到了广泛支持，无论是旧式系统还是新式系统。在其他问题中，SysV init 脚本的缺点是在启动过程中涉及 shell 脚本。新式启动系统通常使用更新版本的激活，无论是在启动过程中还是在运行时，并使用更简洁的服务描述文件。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In systemd, if the developer or administrator wants to
      make sure that a service or other unit is activated
      automatically on boot, it is recommended to place a symlink to
      the unit file in the <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.wants/</code> directory of
      either <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">multi-user.target</code> or
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">graphical.target</code>, which are normally used
      as boot targets at system startup. See
      <a href="systemd.unit.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.unit</span>(5)</span></a>
      for details about the <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.wants/</code> directories,
      and
      <a href="systemd.special.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.special</span>(7)</span></a>
      for details about the two boot targets.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在 systemd 中，如果开发人员或管理员希望确保服务或其他单元在启动时自动激活，建议将单元文件的符号链接放置在 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.wants/</code> 目录中，这两个目录通常在系统启动时用作启动目标。有关 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.wants/</code> 目录的详细信息，请参阅 systemd.unit(5)，有关两个启动目标的详细信息，请参阅 systemd.special(7)。</font></font></font></p></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5.4" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Socket-Based Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Socket-Based Activation<a class="headerlink" title="Permalink to this headline" href="#Socket-Based%20Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">基于套接字的激活 ¶</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In order to maximize the possible parallelization and robustness and simplify configuration and
      development, it is recommended for all new-style daemons that communicate via listening sockets to use
      socket-based activation. In a socket-based activation scheme, the creation and binding of the listening
      socket as primary communication channel of daemons to local (and sometimes remote) clients is moved out
      of the daemon code and into the service manager. Based on per-daemon configuration, the service manager
      installs the sockets and then hands them off to the spawned process as soon as the respective daemon is
      to be started. Optionally, activation of the service can be delayed until the first inbound traffic
      arrives at the socket to implement on-demand activation of daemons. However, the primary advantage of
      this scheme is that all providers and all consumers of the sockets can be started in parallel as soon
      as all sockets are established. In addition to that, daemons can be restarted with losing only a
      minimal number of client transactions, or even any client request at all (the latter is particularly
      true for state-less protocols, such as DNS or syslog), because the socket stays bound and accessible
      during the restart, and all requests are queued while the daemon cannot process them.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">为了最大限度地提高可能的并行性和鲁棒性，并简化配置和开发，建议所有通过监听套接字进行通信的新式守护程序使用基于套接字的激活。在基于套接字的激活方案中，将监听套接字的创建和绑定作为守护程序与本地（有时是远程）客户端的主要通信渠道的工作移出守护程序代码并移到服务管理器中。根据每个守护程序的配置，服务管理器安装套接字，然后在相应的守护程序启动时将它们移交给生成的进程。可选地，服务的激活可以延迟到第一批入站流量到达套接字时，以实现守护程序的按需激活。然而，这种方案的主要优势在于，只要所有套接字建立，所有套接字的提供者和消费者就可以并行启动。 除此之外，守护进程可以在重新启动时仅丢失最少数量的客户端事务，甚至根本不丢失任何客户端请求（后者对于无状态协议（如 DNS 或 syslog）尤其有效），因为套接字在重新启动期间保持绑定和可访问，并且所有请求在守护进程无法处理它们时都会排队。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">New-style daemons which support socket activation must be able to receive their sockets from the
      service manager instead of creating and binding them themselves. For details about the programming
      interfaces for this scheme provided by systemd, see
      <a href="sd_listen_fds.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_listen_fds</span>(3)</span></a> and
      <a href="sd-daemon.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd-daemon</span>(3)</span></a>. For
      details about porting existing daemons to socket-based activation, see below. With minimal effort, it
      is possible to implement socket-based activation in addition to traditional internal socket creation in
      the same codebase in order to support both new-style and old-style init systems from the same daemon
      binary.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">支持套接字激活的新式守护进程必须能够从服务管理器接收它们的套接字，而不是自己创建和绑定它们。有关 systemd 提供的此方案的编程接口的详细信息，请参阅 sd_listen_fds(3) 和 sd-daemon(3)。有关将现有守护进程移植到基于套接字的激活的详细信息，请参阅以下内容。通过最小的努力，可以在同一代码库中实现基于套接字的激活，以支持来自同一守护进程二进制文件的新式和旧式 init 系统。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">systemd implements socket-based activation via
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.socket</code> units, which are described in
      <a href="systemd.socket.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.socket</span>(5)</span></a>.
      When configuring socket units for socket-based activation, it is
      essential that all listening sockets are pulled in by the
      special target unit <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sockets.target</code>. It is
      recommended to place a
      <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=sockets.target</code> directive in the
      [Install] section to automatically add such a
      dependency on installation of a socket unit. Unless
      <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">DefaultDependencies=no</code> is set, the necessary
      ordering dependencies are implicitly created for all socket
      units. For more information about
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sockets.target</code>, see
      <a href="systemd.special.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.special</span>(7)</span></a>.
      It is not necessary or recommended to place any additional
      dependencies on socket units (for example from
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">multi-user.target</code> or suchlike) when one is
      installed in <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sockets.target</code>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">systemd 通过 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.socket</code> 单元实现基于套接字的激活，这在 systemd.socket(5)中有描述。在为基于套接字的激活配置套接字单元时，非常重要的是所有监听套接字都被特殊的目标单元 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sockets.target</code> 所吸引。建议在[Install]部分放置一个 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=sockets.target</code> 指令，以便在安装套接字单元时自动添加这样的依赖关系。除非设置了 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">DefaultDependencies=no</code> ，否则所有套接字单元的必要排序依赖关系都会隐式创建。有关 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sockets.target</code> 的更多信息，请参阅 systemd.special(7)。在安装在 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sockets.target</code> 中的套接字单元时，不需要也不建议在套接字单元上放置任何额外的依赖关系（例如来自 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">multi-user.target</code> 或类似的）。</font></font></font></p></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5.5" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Bus-Based Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Bus-Based Activation<a class="headerlink" title="Permalink to this headline" href="#Bus-Based%20Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">基于总线的激活 ¶</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">When the D-Bus IPC system is used for communication with clients, new-style daemons should use
      bus activation so that they are automatically activated when a client application accesses their IPC
      interfaces. This is configured in D-Bus service files (not to be confused with systemd service unit
      files!). To ensure that D-Bus uses systemd to start-up and maintain the daemon, use the
      <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SystemdService=</code> directive in these service files to configure the matching systemd
      service for a D-Bus service. e.g.: For a D-Bus service whose D-Bus activation file is named
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">org.freedesktop.RealtimeKit.service</code>, make sure to set
      <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SystemdService=rtkit-daemon.service</code> in that file to bind it to the systemd service
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">rtkit-daemon.service</code>. This is needed to make sure that the daemon is started in a
      race-free fashion when activated via multiple mechanisms simultaneously.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">当使用 D-Bus IPC 系统与客户端进行通信时，新式守护程序应该使用总线激活，这样当客户端应用程序访问它们的 IPC 接口时，它们会自动激活。这是在 D-Bus 服务文件中配置的（不要与 systemd 服务单元文件混淆！）。为了确保 D-Bus 使用 systemd 来启动和维护守护程序，需要在这些服务文件中使用 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SystemdService=</code> 指令来配置 D-Bus 服务的匹配 systemd 服务。例如：对于一个名为 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">org.freedesktop.RealtimeKit.service</code> 的 D-Bus 服务，确保在该文件中设置 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SystemdService=rtkit-daemon.service</code> 以将其绑定到 systemd 服务 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">rtkit-daemon.service</code> 。这是为了确保当通过多种机制同时激活时，守护程序能够以无竞争的方式启动。</font></font></font></p></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5.6" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Device-Based Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Device-Based Activation<a class="headerlink" title="Permalink to this headline" href="#Device-Based%20Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">基于设备的激活 ¶</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Often, daemons that manage a particular type of hardware
      should be activated only when the hardware of the respective
      kind is plugged in or otherwise becomes available. In a
      new-style init system, it is possible to bind activation to
      hardware plug/unplug events. In systemd, kernel devices
      appearing in the sysfs/udev device tree can be exposed as units
      if they are tagged with the string "<code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd</code>".
      Like any other kind of unit, they may then pull in other units
      when activated (i.e. plugged in) and thus implement device-based
      activation. systemd dependencies may be encoded in the udev
      database via the <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SYSTEMD_WANTS=</code> property. See
      <a href="systemd.device.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.device</span>(5)</span></a>
      for details. Often, it is nicer to pull in services from devices
      only indirectly via dedicated targets. Example: Instead of
      pulling in <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> from all the
      various bluetooth dongles and other hardware available, pull in
      bluetooth.target from them and
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> from that target. This
      provides for nicer abstraction and gives administrators the
      option to enable <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> via
      controlling a <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetooth.target.wants/</code>
      symlink uniformly with a command like <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">enable</strong></span>
      of
      <a href="systemctl.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemctl</span>(1)</span></a>
      instead of manipulating the udev ruleset.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">经常，管理特定类型硬件的守护进程应仅在相应类型的硬件插入或变为可用时激活。在新式初始化系统中，可以将激活绑定到硬件插拔事件。在 systemd 中，出现在 sysfs/udev 设备树中的内核设备如果标记为字符串 " <code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd</code> "，则可以将其公开为单元。与任何其他类型的单元一样，它们在激活（即插入）时可能会拉入其他单元，从而实现基于设备的激活。通过 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">SYSTEMD_WANTS=</code> 属性，systemd 依赖关系可以编码在 udev 数据库中。有时，最好只通过专用目标间接地从设备中拉入服务。例如：不要从所有各种蓝牙适配器和其他可用硬件中拉入 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> ，而是从中拉入 bluetooth.target，并从该目标中拉入 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> 。这提供了更好的抽象，并使管理员可以通过像 systemctl(1) 的 enable 命令统一地控制 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetooth.target.wants/</code> 符号链接以启用 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">bluetoothd.service</code> ，而不是操作 udev 规则集。</font></font></font></p></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5.7" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Path-Based Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Path-Based Activation<a class="headerlink" title="Permalink to this headline" href="#Path-Based%20Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">基于路径的激活</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Often, runtime of daemons processing spool files or
      directories (such as a printing system) can be delayed until
      these file system objects change state, or become non-empty.
      New-style init systems provide a way to bind service activation
      to file system changes. systemd implements this scheme via
      path-based activation configured in <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.path</code>
      units, as outlined in
      <a href="systemd.path.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.path</span>(5)</span></a>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">通常，处理溢出文件或目录（例如打印系统）的守护程序的运行时间可能会延迟，直到这些文件系统对象改变状态或变为空。新式的初始化系统提供了一种将服务激活与文件系统更改绑定的方法。systemd 通过在 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.path</code> 单元中配置基于路径的激活来实现这一方案，如 systemd.path(5)中所述。</font></font></font></p></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5.8" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Timer-Based Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Timer-Based Activation<a class="headerlink" title="Permalink to this headline" href="#Timer-Based%20Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">基于定时器的激活</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Some daemons that implement clean-up jobs that are
      intended to be executed in regular intervals benefit from
      timer-based activation. In systemd, this is implemented via
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.timer</code> units, as described in
      <a href="systemd.timer.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.timer</span>(5)</span></a>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">一些实现定期执行清理作业的守护程序受益于基于定时器的激活。在 systemd 中，这是通过 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.timer</code> 单元实现的，如 systemd.timer(5)中所述。</font></font></font></p></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.5.9" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Other Forms of Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Other Forms of Activation<a class="headerlink" title="Permalink to this headline" href="#Other%20Forms%20of%20Activation" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">其他激活形式 ¶</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Other forms of activation have been suggested and implemented in some systems. However, there are
      often simpler or better alternatives, or they can be put together of combinations of the schemes above.
      Example: Sometimes, it appears useful to start daemons or <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.socket</code> units when a
      specific IP address is configured on a network interface, because network sockets shall be bound to the
      address. However, an alternative to implement this is by utilizing the Linux
      <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">IP_FREEBIND</code>/<code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">IPV6_FREEBIND</code> socket option, as accessible via
      <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">FreeBind=yes</code> in systemd socket files (see
      <a href="systemd.socket.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.socket</span>(5)</span></a> for
      details). This option, when enabled, allows sockets to be bound to a non-local, not configured IP
      address, and hence allows bindings to a particular IP address before it actually becomes available,
      making such an explicit dependency to the configured address redundant. Another often suggested trigger
      for service activation is low system load. However, here too, a more convincing approach might be to
      make proper use of features of the operating system, in particular, the CPU or I/O scheduler of Linux.
      Instead of scheduling jobs from userspace based on monitoring the OS scheduler, it is advisable to
      leave the scheduling of processes to the OS scheduler itself. systemd provides fine-grained access to
      the CPU and I/O schedulers. If a process executed by the service manager shall not negatively impact
      the amount of CPU or I/O bandwidth available to other processes, it should be configured with
      <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">CPUSchedulingPolicy=idle</code> and/or <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">IOSchedulingClass=idle</code>.
      Optionally, this may be combined with timer-based activation to schedule background jobs during runtime
      and with minimal impact on the system, and remove it from the boot phase itself.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">其他激活形式已被建议并在一些系统中实施。然而，通常存在更简单或更好的替代方案，或者它们可以由上述方案的组合组成。例如：有时，在配置网络接口上的特定 IP 地址时，启动守护进程或 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.socket</code> 单元似乎很有用，因为网络套接字应绑定到该地址。然而，实现此目的的另一种选择是利用 Linux <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">IP_FREEBIND</code> / <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">IPV6_FREEBIND</code> 套接字选项，通过 systemd 套接字文件中可通过 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">FreeBind=yes</code> 访问（有关详细信息，请参阅 systemd.socket(5)）。启用此选项后，套接字可以绑定到非本地、未配置的 IP 地址，因此允许在实际可用之前将绑定到特定 IP 地址，使得对配置的地址的显式依赖变得多余。另一个经常建议用于服务激活的触发器是低系统负载。然而，在这里，更有说服力的方法可能是充分利用操作系统的特性，特别是 Linux 的 CPU 或 I/O 调度程序。 不建议基于监视操作系统调度程序从用户空间调度作业，而是建议将进程的调度留给操作系统调度程序本身。systemd 提供对 CPU 和 I/O 调度程序的细粒度访问。如果由服务管理器执行的进程不应对其他进程可用的 CPU 或 I/O 带宽产生负面影响，则应配置为 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">CPUSchedulingPolicy=idle</code> 和/或 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">IOSchedulingClass=idle</code> 。可选地，这可以与基于定时器的激活结合使用，以在运行时安排后台作业，并对系统产生最小影响，并将其从引导阶段中移除。</font></font></font></p></div></div><div class="refsect1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.6" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h2 id="Integration with systemd" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Integration with systemd<a class="headerlink" title="Permalink to this headline" href="#Integration%20with%20systemd" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">与 systemd 集成</font></font></font></h2><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.6.2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Writing systemd Unit Files" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Writing systemd Unit Files<a class="headerlink" title="Permalink to this headline" href="#Writing%20systemd%20Unit%20Files" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">编写 systemd 单元文件</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">When writing systemd unit files, it is recommended to
      consider the following suggestions:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">写 systemd 单元文件时，建议考虑以下建议：</font></font></font></p><div class="orderedlist" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><ol class="orderedlist" type="1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If possible, do not use the
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Type=forking</code> setting in service files. But
        if you do, make sure to set the PID file path using
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">PIDFile=</code>. See
        <a href="systemd.service.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.service</span>(5)</span></a>
        for details.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果可能的话，不要在服务文件中使用 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Type=forking</code> 设置。但如果使用了，请确保使用 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">PIDFile=</code> 设置 PID 文件路径。有关详细信息，请参阅 systemd.service(5)。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If your daemon registers a D-Bus name on the
        bus, make sure to use <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Type=dbus</code> in the
        service file if possible.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果您的守护程序在总线上注册了一个 D-Bus 名称，请尽可能在服务文件中使用 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Type=dbus</code> 。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Make sure to set a good human-readable
        description string with
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Description=</code>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">确保使用良好的人类可读的描述字符串设置 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Description=</code> 。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Do not disable
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">DefaultDependencies=</code>, unless you really
        know what you do and your unit is involved in early boot or
        late system shutdown.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">除非您确切知道自己在做什么并且您的单元涉及早期引导或系统的后期关闭，否则不要禁用 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">DefaultDependencies=</code> 。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Normally, little if any dependencies should
        need to be defined explicitly. However, if you do configure
        explicit dependencies, only refer to unit names listed on
        <a href="systemd.special.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.special</span>(7)</span></a>
        or names introduced by your own package to keep the unit file
        operating system-independent.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">通常，几乎不需要显式定义任何依赖关系。但是，如果您配置了显式依赖关系，请仅引用列在 systemd.special(7) 上的单元名称或由您自己的软件包引入的名称，以保持单元文件与操作系统无关。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Make sure to include an
        [Install] section including installation
        information for the unit file. See
        <a href="systemd.unit.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.unit</span>(5)</span></a>
        for details. To activate your service on boot, make sure to
        add a <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=multi-user.target</code> or
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=graphical.target</code> directive. To
        activate your socket on boot, make sure to add
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=sockets.target</code>. Usually, you also
        want to make sure that when your service is installed, your
        socket is installed too, hence add
        <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Also=foo.socket</code> in your service file
        <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">foo.service</code>, for a hypothetical program
        <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">foo</code>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">确保包含一个 [Install] 部分，其中包含有关单元文件安装信息。有关详细信息，请参阅 systemd.unit(5)。要在启动时激活您的服务，请确保添加 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=multi-user.target</code> 或 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=graphical.target</code> 指令。要在启动时激活您的套接字，请确保添加 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">WantedBy=sockets.target</code> 。通常，您还希望确保在安装您的服务时，您的套接字也被安装，因此在您的服务文件 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">foo.service</code> 中添加 <code class="varname" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Also=foo.socket</code> ，对于一个假设的程序 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">foo</code> 。</font></font></font></p></li></ol></div></div><div class="refsect2" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.6.3" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h3 id="Installing systemd Service Files" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Installing systemd Service Files<a class="headerlink" title="Permalink to this headline" href="#Installing%20systemd%20Service%20Files" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">安装 systemd 服务文件</font></font></font></h3><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">At the build installation time (e.g. <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">make
      install</strong></span> during package build), packages are
      recommended to install their systemd unit files in the directory
      returned by <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">pkg-config systemd
      --variable=systemdsystemunitdir</strong></span> (for system services)
      or <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">pkg-config systemd
      --variable=systemduserunitdir</strong></span> (for user services).
      This will make the services available in the system on explicit
      request but not activate them automatically during boot.
      Optionally, during package installation (e.g. <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">rpm
      -i</strong></span> by the administrator), symlinks should be created
      in the systemd configuration directories via the
      <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">enable</strong></span> command of the
      <a href="systemctl.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemctl</span>(1)</span></a>
      tool to activate them automatically on boot.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在构建安装时（例如，在软件包构建期间执行 make install），建议软件包将其 systemd 单元文件安装在 pkg-config systemd --variable=systemdsystemunitdir 返回的目录中（用于系统服务），或者 pkg-config systemd --variable=systemduserunitdir（用于用户服务）。这将使服务在系统中按需可用，但不会在启动时自动激活它们。可选地，在软件包安装期间（例如，由管理员执行 rpm -i），应通过 systemctl(1) 工具的 enable 命令在 systemd 配置目录中创建符号链接，以便在启动时自动激活它们。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Packages using
      <a href="http://linux.die.net/man/1/autoconf" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">autoconf</span>(1)</span></a>
      are recommended to use a configure script
      excerpt like the following to determine the
      unit installation path during source
      configuration:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">使用 autoconf(1) 的软件包建议在源配置期间使用类似以下内容的配置脚本摘录来确定单元安装路径：</font></font></font></p><pre class="programlisting">PKG_PROG_PKG_CONFIG()
AC_ARG_WITH([systemdsystemunitdir],
     [AS_HELP_STRING([--with-systemdsystemunitdir=DIR], [Directory for systemd service files])],,
     [with_systemdsystemunitdir=auto])
AS_IF([test "x$with_systemdsystemunitdir" = "xyes" -o "x$with_systemdsystemunitdir" = "xauto"], [
     def_systemdsystemunitdir=$($PKG_CONFIG --variable=systemdsystemunitdir systemd)

     AS_IF([test "x$def_systemdsystemunitdir" = "x"],
   [AS_IF([test "x$with_systemdsystemunitdir" = "xyes"],
    [AC_MSG_ERROR([systemd support requested but pkg-config unable to query systemd package])])
    with_systemdsystemunitdir=no],
   [with_systemdsystemunitdir="$def_systemdsystemunitdir"])])
AS_IF([test "x$with_systemdsystemunitdir" != "xno"],
      [AC_SUBST([systemdsystemunitdir], [$with_systemdsystemunitdir])])
AM_CONDITIONAL([HAVE_SYSTEMD], [test "x$with_systemdsystemunitdir" != "xno"])</pre><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">This snippet allows automatic
      installation of the unit files on systemd
      machines, and optionally allows their
      installation even on machines lacking
      systemd. (Modification of this snippet for the
      user unit directory is left as an exercise for the
      reader.)<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">此片段允许在 systemd 机器上自动安装单元文件，并且可选地允许即使在没有 systemd 的机器上也安装它们。（将此片段修改为用户单元目录的练习留给读者。）</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Additionally, to ensure that
      <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">make distcheck</strong></span> continues to
      work, it is recommended to add the following
      to the top-level <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Makefile.am</code>
      file in
      <a href="http://linux.die.net/man/1/automake" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">automake</span>(1)</span></a>-based
      projects:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">此外，为了确保 make distcheck 继续工作，建议在基于 automake(1) 的项目的顶层 <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">Makefile.am</code> 文件中添加以下内容：</font></font></font></p><pre class="programlisting">AM_DISTCHECK_CONFIGURE_FLAGS = \
  --with-systemdsystemunitdir=$$dc_install_base/$(systemdsystemunitdir)</pre><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Finally, unit files should be installed in the system with an automake excerpt like the following:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">最后，单元文件应该通过类似以下的 automake 摘录安装到系统中：</font></font></font></p><pre class="programlisting">if HAVE_SYSTEMD
systemdsystemunit_DATA = \
  foobar.socket \
  foobar.service
endif</pre><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">In the
      <a href="http://linux.die.net/man/8/rpm" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">rpm</span>(8)</span></a>
      <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.spec</code> file, use snippets like the following
      to enable/disable the service during
      installation/deinstallation. This makes use of the RPM macros
      shipped along systemd. Consult the packaging guidelines of your
      distribution for details and the equivalent for other package
      managers.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在 rpm(8) <code class="filename" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">.spec</code> 文件中，使用以下类似的片段在安装/卸载期间启用/禁用服务。这利用了 systemd 附带的 RPM 宏。请查阅您所在发行版的打包指南以获取详细信息，以及其他软件包管理器的等效方法。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">At the top of the file:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">文件顶部：</font></font></font></p><pre class="programlisting">BuildRequires: systemd
%{?systemd_requires}</pre><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">And as scriptlets, further down:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">并且作为脚本块，进一步向下:</font></font></font></p><pre class="programlisting">%post
%systemd_post foobar.service foobar.socket

%preun
%systemd_preun foobar.service foobar.socket

%postun
%systemd_postun</pre><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If the service shall be restarted during upgrades, replace
      the "<code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%postun</code>" scriptlet above with the
      following:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果服务在升级期间需要重新启动，请用以下内容替换上面的“ <code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%postun</code> ”脚本块:</font></font></font></p><pre class="programlisting">%postun
%systemd_postun_with_restart foobar.service</pre><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Note that "<code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_post</code>" and
      "<code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_preun</code>" expect the names of all units
      that are installed/removed as arguments, separated by spaces.
      "<code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_postun</code>" expects no arguments.
      "<code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_postun_with_restart</code>" expects the
      units to restart as arguments.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">请注意，“ <code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_post</code> ”和“ <code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_preun</code> ”需要安装/移除的所有单元的名称作为参数，用空格分隔。“ <code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_postun</code> ”不需要参数。“ <code class="literal" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">%systemd_postun_with_restart</code> ”需要重启的单元作为参数。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">To facilitate upgrades from a package version that shipped
      only SysV init scripts to a package version that ships both a
      SysV init script and a native systemd service file, use a
      fragment like the following:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">为了方便从仅提供 SysV init 脚本的软件包版本升级到既提供 SysV init 脚本又提供本机 systemd 服务文件的软件包版本，请使用以下类似的片段：</font></font></font></p><pre class="programlisting">%triggerun -- foobar &lt; 0.47.11-1
if /sbin/chkconfig --level 5 foobar ; then
  /bin/systemctl --no-reload enable foobar.service foobar.socket &gt;/dev/null 2&gt;&amp;1 || :
fi</pre><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Where 0.47.11-1 is the first package version that includes
      the native unit file. This fragment will ensure that the first
      time the unit file is installed, it will be enabled if and only
      if the SysV init script is enabled, thus making sure that the
      enable status is not changed. Note that
      <span class="command" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><strong data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">chkconfig</strong></span> is a command specific to Fedora
      which can be used to check whether a SysV init script is
      enabled. Other operating systems will have to use different
      commands here.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">其中 0.47.11-1 是第一个包含本机单元文件的软件包版本。此片段将确保在第一次安装单元文件时，仅当启用 SysV init 脚本时才启用它，从而确保启用状态不会更改。请注意，chkconfig 是 Fedora 特有的命令，可用于检查 SysV init 脚本是否已启用。其他操作系统将需要在此处使用不同的命令。</font></font></font></p></div></div><div class="refsect1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.7" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h2 id="Porting Existing Daemons" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Porting Existing Daemons<a class="headerlink" title="Permalink to this headline" href="#Porting%20Existing%20Daemons" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">移植现有守护程序</font></font></font></h2><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Since new-style init systems such as systemd are compatible
    with traditional SysV init systems, it is not strictly necessary
    to port existing daemons to the new style. However, doing so
    offers additional functionality to the daemons as well as
    simplifying integration into new-style init systems.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">由于新式的初始化系统（如 systemd）与传统的 SysV 初始化系统兼容，因此不严格需要将现有的守护程序移植到新样式。然而，这样做不仅为守护程序提供了额外的功能，还简化了与新式初始化系统的集成。</font></font></font></p><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">To port an existing SysV compatible daemon, the following
    steps are recommended:<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">要移植现有的 SysV 兼容守护程序，建议执行以下步骤：</font></font></font></p><div class="orderedlist" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><ol class="orderedlist" type="1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If not already implemented, add an optional
      command line switch to the daemon to disable daemonization. This
      is useful not only for using the daemon in new-style init
      systems, but also to ease debugging.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果尚未实现，请向守护程序添加一个可选的命令行开关以禁用守护程序化。这不仅对在新式初始化系统中使用守护程序有用，还有助于简化调试。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If the daemon offers interfaces to other software running on the local system via local
      <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">AF_UNIX</code> sockets, consider implementing socket-based activation (see above).
      Usually, a minimal patch is sufficient to implement this: Extend the socket creation in the daemon code
      so that
      <a href="sd_listen_fds.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_listen_fds</span>(3)</span></a> is
      checked for already passed sockets first. If sockets are passed (i.e. when
      <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_listen_fds()</code> returns a positive value), skip the socket creation step and use
      the passed sockets. Secondly, ensure that the file system socket nodes for local
      <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">AF_UNIX</code> sockets used in the socket-based activation are not removed when the
      daemon shuts down, if sockets have been passed. Third, if the daemon normally closes all remaining open
      file descriptors as part of its initialization, the sockets passed from the service manager must be
      spared. Since new-style init systems guarantee that no left-over file descriptors are passed to
      executed processes, it might be a good choice to simply skip the closing of all remaining open file
      descriptors if sockets are passed.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果守护程序通过本地 <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">AF_UNIX</code> 套接字向本地系统上运行的其他软件提供接口，请考虑实现基于套接字的激活（见上文）。通常，实现此功能只需进行最小的补丁：在守护程序代码中扩展套接字创建，以便首先检查已传递的套接字是否已通过 sd_listen_fds(3)检查。如果已传递套接字（即当 <code class="function" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_listen_fds()</code> 返回正值时），则跳过套接字创建步骤并使用已传递的套接字。其次，确保在守护程序关闭时不会删除基于套接字激活中使用的本地 <code class="constant" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">AF_UNIX</code> 套接字的文件系统套接字节点，如果已传递套接字。第三，如果守护程序通常在初始化过程中关闭所有剩余的打开文件描述符，则必须保留来自服务管理器的套接字。由于新式初始化系统保证不会将剩余的文件描述符传递给执行的进程，如果已传递套接字，则可能是一个不错的选择简单地跳过关闭所有剩余打开文件描述符的步骤。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Write and install a systemd unit file for the
      service (and the sockets if socket-based activation is used, as
      well as a path unit file, if the daemon processes a spool
      directory), see above for details.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">为服务编写并安装一个 systemd 单元文件（如果使用基于套接字的激活，则还需包括套接字，以及如果守护进程处理一个 spool 目录，则还需包括路径单元文件），详情请参见上文。</font></font></font></p></li><li class="listitem" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">If the daemon exposes interfaces via D-Bus,
      write and install a D-Bus activation file for the service, see
      above for details.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果守护进程通过 D-Bus 公开接口，请为服务编写并安装一个 D-Bus 激活文件，详情请参见上文。</font></font></font></p></li></ol></div></div><div class="refsect1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.8" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h2 id="Placing Daemon Data" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">Placing Daemon Data<a class="headerlink" title="Permalink to this headline" href="#Placing%20Daemon%20Data" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">放置守护进程数据 ¶</font></font></font></h2><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">It is recommended to follow the general guidelines for
    placing package files, as discussed in
    <a href="file-hierarchy.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">file-hierarchy</span>(7)</span></a>.<font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">建议遵循放置软件包文件的一般准则，如 file-hierarchy(7) 中所讨论的那样。</font></font></font></p></div><div class="refsect1" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><a name="id-1.9" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"></a><h2 id="See Also" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">See Also<a class="headerlink" title="Permalink to this headline" href="#See%20Also" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">¶</a><font class="notranslate immersive-translate-target-wrapper" lang="zh-CN" data-immersive-translate-translation-element-mark="1"><font class="notranslate" data-immersive-translate-translation-element-mark="1">&nbsp;</font><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">参见 ¶</font></font></font></h2><p data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3" data-immersive-translate-paragraph="1">
      <a href="systemd.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd</span>(1)</span></a>,
      <a href="sd-daemon.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd-daemon</span>(3)</span></a>,
      <a href="sd_listen_fds.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_listen_fds</span>(3)</span></a>,
      <a href="sd_notify.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">sd_notify</span>(3)</span></a>,
      <a href="daemon.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">daemon</span>(3)</span></a>,
      <a href="systemd.service.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">systemd.service</span>(5)</span></a>,
      <a href="file-hierarchy.html#" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="citerefentry" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3"><span class="refentrytitle" data-immersive-translate-walked="769899d6-a977-455b-b668-0944cdec4bf3">file-hierarchy</span>(7)</span></a>
    </p></div></div>
</body></html>